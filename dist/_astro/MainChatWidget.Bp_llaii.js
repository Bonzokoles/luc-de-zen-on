import"./disclose-version.DsnmJJEf.js";import"./legacy.kkaBD5aU.js";import{o as Te}from"./index-client.CI4zVHyS.js";import{p as We,h as i,g as e,a as k,l as De,o as Je,f as h,t as w,b as d,d as Ne,c as o,r as s,u as m,s as u,e as Be,j as J,q as se,k as re}from"./template.BqTI6ysn.js";import{s as f,e as O}from"./render.DLtPj5hE.js";import{i as g}from"./if.CL3_9eW_.js";import{e as Le,i as Re}from"./each.BgQDu70D.js";import{a as ie}from"./attributes.CMoobVFc.js";import{s as Ee}from"./class.Cwo7PGLY.js";import{b as Ke}from"./input.BDyfk_mK.js";import{i as qe}from"./lifecycle.CZxN27Pe.js";/* empty css                                    */import"./index.DIeogL5L.js";import"./attributes.BJtm3mOD.js";var Ge=h('<button class="switch-btn svelte-1a3hmo1" title="Przełącz na Cloudflare AI">☁️</button>'),Ue=h('<div class="welcome-message svelte-1a3hmo1"><p class="svelte-1a3hmo1">👋 Cześć! Jestem Twoim głównym asystentem AI w MyBonzo.</p> <p class="hint svelte-1a3hmo1">Wybierz model z floating buttons lub zadaj mi pytanie!</p></div>'),Ze=h('<span class="source-badge svelte-1a3hmo1" style="--badge-color: #ff6b35;"> </span>'),$e=h('<span class="source-badge svelte-1a3hmo1" style="--badge-color: #f38020;">☁️ Cloudflare</span>'),Fe=h('<div><div class="message-content svelte-1a3hmo1"> </div> <div class="message-meta svelte-1a3hmo1"><span class="timestamp svelte-1a3hmo1"> </span> <!></div></div>'),He=h('<div class="message ai loading svelte-1a3hmo1"><div class="message-content svelte-1a3hmo1"><div class="typing-indicator svelte-1a3hmo1"><span class="svelte-1a3hmo1"></span> <span class="svelte-1a3hmo1"></span> <span class="svelte-1a3hmo1"></span></div> <div class="loading-text svelte-1a3hmo1"> </div></div></div>'),Qe=h('<div class="chat-container svelte-1a3hmo1"><div class="chat-header svelte-1a3hmo1"><div class="chat-title svelte-1a3hmo1"><span class="ai-icon svelte-1a3hmo1"><!></span> <div class="title-info svelte-1a3hmo1"><div class="main-title svelte-1a3hmo1">MyBonzo AI Chat</div> <div class="subtitle svelte-1a3hmo1"><!></div></div></div> <div class="header-actions svelte-1a3hmo1"><!> <button class="close-btn svelte-1a3hmo1" title="Zamknij chat">×</button></div></div> <div class="chat-messages svelte-1a3hmo1"><!> <!></div> <div class="chat-input-container svelte-1a3hmo1"><div class="input-wrapper svelte-1a3hmo1"><textarea rows="1" class="svelte-1a3hmo1"></textarea> <button class="send-btn svelte-1a3hmo1" title="Wyślij wiadomość"> </button></div> <div class="chat-actions svelte-1a3hmo1"><button class="clear-btn svelte-1a3hmo1" title="Wyczyść historię">🗑️ Wyczyść</button> <div class="provider-indicator svelte-1a3hmo1"> </div></div></div></div>'),Ve=h('<span class="active-model svelte-1a3hmo1"> </span>'),Xe=h('<button class="chat-toggle-btn svelte-1a3hmo1" title="Otwórz główny chat"><span class="ai-icon svelte-1a3hmo1">💬</span> <span class="chat-label svelte-1a3hmo1">Main Chat AI</span> <!></button>'),Ye=h('<div class="main-chat-widget svelte-1a3hmo1" data-component="main-chat"><!></div>');function ua(ne,le){We(le,!1);let j=k(!1),l=k([]),z=k(""),y=k(!1),U=Math.random().toString(36).substring(2,15),t=k(null),p=k("cloudflare");Te(()=>{const n=localStorage.getItem("main_chat_messages"),v=localStorage.getItem("main_chat_session");return n&&i(l,JSON.parse(n)),v?U=v:localStorage.setItem("main_chat_session",U),window.addEventListener("openRouterModelSelected",Z),()=>{window.removeEventListener("openRouterModelSelected",Z)}});function Z(n){i(t,n.detail),i(p,"openrouter"),i(j,!0),i(l,[...e(l),{type:"ai",content:`🤖 Aktywowano model ${e(t).name}! ${e(t).description}. W czym mogę pomóc?`,timestamp:new Date().toISOString(),source:"openrouter_model",model:e(t).id}])}async function $(){if(!e(z).trim()||e(y))return;const n=e(z).trim();i(z,""),i(l,[...e(l),{type:"user",content:n,timestamp:new Date().toISOString()}]),i(y,!0);try{let v;e(p)==="openrouter"&&e(t)?v=await fetch("/api/openrouter-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n,model:e(t).id,systemPrompt:`Jesteś pomocnym asystentem AI działającym w systemie MyBonzo. Nazywasz się ${e(t).name}. ${e(t).description}`})}):v=await fetch("/api/generic-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_message:n,system_prompt:"Jesteś pomocnym asystentem AI w platformie MyBonzo. Pomagaj użytkownikom z zadaniami związanymi z AI i automatyzacją.",model:"@cf/google/gemma-3-12b-it"})});const _=await v.json();if(!v.ok)throw new Error(_.error||"Błąd API");i(l,[...e(l),{type:"ai",content:_.response||_.answer||"Brak odpowiedzi",timestamp:new Date().toISOString(),source:e(p)==="openrouter"?"openrouter_model":"cloudflare_ai",model:e(p)==="openrouter"?e(t)?.id:"@cf/google/gemma-3-12b-it"}])}catch(v){console.error("Chat error:",v),i(l,[...e(l),{type:"ai",content:"Przepraszam, wystąpił błąd podczas przetwarzania Twojego zapytania. Spróbuj ponownie później.",timestamp:new Date().toISOString(),error:!0}])}finally{i(y,!1)}}function ve(){i(l,[]),i(t,null),i(p,"cloudflare"),localStorage.removeItem("main_chat_messages")}function ce(){i(p,"cloudflare"),i(t,null),i(l,[...e(l),{type:"ai",content:"🔄 Przełączono na Cloudflare Workers AI. Używam teraz lokalnego modelu Gemma.",timestamp:new Date().toISOString(),source:"cloudflare_ai"}])}function de(n){n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),$())}De(()=>e(l),()=>{e(l).length>0&&localStorage.setItem("main_chat_messages",JSON.stringify(e(l)))}),Je(),qe();var A=Ye(),me=o(A);{var pe=n=>{var v=Qe(),_=o(v),M=o(_),S=o(M),C=o(S);{var N=a=>{var r=J();w(()=>f(r,(e(t),m(()=>e(t).icon)))),d(a,r)},he=a=>{var r=J("🤖");d(a,r)};g(C,a=>{e(p)==="openrouter"&&e(t)?a(N):a(he,!1)})}s(S);var F=u(S,2),H=u(o(F),2),_e=o(H);{var fe=a=>{var r=J();w(()=>f(r,`${e(t),m(()=>e(t).name)??""} via OpenRouter`)),d(a,r)},ge=a=>{var r=J("Cloudflare Workers AI");d(a,r)};g(_e,a=>{e(p)==="openrouter"&&e(t)?a(fe):a(ge,!1)})}s(H),s(F),s(M);var Q=u(M,2),V=o(Q);{var ye=a=>{var r=Ge();O("click",r,ce),d(a,r)};g(V,a=>{e(p)==="openrouter"&&a(ye)})}var be=u(V,2);s(Q),s(_);var B=u(_,2),X=o(B);{var we=a=>{var r=Ue();d(a,r)},ze=a=>{var r=se(),T=re(r);Le(T,1,()=>e(l),Re,(W,c)=>{var D=Fe(),R=o(D),Oe=o(R,!0);s(R);var oe=u(R,2),E=o(oe),Me=o(E,!0);s(E);var Ce=u(E,2);{var je=b=>{var x=Ze(),K=o(x);s(x),w(q=>f(K,`🌐 ${q??""}`),[()=>(e(c),m(()=>e(c).model?.split("/")[0]||"OpenRouter"))]),d(b,x)},Ae=b=>{var x=se(),K=re(x);{var q=G=>{var Pe=$e();d(G,Pe)};g(K,G=>{e(c),m(()=>e(c).source==="cloudflare_ai")&&G(q)},!0)}d(b,x)};g(Ce,b=>{e(c),m(()=>e(c).source==="openrouter_model")?b(je):b(Ae,!1)})}s(oe),s(D),w(b=>{Ee(D,1,`message ${e(c),m(()=>e(c).type)??""} ${e(c),m(()=>e(c).error?"error":"")??""}`,"svelte-1a3hmo1"),f(Oe,(e(c),m(()=>e(c).content))),f(Me,b)},[()=>(e(c),m(()=>new Date(e(c).timestamp).toLocaleTimeString("pl-PL")))]),d(W,D)}),d(a,r)};g(X,a=>{e(l),m(()=>e(l).length===0)?a(we):a(ze,!1)})}var Se=u(X,2);{var Ie=a=>{var r=He(),T=o(r),W=u(o(T),2),c=o(W,!0);s(W),s(T),s(r),w(()=>f(c,(e(p),e(t),m(()=>e(p)==="openrouter"?`${e(t)?.name} pisze odpowiedź...`:"AI pisze odpowiedź...")))),d(a,r)};g(Se,a=>{e(y)&&a(Ie)})}s(B);var Y=u(B,2),L=o(Y),I=o(L);Be(I);var P=u(I,2),xe=o(P,!0);s(P),s(L);var ee=u(L,2),ae=o(ee),te=u(ae,2),ke=o(te,!0);s(te),s(ee),s(Y),s(v),w(a=>{ie(I,"placeholder",(e(p),e(t),m(()=>e(p)==="openrouter"&&e(t)?`Napisz do ${e(t).name}...`:"Napisz wiadomość..."))),I.disabled=e(y),P.disabled=a,f(xe,e(y)?"⏳":"🚀"),f(ke,e(p)==="openrouter"?"🌐 OpenRouter":"☁️ Cloudflare")},[()=>(e(z),e(y),m(()=>!e(z).trim()||e(y)))]),O("click",be,()=>i(j,!1)),Ke(I,()=>e(z),a=>i(z,a)),O("keypress",I,de),O("click",P,$),O("click",ae,ve),d(n,v)},ue=n=>{var v=Xe(),_=u(o(v),4);{var M=S=>{var C=Ve(),N=o(C,!0);s(C),w(()=>f(N,(e(t),m(()=>e(t).icon)))),d(S,C)};g(_,S=>{e(t)&&S(M)})}s(v),O("click",v,()=>i(j,!0)),d(n,v)};g(me,n=>{e(j)?n(pe):n(ue,!1)})}s(A),w(()=>ie(A,"data-active-model",(e(t),m(()=>e(t)?.id||"cloudflare")))),d(ne,A),Ne()}export{ua as default};
