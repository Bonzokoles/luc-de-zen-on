import{j as q}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.DtoOFyvK.js";function D({height:u=120,source:f="auto",variant:m="edge"}){const R=d.useRef(null),y=d.useRef(null),p=d.useRef(null),A=d.useRef(null);return d.useEffect(()=>{const r=R.current;if(!r)return;const n=r.getContext("2d");if(!n)return;const a=Math.max(1,window.devicePixelRatio||1),v=()=>{const e=r.getBoundingClientRect();r.width=Math.floor(e.width*a),r.height=Math.floor(u*a)};v();let C=0;function z(){const e=window,t=e.MUSIC_ANALYSER||e.MUSIC&&e.MUSIC.getAnalyser&&e.MUSIC.getAnalyser(),o=e.MIC_ANALYSER||null;return f==="music"?t:f==="mic"?o:t||o}function s(){try{const e=z();e&&e.frequencyBinCount&&(p.current=e,A.current=new Uint8Array(e.frequencyBinCount))}catch{}}s(),window.addEventListener("music-analyser-ready",s),window.addEventListener("mic-analyser-ready",s);const E=()=>{y.current=requestAnimationFrame(E),C+=.015;const e=r.width,t=r.height;n.clearRect(0,0,e,t);const o=Math.max(24,Math.floor(e/(18*a))),b=e/o,L=getComputedStyle(document.documentElement).getPropertyValue("--color-edge")?.trim()||"hsl(200,30%,18%)";let h="#00d7ef",w=L;m==="music"?(h="#4fc3f7",w="#00bcd4"):m==="mic"&&(h="#00e7ff",w=L);const g=p.current,c=A.current;if(g&&c)try{g.getByteFrequencyData(c)}catch{}for(let i=0;i<o;i++){let l;if(g&&c){const M=Math.floor(i*(c.length/o)),B=c[Math.min(M,c.length-1)]/255,I=Math.pow(B,.85);l=Math.max(2,I*t*.9)}else{const M=.08+.06*Math.sin(C+i*.35);l=Math.max(2,M*t)}const x=n.createLinearGradient(0,t-l,0,t);x.addColorStop(0,h),x.addColorStop(1,w),n.fillStyle=x,n.fillRect(i*b,t-l,b*.85,l)}n.fillStyle="rgba(255,255,255,0.25)",n.fillRect(0,0,e,Math.max(1,1*a)),n.fillRect(0,t-Math.max(1,1*a),e,Math.max(1,1*a))};E();const S=()=>v();return window.addEventListener("resize",S),()=>{y.current&&cancelAnimationFrame(y.current),window.removeEventListener("resize",S),window.removeEventListener("music-analyser-ready",s),window.removeEventListener("mic-analyser-ready",s)}},[u,f,m]),q.jsx("div",{className:"w-full mx-auto",children:q.jsx("canvas",{ref:R,style:{width:"100%",height:`${u}px`,display:"block",background:"rgba(0,0,0,0.35)",border:"1px solid rgba(0,217,255,0.3)"}})})}export{D as default};
