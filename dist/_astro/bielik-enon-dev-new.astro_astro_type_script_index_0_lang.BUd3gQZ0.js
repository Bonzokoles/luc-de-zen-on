class l{constructor(){this.isLoading=!1,this.initializeElements(),this.bindEvents(),this.updateTemperatureValue()}initializeElements(){this.elements={modelSelect:document.getElementById("modelSelect"),temperatureSlider:document.getElementById("temperatureSlider"),temperatureValue:document.getElementById("temperatureValue"),maxTokensInput:document.getElementById("maxTokensInput"),promptInput:document.getElementById("promptInput"),sendPrompt:document.getElementById("sendPrompt"),testConnection:document.getElementById("testConnection"),clearChat:document.getElementById("clearChat"),responseContainer:document.getElementById("responseContainer"),responseMetadata:document.getElementById("responseMetadata"),usedModel:document.getElementById("usedModel"),tokenUsage:document.getElementById("tokenUsage"),responseTime:document.getElementById("responseTime"),workerStatus:document.getElementById("workerStatus")}}bindEvents(){this.elements.temperatureSlider.addEventListener("input",()=>this.updateTemperatureValue()),this.elements.sendPrompt.addEventListener("click",()=>this.sendPrompt()),this.elements.testConnection.addEventListener("click",()=>this.testConnection()),this.elements.clearChat.addEventListener("click",()=>this.clearChat()),this.elements.promptInput.addEventListener("keydown",e=>{e.key==="Enter"&&e.ctrlKey&&(e.preventDefault(),this.sendPrompt())})}updateTemperatureValue(){const e=this.elements.temperatureSlider.value;this.elements.temperatureValue.textContent=e}async sendPrompt(){if(this.isLoading)return;const e=this.elements.promptInput.value.trim();if(!e){this.showError("WprowadĹş prompt przed wysĹ‚aniem!");return}this.setLoading(!0);const s=Date.now();try{const t={prompt:e,model:this.elements.modelSelect.value,temperature:parseFloat(this.elements.temperatureSlider.value),max_tokens:parseInt(this.elements.maxTokensInput.value)};console.log("WysyĹ‚anie requestu do BIELIK API:",t);const n=await fetch("/api/bielik-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=Date.now()-s;if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const a=await n.json();console.log("OdpowiedĹş z BIELIK API:",a),this.showResponse(a,i)}catch(t){console.error("BĹ‚Ä…d podczas komunikacji z BIELIK API:",t),this.showError(`BĹ‚Ä…d: ${t.message}`)}finally{this.setLoading(!1)}}async testConnection(){if(this.isLoading)return;this.setLoading(!0);const e=Date.now();try{console.log("Testowanie poĹ‚Ä…czenia z BIELIK API...");const s=await fetch("/api/bielik-analytics"),t=await s.json(),n=await fetch("/api/bielik-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:"Test poĹ‚Ä…czenia",model:"bielik-7b-instruct",temperature:.7,max_tokens:50})}),i=await n.json(),a=Date.now()-e,r={text:`âś… Test poĹ‚Ä…czenia pomyĹ›lny!

Analytics API: ${s.ok?"OK":"BĹÄ„D"}
Chat API: ${n.ok?"OK":"BĹÄ„D"}
Cloudflare Worker: ${i.worker_used?"Aktywny":"Fallback"}

Statystyki uĹĽycia:
- CaĹ‚kowite zapytania: ${t.total_requests}
- Ostatnie 24h: ${t.requests_last_24h}
- Ĺšredni czas odpowiedzi: ${t.avg_response_time}ms`,model:"Test systemu",tokens:t.total_tokens||0,worker_used:i.worker_used,worker_response_time:i.worker_response_time};this.showResponse(r,a)}catch(s){console.error("BĹ‚Ä…d podczas testu poĹ‚Ä…czenia:",s),this.showError(`Test nie powiĂłdĹ‚ siÄ™: ${s.message}`)}finally{this.setLoading(!1)}}clearChat(){this.elements.responseContainer.innerHTML='<div class="placeholder">WyĹ›lij prompt aby zobaczyÄ‡ odpowiedĹş BIELIK...</div>',this.elements.responseMetadata.style.display="none",this.elements.promptInput.value=""}setLoading(e){this.isLoading=e,this.elements.sendPrompt.disabled=e,this.elements.testConnection.disabled=e,e&&(this.elements.responseContainer.innerHTML='<div class="loading">âŹł WysyĹ‚anie do BIELIK...</div>',this.elements.responseMetadata.style.display="none")}showResponse(e,s){this.elements.responseContainer.innerHTML=`<div class="success">${e.text||"Brak odpowiedzi"}</div>`,this.elements.usedModel.textContent=e.model||"Nieznany",this.elements.tokenUsage.textContent=e.tokens||"0",this.elements.responseTime.textContent=`${s}ms`,this.elements.workerStatus.textContent=e.worker_used?`Worker (${e.worker_response_time}ms)`:"Fallback",this.elements.responseMetadata.style.display="grid"}showError(e){this.elements.responseContainer.innerHTML=`<div class="error">${e}</div>`,this.elements.responseMetadata.style.display="none"}}function d(){const o=document.getElementById("helpModal"),e=document.getElementById("helpButton"),s=document.getElementById("closeModal");e.addEventListener("click",()=>{o.style.display="block"}),s.addEventListener("click",()=>{o.style.display="none"}),window.addEventListener("click",t=>{t.target===o&&(o.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{console.log("Inicjalizacja BIELIK API Tester..."),window.bielikTester=new l,d()});
