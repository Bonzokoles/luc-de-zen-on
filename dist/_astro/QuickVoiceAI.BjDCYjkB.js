import{j as l}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.DtoOFyvK.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),N=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,d,c)=>c?c.toUpperCase():d.toLowerCase()),k=i=>{const t=N(i);return t.charAt(0).toUpperCase()+t.slice(1)},A=(...i)=>i.filter((t,d,c)=>!!t&&t.trim()!==""&&c.indexOf(t)===d).join(" ").trim(),T=i=>{for(const t in i)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var C={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=u.forwardRef(({color:i="currentColor",size:t=24,strokeWidth:d=2,absoluteStrokeWidth:c,className:g="",children:m,iconNode:o,...w},h)=>u.createElement("svg",{ref:h,...C,width:t,height:t,stroke:i,strokeWidth:c?Number(d)*24/Number(t):d,className:A("lucide",g),...!m&&!T(w)&&{"aria-hidden":"true"},...w},[...o.map(([z,b])=>u.createElement(z,b)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=(i,t)=>{const d=u.forwardRef(({className:c,...g},m)=>u.createElement(I,{ref:m,iconNode:t,className:A(`lucide-${x(k(i))}`,`lucide-${i}`,c),...g}));return d.displayName=k(i),d};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],R=y("mic",P);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],B=y("mic-off",M);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],O=y("phone-off",D);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],L=y("phone",_);function q({variant:i="compact"}){const[t,d]=u.useState(!1),[c,g]=u.useState(!1),[m,o]=u.useState(""),w=u.useRef(null),h=u.useRef([]),z=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){o("❌ Przeglądarka nie obsługuje nagrywania audio");return}if((await navigator.permissions.query({name:"microphone"})).state==="denied"){o("❌ Brak dostępu do mikrofonu - sprawdź ustawienia przeglądarki");return}o("🔄 Łączenie z mikrofonem...");const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});MediaRecorder.isTypeSupported("audio/webm;codecs=opus")||console.warn("WEBM/Opus not supported, falling back to default format");const a=new MediaRecorder(e,{mimeType:MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm"});w.current=a,h.current=[],a.ondataavailable=n=>{n.data.size>0&&h.current.push(n.data)},a.onstop=async()=>{const n=new Blob(h.current,{type:"audio/webm"});if(n.size===0){o("❌ Nie udało się nagrać audio - spróbuj ponownie"),e.getTracks().forEach(s=>s.stop());return}console.log(`🎤 Nagranie zakończone: ${n.size} bytes`),await j(n),e.getTracks().forEach(s=>s.stop())},a.onerror=n=>{console.error("MediaRecorder error:",n),o("❌ Błąd podczas nagrywania"),e.getTracks().forEach(s=>s.stop())},a.start(100),d(!0),o("🎤 Nagrywam... (mów teraz)")}catch(r){console.error("Error starting recording:",r),r instanceof Error?r.name==="NotAllowedError"?o("❌ Dostęp do mikrofonu został odrzucony"):r.name==="NotFoundError"?o("❌ Nie znaleziono mikrofonu"):r.name==="NotSupportedError"?o("❌ Nagrywanie audio nie jest obsługiwane"):o(`❌ Błąd dostępu do mikrofonu: ${r.message}`):o("❌ Nieznany błąd mikrofonu")}},b=()=>{w.current&&t&&(w.current.stop(),d(!1),o("⏳ Przetwarzam..."))},S=async r=>{try{o(s=>`${s}
🤖 Agent myśli...`);const e=await fetch("/api/ai/advanced-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r,language:"pl-PL",context:"mybonzo-voice-chat",features:["speech","voice-response"]}),signal:AbortSignal.timeout(15e3)});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(`AI API Error ${e.status}: ${s.error||"AI service unavailable"}`)}const a=await e.json();if(!a.success&&!a.response)throw new Error(a.error||"AI response generation failed");const n=a.response;if(!n||n.trim().length===0)throw new Error("Empty AI response received");console.log(`🤖 AI Agent odpowiada: "${n}"`),o(s=>`${s.replace("🤖 Agent myśli...","")}
🤖 Agent: ${n}`),await E(n)}catch(e){console.error("AI Response Error:",e);let a="❌ Błąd AI";e instanceof Error&&(e.name==="AbortError"?a="❌ AI zbyt długo myśli - spróbuj ponownie":e.message.includes("network")||e.message.includes("fetch")?a="❌ Błąd połączenia z AI - sprawdź internet":e.message.includes("500")?a="❌ Błąd serwera AI - spróbuj za chwilę":a=`❌ Błąd AI: ${e.message}`),o(n=>`${n.replace("🤖 Agent myśli...","")}
${a}`)}},E=async r=>{try{if(console.log("🔊 Agent odpowiada głosem:",r),!("speechSynthesis"in window)){console.warn("Speech Synthesis not supported in this browser"),o(p=>`${p}
⚠️ Przeglądarka nie obsługuje syntezatora mowy`);return}speechSynthesis.cancel(),await new Promise(p=>setTimeout(p,100));const e=new SpeechSynthesisUtterance(r);e.lang="pl-PL",e.rate=.9,e.pitch=1.1,e.volume=.8,e.onstart=()=>{console.log("🔊 TTS started"),window.dispatchEvent(new CustomEvent("ai-voice-start",{detail:{text:r,duration:r.length*100}}))},e.onend=()=>{console.log("🔊 TTS ended"),window.dispatchEvent(new CustomEvent("ai-voice-end"))},e.onerror=p=>{console.error("TTS Error:",p),window.dispatchEvent(new CustomEvent("ai-voice-end")),o(f=>`${f}
⚠️ Błąd podczas odtwarzania głosu`)};let a=0;const n=3,s=()=>{a++,console.log(`🔊 TTS attempt ${a}/${n}`),speechSynthesis.speak(e),setTimeout(()=>{speechSynthesis.speaking||speechSynthesis.pending||(a<n?(console.warn(`TTS attempt ${a} failed, retrying...`),s()):(console.error("TTS failed after all attempts"),o(p=>`${p}
❌ Nie udało się odtworzyć głosu`)))},2e3)};s()}catch(e){console.error("TTS Error:",e),o(a=>`${a}
❌ Błąd syntezatora mowy`),window.dispatchEvent(new CustomEvent("ai-voice-end"))}},j=async r=>{try{o("⏳ Przetwarzam audio z Google Cloud...");const e=new FormData;e.append("audio",r,"recording.webm"),e.append("language","pl-PL");const a=await fetch("/api/voice/recognition",{method:"POST",body:e,signal:AbortSignal.timeout(3e4)});if(!a.ok){const f=await a.json().catch(()=>({}));throw new Error(`API Error ${a.status}: ${f.error||"Unknown error"}`)}const n=await a.json();if(!n.success)throw new Error(n.error||"Voice recognition failed");const s=n.transcript||"Nie rozpoznano mowy",p=n.confidence||0;console.log(`🎤 Rozpoznano: "${s}" (pewność: ${p}%)`),o(`Ty: ${s} (${p}%)`),s&&s!=="Nie rozpoznano mowy"&&p>50?await S(s):p<=50&&o(f=>`${f}
⚠️ Niska pewność rozpoznania - spróbuj mówić wyraźniej`)}catch(e){console.error("Error processing audio:",e),e instanceof Error?e.name==="AbortError"?o("❌ Przekroczono czas oczekiwania - spróbuj ponownie"):e.message.includes("network")?o("❌ Błąd sieci - sprawdź połączenie internetowe"):o(`❌ Błąd przetwarzania: ${e.message}`):o("❌ Nieznany błąd podczas przetwarzania audio")}},$=async()=>{if(c)g(!1),o("❌ Rozłączono z Voice AI"),w.current&&t&&(w.current.stop(),d(!1)),"speechSynthesis"in window&&speechSynthesis.cancel();else try{if(o("🔄 Sprawdzanie uprawnień..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Przeglądarka nie obsługuje nagrywania audio");"speechSynthesis"in window||console.warn("Speech Synthesis not available - TTS will be limited");try{const n=await navigator.permissions.query({name:"microphone"});if(console.log(`Microphone permission: ${n.state}`),n.state==="denied")throw new Error("Dostęp do mikrofonu został zablokowany w ustawieniach przeglądarki")}catch(n){console.warn("Could not check microphone permission:",n)}o("🔄 Testowanie połączenia z API...");const r=await fetch("/api/voice/recognition",{method:"GET",signal:AbortSignal.timeout(5e3)});if(!r.ok)throw new Error("API Voice Recognition niedostępne");const e=await r.json();console.log("API Voice Recognition capabilities:",e);const a=await fetch("/api/ai/advanced-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"test",language:"pl-PL"}),signal:AbortSignal.timeout(5e3)});a.ok||console.warn("AI Chat API may be unavailable"),g(!0),o(`✅ Połączono z Voice AI
🎤 Google Cloud Speech-to-Text: ${e.googleCloud?.enabled?"Aktywne":"Symulacja"}
🤖 AI Chat: ${a.ok?"Dostępny":"Ograniczony"}
💬 Naciśnij "Rozpocznij nagrywanie" aby zacząć`)}catch(r){console.error("Connection error:",r),r instanceof Error?r.name==="AbortError"?o("❌ Przekroczono czas połączenia - sprawdź internet"):o(`❌ Błąd połączenia: ${r.message}`):o("❌ Nieznany błąd podczas łączenia"),g(!1)}},v=()=>{const r="flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 transform hover:scale-105";return t?`${r} bg-red-500 hover:bg-red-600 text-white animate-pulse`:c?`${r} bg-green-500 hover:bg-green-600 text-white shadow-lg`:`${r} bg-blue-500 hover:bg-blue-600 text-white shadow-md`};return l.jsx("div",{className:"voice-ai-widget p-6 bg-gray-900/50 backdrop-blur-sm rounded-xl border border-gray-700",children:l.jsxs("div",{className:"text-center space-y-4",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"🎤 MyBonzo Voice AI"}),l.jsxs("button",{onClick:$,className:`${v()} w-full max-w-sm`,disabled:t,children:[c?l.jsx(L,{className:"w-5 h-5"}):l.jsx(O,{className:"w-5 h-5"}),c?"Połączony":"Połącz"]}),c&&l.jsxs("button",{onClick:t?b:z,className:v(),disabled:!c,children:[t?l.jsx(B,{className:"w-5 h-5"}):l.jsx(R,{className:"w-5 h-5"}),t?"Stop nagrywania":"Rozpocznij nagrywanie"]}),l.jsx("div",{className:"mt-4 p-3 bg-gray-800 rounded-lg border border-gray-600",children:l.jsx("p",{className:"text-gray-300 text-sm",children:m||'🎯 Naciśnij "Połącz" aby rozpocząć'})}),t&&l.jsx("div",{className:"flex justify-center items-center space-x-1 mt-4",children:[...Array(5)].map((r,e)=>l.jsx("div",{className:`w-2 bg-blue-400 rounded-full animate-pulse h-${4+e%3*2}`},e))})]})})}export{q as default};
