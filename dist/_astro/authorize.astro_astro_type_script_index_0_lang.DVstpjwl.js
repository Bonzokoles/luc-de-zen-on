let l=!1;document.addEventListener("DOMContentLoaded",()=>{u();const e=new URLSearchParams(window.location.search).get("code");e&&p(e)});async function u(){const t=document.getElementById("checkStatusBtn"),e=document.getElementById("driveConnectionStatus"),n=document.getElementById("driveDataAccess"),s=document.getElementById("lastSync");t&&(t.textContent="đź”„ Sprawdzanie..."),e&&(e.textContent="Sprawdzanie...");try{const a=await(await fetch("/api/recommendations/drive-status")).json();if(a.status==="success"&&a.drive.connected){if(e&&(e.textContent="POĹÄ„CZONY",e.className="status-value connected"),n&&(n.textContent=`${a.drive.usedSpace} / ${a.drive.totalSpace}`),s){const c=new Date(a.drive.lastSync);s.textContent=c.toLocaleString("pl-PL")}const i=document.getElementById("step1");i&&i.classList.add("completed");const r=document.getElementById("verifyBtn");r&&(r.disabled=!1)}else e&&(e.textContent="ROZĹÄ„CZONY",e.className="status-value disconnected"),n&&(n.textContent="Brak dostÄ™pu"),s&&(s.textContent="Nigdy")}catch(o){console.error("Error checking drive status:",o),e&&(e.textContent="BĹÄ„D",e.className="status-value disconnected")}finally{t&&(t.textContent="đź”„ SprawdĹş status")}}async function m(){if(l)return;l=!0;const t=document.getElementById("authorizeBtn");t&&(t.textContent="đź”„ Przekierowywanie...",t.disabled=!0);try{const n=await(await fetch("/api/auth/google/url")).json();if(n.authUrl)window.location.href=n.authUrl;else throw new Error("Failed to get authorization URL")}catch(e){console.error("Authorization error:",e),alert("BĹ‚Ä…d podczas autoryzacji: "+e.message),t&&(t.textContent="đź” Autoryzuj Google Drive",t.disabled=!1),l=!1}}async function p(t){console.log("Handling authorization callback with code:",t);try{const n=await(await fetch("/api/auth/google/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})})).json();if(n.success){const s=document.getElementById("step2");s&&s.classList.add("completed");const o=document.getElementById("verifyBtn");o&&(o.disabled=!1),setTimeout(()=>{f()},1e3)}else throw new Error(n.error||"Authorization failed")}catch(e){console.error("Callback handling error:",e),alert("BĹ‚Ä…d podczas przetwarzania autoryzacji: "+e.message)}}async function f(){const t=document.getElementById("verifyBtn"),e=document.getElementById("verificationResults");t&&(t.textContent="đź”„ Weryfikowanie...",t.disabled=!0);try{const s=await(await fetch("/api/recommendations/drive-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testTypes:["personal","business","technical"]})})).json();if(s.success){if(e){e.classList.remove("hidden");const r=document.getElementById("personalFiles"),c=document.getElementById("businessFiles"),d=document.getElementById("technicalFiles");r&&(r.textContent=`${s.results.personal.files} plikĂłw`),c&&(c.textContent=`${s.results.business.files} plikĂłw`),d&&(d.textContent=`${s.results.technical.files} plikĂłw`)}const o=document.getElementById("step3");o&&o.classList.add("completed");const a=document.getElementById("completionMessage");a&&a.classList.remove("hidden");const i=document.getElementById("step4");i&&i.classList.add("completed")}else throw new Error(s.error||"Verification failed")}catch(n){console.error("Verification error:",n),alert("BĹ‚Ä…d podczas weryfikacji: "+n.message)}finally{t&&(t.textContent="âś… Weryfikuj poĹ‚Ä…czenie",t.disabled=!1)}}async function y(){try{const e=await(await fetch("/api/recommendations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userProfile:"Test uĹĽytkownika - programista AI zainteresowany cloud computing",recommendationType:"technology",selectedModels:["gpt-4"],useGoogleDrive:!0,driveDataTypes:["personal","business"]})})).json();if(e.status==="success")alert("Test integracji zakoĹ„czony sukcesem! SprawdĹş konsolÄ™ dla szczegĂłĹ‚Ăłw."),console.log("Drive integration test results:",e);else throw new Error(e.error||"Test failed")}catch(t){console.error("Integration test error:",t),alert("BĹ‚Ä…d podczas testu integracji: "+t.message)}}window.checkDriveStatus=u;window.startAuthorization=m;window.verifyConnection=f;window.testDriveIntegration=y;
