const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/iesTextureLoader.B5ImPzjh.js","_astro/math.color.BvxHr_bk.js","_astro/ddsTextureLoader.BY24LCNS.js","_astro/engine.Bhq7AZzW.js","_astro/math.vector.C8FsJn6B.js","_astro/preload-helper.BlTxHScW.js","_astro/math.axis.BWIUWoG3.js","_astro/math.plane.DogzNArm.js","_astro/math.path.Rz-CSHk9.js","_astro/baseTexture.xJCKUhPX.js","_astro/math.size.F3xmSqZc.js","_astro/dds.CeNvnj7I.js","_astro/passPostProcess.C_qZ8mVx.js","_astro/postProcess.BhJOrjOy.js","_astro/texture.DcuyhkEj.js","_astro/instantiationTools.DpJ04vA6.js","_astro/smartArray.BsIpkRz3.js","_astro/math.viewport.CgkTt1RS.js","_astro/basisTextureLoader.DWkjOXED.js","_astro/tools.kgQOdK5j.js","_astro/envTextureLoader.CauFDrvC.js","_astro/scene.C9ljXyY7.js","_astro/light.Tpw1S7gS.js","_astro/node.B7U3vf9R.js","_astro/camera.DMMowNsy.js","_astro/math.frustum.0quBJc8n.js","_astro/dumpTools.BH_DO4LZ.js","_astro/hdrTextureLoader.CMy9M6PA.js","_astro/ktxTextureLoader.qGmt6mYl.js","_astro/tgaTextureLoader.B1Zo62PV.js","_astro/exrTextureLoader.5Jkf3uws.js"])))=>i.map(i=>d[i]);
import{O as x,E as P,P as it,M as rt,Q as nt,V as at,a as ot}from"./math.vector.C8FsJn6B.js";import{_ as H}from"./preload-helper.BlTxHScW.js";import{b as lt,a as ht}from"./math.color.BvxHr_bk.js";class ct{get wrapU(){return this._cachedWrapU}set wrapU(e){this._cachedWrapU=e}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}get wrapR(){return this._cachedWrapR}set wrapR(e){this._cachedWrapR=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get useMipMaps(){return this._useMipMaps}set useMipMaps(e){this._useMipMaps=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(e=1,t=1,s=1,r=1,n=2,a=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=s,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=n,this._comparisonFunction=a,this}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}var we;(function(i){i[i.Unknown=0]="Unknown",i[i.Url=1]="Url",i[i.Temp=2]="Temp",i[i.Raw=3]="Raw",i[i.Dynamic=4]="Dynamic",i[i.RenderTarget=5]="RenderTarget",i[i.MultiRenderTarget=6]="MultiRenderTarget",i[i.Cube=7]="Cube",i[i.CubeRaw=8]="CubeRaw",i[i.CubePrefiltered=9]="CubePrefiltered",i[i.Raw3D=10]="Raw3D",i[i.Raw2DArray=11]="Raw2DArray",i[i.DepthStencil=12]="DepthStencil",i[i.CubeRawRGBD=13]="CubeRawRGBD",i[i.Depth=14]="Depth"})(we||(we={}));class ce extends ct{get useMipMaps(){return this.generateMipMaps}set useMipMaps(e){this.generateMipMaps=e}get uniqueId(){return this._uniqueId}_setUniqueId(e){this._uniqueId=e}getEngine(){return this._engine}get source(){return this._source}constructor(e,t,s=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new x,this.onErrorObservable=new x,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=e,this._source=t,this._uniqueId=ce._Counter++,s||(this._hardwareTexture=e._createHardwareTexture())}incrementReferences(){this._references++}updateSize(e,t,s=1){this._engine.updateTextureDimensions(this,e,t,s),this.width=e,this.height=t,this.depth=s,this.baseWidth=e,this.baseHeight=t,this.baseDepth=s,this._size=e*t*s}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const t=this.onRebuildCallback(this),s=r=>{r._swapAndDie(this,!1),this.isReady=t.isReady};t.isAsync?t.proxy.then(s):s(t.proxy);return}let e;switch(this.source){case 2:break;case 1:e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,t=>{t._swapAndDie(this,!1),this.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer);return;case 3:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case 10:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 11:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 4:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,()=>{e._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null);return;case 8:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,t=>{t&&t._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension),e._sphericalPolynomial=this._sphericalPolynomial;return}}_swapAndDie(e,t=!0){this._hardwareTexture?.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);const s=this._engine.getLoadedTexturesCache();let r=s.indexOf(this);r!==-1&&s.splice(r,1),r=s.indexOf(e),r===-1&&s.push(e)}dispose(){this._references--,this._references===0&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}ce._Counter=0;class ut{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setEngine(e){this.engine=e}_fillEffectInformation(e,t,s,r,n,a,o,l){const u=this.engine;if(u.supportsUniformBuffers)for(const d in t)e.bindUniformBlock(d,t[d]);this.engine.getUniforms(this,s).forEach((d,_)=>{r[s[_]]=d}),this._uniforms=r;let c;for(c=0;c<n.length;c++)e.getUniform(n[c])==null&&(n.splice(c,1),c--);n.forEach((d,_)=>{a[d]=_});for(const d of u.getAttributes(this,o))l.push(d)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(e,t){const s=this._valueCache[e],r=t.updateFlag;return s!==void 0&&s===r?!1:(this._valueCache[e]=r,!0)}_cacheFloat2(e,t,s){let r=this._valueCache[e];if(!r||r.length!==2)return r=[t,s],this._valueCache[e]=r,!0;let n=!1;return r[0]!==t&&(r[0]=t,n=!0),r[1]!==s&&(r[1]=s,n=!0),n}_cacheFloat3(e,t,s,r){let n=this._valueCache[e];if(!n||n.length!==3)return n=[t,s,r],this._valueCache[e]=n,!0;let a=!1;return n[0]!==t&&(n[0]=t,a=!0),n[1]!==s&&(n[1]=s,a=!0),n[2]!==r&&(n[2]=r,a=!0),a}_cacheFloat4(e,t,s,r,n){let a=this._valueCache[e];if(!a||a.length!==4)return a=[t,s,r,n],this._valueCache[e]=a,!0;let o=!1;return a[0]!==t&&(a[0]=t,o=!0),a[1]!==s&&(a[1]=s,o=!0),a[2]!==r&&(a[2]=r,o=!0),a[3]!==n&&(a[3]=n,o=!0),o}setInt(e,t){const s=this._valueCache[e];s!==void 0&&s===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setInt2(e,t,s){this._cacheFloat2(e,t,s)&&(this.engine.setInt2(this._uniforms[e],t,s)||(this._valueCache[e]=null))}setInt3(e,t,s,r){this._cacheFloat3(e,t,s,r)&&(this.engine.setInt3(this._uniforms[e],t,s,r)||(this._valueCache[e]=null))}setInt4(e,t,s,r,n){this._cacheFloat4(e,t,s,r,n)&&(this.engine.setInt4(this._uniforms[e],t,s,r,n)||(this._valueCache[e]=null))}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setUInt(e,t){const s=this._valueCache[e];s!==void 0&&s===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt2(e,t,s){this._cacheFloat2(e,t,s)&&(this.engine.setUInt2(this._uniforms[e],t,s)||(this._valueCache[e]=null))}setUInt3(e,t,s,r){this._cacheFloat3(e,t,s,r)&&(this.engine.setUInt3(this._uniforms[e],t,s,r)||(this._valueCache[e]=null))}setUInt4(e,t,s,r,n){this._cacheFloat4(e,t,s,r,n)&&(this.engine.setUInt4(this._uniforms[e],t,s,r,n)||(this._valueCache[e]=null))}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setFloat(e,t){const s=this._valueCache[e];s!==void 0&&s===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}setFloat2(e,t,s){this._cacheFloat2(e,t,s)&&(this.engine.setFloat2(this._uniforms[e],t,s)||(this._valueCache[e]=null))}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}setFloat3(e,t,s,r){this._cacheFloat3(e,t,s,r)&&(this.engine.setFloat3(this._uniforms[e],t,s,r)||(this._valueCache[e]=null))}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setFloat4(e,t,s,r,n){this._cacheFloat4(e,t,s,r,n)&&(this.engine.setFloat4(this._uniforms[e],t,s,r,n)||(this._valueCache[e]=null))}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}setColor4(e,t,s){this._cacheFloat4(e,t.r,t.g,t.b,s)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,s)||(this._valueCache[e]=null))}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}const Pe={};function O(i,e=!1){if(!(e&&Pe[i]))return Pe[i]=!0,`${i} needs to be imported before as it contains a side-effect required by your code.`}function U(){return typeof window<"u"}function ft(){return typeof navigator<"u"}function ue(){return typeof document<"u"}function dt(i){let e="",t=i.firstChild;for(;t;)t.nodeType===3&&(e+=t.textContent),t=t.nextSibling;return e}const ne={};function _t(i,e,t=""){return t+(e?e+`
`:"")+i}function Me(i,e,t,s,r,n,a){const o=a||ne.loadFile;if(o)return o(i,e,t,s,r,n);throw O("FileTools")}function pt(i,e,t,s){if(i){e?i.IS_NDC_HALF_ZRANGE="":delete i.IS_NDC_HALF_ZRANGE,t?i.USE_REVERSE_DEPTHBUFFER="":delete i.USE_REVERSE_DEPTHBUFFER,s?i.USE_EXACT_SRGB_CONVERSIONS="":delete i.USE_EXACT_SRGB_CONVERSIONS;return}else{let r="";return e&&(r+="#define IS_NDC_HALF_ZRANGE"),t&&(r&&(r+=`
`),r+="#define USE_REVERSE_DEPTHBUFFER"),s&&(r&&(r+=`
`),r+="#define USE_EXACT_SRGB_CONVERSIONS"),r}}function us(i,e,t=!1,s){switch(i){case 3:return e instanceof ArrayBuffer?new Int8Array(e):new Int8Array(e);case 0:return e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e);case 4:return e instanceof ArrayBuffer?new Int16Array(e):new Int16Array(t?e/2:e);case 5:case 8:case 9:case 10:case 2:return e instanceof ArrayBuffer?new Uint16Array(e):new Uint16Array(t?e/2:e);case 6:return e instanceof ArrayBuffer?new Int32Array(e):new Int32Array(t?e/4:e);case 7:case 11:case 12:case 13:case 14:case 15:return e instanceof ArrayBuffer?new Uint32Array(e):new Uint32Array(t?e/4:e);case 1:return e instanceof ArrayBuffer?new Float32Array(e):new Float32Array(t?e/4:e)}return e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e)}const ge=new WeakMap,gt={_webGLVersion:2,cachedPipelines:{}};function N(i){let e=ge.get(i);if(!e){if(!i)return gt;e={_webGLVersion:i.TEXTURE_BINDING_3D?2:1,_context:i,parallelShaderCompile:i.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},ge.set(i,e)}return e}function fs(i){ge.delete(i)}function mt(i,e,t,s,r,n){const a=N(s);n||(n=a._createShaderProgramInjection??Ue);const o=me(e,"vertex",s,a._contextWasLost),l=me(t,"fragment",s,a._contextWasLost);return n(i,o,l,s,r,a.validateShaderPrograms)}function Ct(i,e,t,s,r,n=null,a){const o=N(r);a||(a=o._createShaderProgramInjection??Ue);const l=o._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",u=De(e,"vertex",s,l,r,o._contextWasLost),h=De(t,"fragment",s,l,r,o._contextWasLost);return a(i,u,h,r,n,o.validateShaderPrograms)}function ds(i,e){const t=new ut,s=N(i);return s.parallelShaderCompile&&!s.disableParallelShaderCompile&&(t.isParallelCompiled=!0),t.context=s._context,t}function Ue(i,e,t,s,r=null,n){const a=s.createProgram();if(i.program=a,!a)throw new Error("Unable to create program");return s.attachShader(a,e),s.attachShader(a,t),s.linkProgram(a),i.context=s,i.vertexShader=e,i.fragmentShader=t,i.isParallelCompiled||Ie(i,s,n),a}function _s(i,e,t){const s=i;if(s._isDisposed)return!1;const r=N(e);return r&&r.parallelShaderCompile&&r.parallelShaderCompile.COMPLETION_STATUS_KHR&&s.program&&e.getProgramParameter(s.program,r.parallelShaderCompile.COMPLETION_STATUS_KHR)?(Ie(s,e,t),!0):!1}function Ie(i,e,t){const s=i.context,r=i.vertexShader,n=i.fragmentShader,a=i.program;if(!s.getProgramParameter(a,s.LINK_STATUS)){if(!e.getShaderParameter(r,e.COMPILE_STATUS)){const u=e.getShaderInfoLog(r);if(u)throw i.vertexCompilationError=u,new Error("VERTEX SHADER "+u)}if(!e.getShaderParameter(n,e.COMPILE_STATUS)){const u=e.getShaderInfoLog(n);if(u)throw i.fragmentCompilationError=u,new Error("FRAGMENT SHADER "+u)}const l=s.getProgramInfoLog(a);if(l)throw i.programLinkError=l,new Error(l)}if(t&&(s.validateProgram(a),!s.getProgramParameter(a,s.VALIDATE_STATUS))){const u=s.getProgramInfoLog(a);if(u)throw i.programValidationError=u,new Error(u)}s.deleteShader(r),s.deleteShader(n),i.vertexShader=void 0,i.fragmentShader=void 0,i.onCompiled&&(i.onCompiled(),i.onCompiled=void 0)}function ps(i,e,t,s,r,n,a,o,l,u="",h,c,d){const _=N(i.context);c||(c=_.createRawShaderProgramInjection??mt),d||(d=_.createShaderProgramInjection??Ct);const C=i;s?C.program=c(C,e,t,C.context,l):C.program=d(C,e,t,o,C.context,l),C.program.__SPECTOR_rebuildProgram=a,h()}function De(i,e,t,s,r,n){return me(_t(i,t,s),e,r,n)}function me(i,e,t,s){const r=t.createShader(e==="vertex"?t.VERTEX_SHADER:t.FRAGMENT_SHADER);if(!r){let n=t.NO_ERROR,a=t.NO_ERROR;for(;(a=t.getError())!==t.NO_ERROR;)n=a;throw new Error(`Something went wrong while creating a gl ${e} shader object. gl error=${n}, gl isContextLost=${t.isContextLost()}, _contextWasLost=${s}`)}return t.shaderSource(r,i),t.compileShader(r),r}function gs(i,e){e.useProgram(i)}function ms(i,e){const t=i;if(!t.isParallelCompiled){e(i);return}const s=t.onCompiled;t.onCompiled=()=>{s?.(),e(i)}}class f{static _CheckLimit(e,t){let s=f._LogLimitOutputs[e];return s?s.current++:(s={limit:t,current:1},f._LogLimitOutputs[e]=s),s.current<=s.limit}static _GenerateLimitMessage(e,t=1){const s=f._LogLimitOutputs[e];if(!s||!f.MessageLimitReached)return;const r=this._Levels[t];s.current===s.limit&&f[r.name](f.MessageLimitReached.replace(/%LIMIT%/g,""+s.limit).replace(/%TYPE%/g,r.name??""))}static _AddLogEntry(e){f._LogCache=e+f._LogCache,f.OnNewCacheEntry&&f.OnNewCacheEntry(e)}static _FormatMessage(e){const t=r=>r<10?"0"+r:""+r,s=new Date;return"["+t(s.getHours())+":"+t(s.getMinutes())+":"+t(s.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(e=1,t,s){const r=Array.isArray(t)?t[0]:t;if(s!==void 0&&!f._CheckLimit(r,s))return;const n=f._FormatMessage(r),a=this._Levels[e],o=Array.isArray(t)?t.slice(1):[];a.logFunc&&a.logFunc("BJS - "+n,...o);const l=`<div style='color:${a.color}'>${n}</div><br>`;f._AddLogEntry(l),f._GenerateLimitMessage(r,e)}static get LogCache(){return f._LogCache}static ClearLogCache(){f._LogCache="",f._LogLimitOutputs={},f.errorsCount=0}static set LogLevels(e){f.Log=f._LogDisabled,f.Warn=f._LogDisabled,f.Error=f._LogDisabled;const t=[f.MessageLogLevel,f.WarningLogLevel,f.ErrorLogLevel];for(const s of t)if((e&s)===s){const r=this._Levels[s];f[r.name]=f._LogEnabled.bind(f,s)}}}f.NoneLogLevel=0;f.MessageLogLevel=1;f.WarningLogLevel=2;f.ErrorLogLevel=4;f.AllLogLevel=7;f.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.";f._LogCache="";f._LogLimitOutputs={};f._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}];f.errorsCount=0;f.Log=f._LogEnabled.bind(f,f.MessageLogLevel);f.Warn=f._LogEnabled.bind(f,f.WarningLogLevel);f.Error=f._LogEnabled.bind(f,f.ErrorLogLevel);function Cs(i){let e=1;do e*=2;while(e<i);return e===i}function bs(i,e,t){return i*(1-t)+e*t}function bt(i){const e=Ve(i),t=He(i);return e-i>i-t?t:e}function Ve(i){return i--,i|=i>>1,i|=i>>2,i|=i>>4,i|=i>>8,i|=i>>16,i++,i}function He(i){return i=i|i>>1,i=i|i>>2,i=i|i>>4,i=i|i>>8,i=i|i>>16,i-(i>>1)}function ys(i,e,t=2){let s;switch(t){case 1:s=He(i);break;case 2:s=bt(i);break;case 3:default:s=Ve(i);break}return Math.min(s,e)}class F{static GetShadersRepository(e=0){return e===0?F.ShadersRepository:F.ShadersRepositoryWGSL}static GetShadersStore(e=0){return e===0?F.ShadersStore:F.ShadersStoreWGSL}static GetIncludesShadersStore(e=0){return e===0?F.IncludesShadersStore:F.IncludesShadersStoreWGSL}}F.ShadersRepository="src/Shaders/";F.ShadersStore={};F.IncludesShadersStore={};F.ShadersRepositoryWGSL="src/ShadersWGSL/";F.ShadersStoreWGSL={};F.IncludesShadersStoreWGSL={};const yt="attribute",St="varying";class Q{constructor(){this.children=[]}isValid(e){return!0}process(e,t,s){let r="";if(this.line){let n=this.line;const a=t.processor;if(a){a.lineProcessor&&(n=a.lineProcessor(n,t.isFragment,t.processingContext));const o=t.processor?.attributeKeywordName??yt,l=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:St;!t.isFragment&&a.attributeProcessor&&this.line.startsWith(o)?n=a.attributeProcessor(this.line,e,t.processingContext):a.varyingProcessor&&(a.varyingCheck?.(this.line,t.isFragment)||!a.varyingCheck&&this.line.startsWith(l))?n=a.varyingProcessor(this.line,t.isFragment,e,t.processingContext):a.uniformProcessor&&a.uniformRegexp&&a.uniformRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(n=a.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):a.uniformBufferProcessor&&a.uniformBufferRegexp&&a.uniformBufferRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(n=a.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0):a.textureProcessor&&a.textureRegexp&&a.textureRegexp.test(this.line)?n=a.textureProcessor(this.line,t.isFragment,e,t.processingContext):(a.uniformProcessor||a.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?a.uniformProcessor&&(n=a.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):a.uniformBufferProcessor&&(n=a.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(t.lookForClosingBracketForUniformBuffer=!1,a.endOfUniformBufferProcessor&&(n=a.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}r+=n+`
`}for(const n of this.children)r+=n.process(e,t,s);return this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true",s[this.additionalDefineKey]=e[this.additionalDefineKey]),r}}class xt{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){this._lines.length=0;for(const t of e){if(!t||t==="\r")continue;if(t[0]==="#"){this._lines.push(t);continue}const s=t.trim();if(!s)continue;if(s.startsWith("//")){this._lines.push(t);continue}const r=s.indexOf(";");if(r===-1)this._lines.push(s);else if(r===s.length-1)s.length>1&&this._lines.push(s);else{const n=t.split(";");for(let a=0;a<n.length;a++){let o=n[a];o&&(o=o.trim(),o&&this._lines.push(o+(a!==n.length-1?";":"")))}}}}}class fe extends Q{process(e,t,s){for(let r=0;r<this.children.length;r++){const n=this.children[r];if(n.isValid(e))return n.process(e,t,s)}return""}}class Ft extends Q{isValid(e){return this.testExpression.isTrue(e)}}class b{isTrue(e){return!0}static postfixToInfix(e){const t=[];for(const s of e)if(b._OperatorPriority[s]===void 0)t.push(s);else{const r=t[t.length-1],n=t[t.length-2];t.length-=2,t.push(`(${n}${s}${r})`)}return t[t.length-1]}static infixToPostfix(e){const t=b._InfixToPostfixCache.get(e);if(t)return t.accessTime=Date.now(),t.result;if(!e.includes("&&")&&!e.includes("||")&&!e.includes(")")&&!e.includes("("))return[e];const s=[];let r=-1;const n=()=>{h=h.trim(),h!==""&&(s.push(h),h="")},a=c=>{r<b._Stack.length-1&&(b._Stack[++r]=c)},o=()=>b._Stack[r],l=()=>r===-1?"!!INVALID EXPRESSION!!":b._Stack[r--];let u=0,h="";for(;u<e.length;){const c=e.charAt(u),d=u<e.length-1?e.substring(u,2+u):"";if(c==="(")h="",a(c);else if(c===")"){for(n();r!==-1&&o()!=="(";)s.push(l());l()}else if(b._OperatorPriority[d]>1){for(n();r!==-1&&b._OperatorPriority[o()]>=b._OperatorPriority[d];)s.push(l());a(d),u++}else h+=c;u++}for(n();r!==-1;)o()==="("?l():s.push(l());return b._InfixToPostfixCache.size>=b.InfixToPostfixCacheLimitSize&&b.ClearCache(),b._InfixToPostfixCache.set(e,{result:s,accessTime:Date.now()}),s}static ClearCache(){const e=Array.from(b._InfixToPostfixCache.entries()).sort((t,s)=>t[1].accessTime-s[1].accessTime);for(let t=0;t<b.InfixToPostfixCacheCleanupSize;t++)b._InfixToPostfixCache.delete(e[t][0])}}b.InfixToPostfixCacheLimitSize=5e4;b.InfixToPostfixCacheCleanupSize=25e3;b._InfixToPostfixCache=new Map;b._OperatorPriority={")":0,"(":1,"||":2,"&&":3};b._Stack=["","","","","","","","","","","","","","","","","","","",""];class ae extends b{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=e[this.define]!==void 0;return this.not&&(t=!t),t}}class vt extends b{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class Rt extends b{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class wt extends b{constructor(e,t,s){super(),this.define=e,this.operand=t,this.testValue=s}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(e){let t=!1;const s=parseInt(e[this.define]!=null?e[this.define]:this.define),r=parseInt(e[this.testValue]!=null?e[this.testValue]:this.testValue);if(isNaN(s)||isNaN(r))return!1;switch(this.operand){case">":t=s>r;break;case"<":t=s<r;break;case"<=":t=s<=r;break;case">=":t=s>=r;break;case"==":t=s===r;break;case"!=":t=s!==r;break}return t}}const Pt=/defined\s*?\((.+?)\)/g,de=/defined\s*?\[(.+?)\]/g,Dt=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,At=/__decl__/,Ae=/light\{X\}.(\w*)/g,Ee=/\{X\}/g,ee=[],Et=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function Tt(i){i.processor&&i.processor.initializeShaders&&i.processor.initializeShaders(i.processingContext)}function Te(i,e,t,s){e.processor?.preProcessShaderCode&&(i=e.processor.preProcessShaderCode(i,e.isFragment)),be(i,e,r=>{e.processCodeAfterIncludes&&(r=e.processCodeAfterIncludes(e.isFragment?"fragment":"vertex",r,e.defines));const n=Ut(r,e,s);t(n,r)})}function Lt(i,e,t){return!t.processor||!t.processor.finalizeShaders?{vertexCode:i,fragmentCode:e}:t.processor.finalizeShaders(i,e,t.processingContext)}function Ot(i,e){if(e.processor?.noPrecision)return i;const t=e.shouldUseHighPrecisionShader;return i.indexOf("precision highp float")===-1?t?i=`precision highp float;
`+i:i=`precision mediump float;
`+i:t||(i=i.replace("precision highp float","precision mediump float")),i}function _e(i){const t=/defined\((.+)\)/.exec(i);if(t&&t.length)return new ae(t[1].trim(),i[0]==="!");const s=["==","!=",">=","<=","<",">"];let r="",n=0;for(r of s)if(n=i.indexOf(r),n>-1)break;if(n===-1)return new ae(i);const a=i.substring(0,n).trim(),o=i.substring(n+r.length).trim();return new wt(a,r,o)}function kt(i){i=i.replace(Pt,"defined[$1]");const e=b.infixToPostfix(i),t=[];for(const r of e)if(r!=="||"&&r!=="&&")t.push(r);else if(t.length>=2){let n=t[t.length-1],a=t[t.length-2];t.length-=2;const o=r=="&&"?new Rt:new vt;typeof n=="string"&&(n=n.replace(de,"defined($1)")),typeof a=="string"&&(a=a.replace(de,"defined($1)")),o.leftOperand=typeof a=="string"?_e(a):a,o.rightOperand=typeof n=="string"?_e(n):n,t.push(o)}let s=t[t.length-1];return typeof s=="string"&&(s=s.replace(de,"defined($1)")),typeof s=="string"?_e(s):s}function ie(i,e){const t=new Ft,s=i.substring(0,e);let r=i.substring(e);return r=r.substring(0,(r.indexOf("//")+1||r.length+1)-1).trim(),s==="#ifdef"?t.testExpression=new ae(r):s==="#ifndef"?t.testExpression=new ae(r,!0):t.testExpression=kt(r),t}function pe(i,e,t,s){let r=i.currentLine;for(;Ce(i,t);){r=i.currentLine;const n=r.substring(0,5).toLowerCase();if(n==="#else"){const a=new Q;e.children.push(a),Ce(i,a);return}else if(n==="#elif"){const a=ie(r,5);e.children.push(a),t=a}}}function Ce(i,e,t){for(;i.canRead;){i.lineIndex++;const s=i.currentLine;if(s.indexOf("#")>=0){const n=Et.exec(s);if(n&&n.length){switch(n[0]){case"#ifdef":{const o=new fe;e.children.push(o);const l=ie(s,6);o.children.push(l),pe(i,o,l);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const o=new fe;e.children.push(o);const l=ie(s,7);o.children.push(l),pe(i,o,l);break}case"#if":{const o=new fe,l=ie(s,3);e.children.push(o),o.children.push(l),pe(i,o,l);break}}continue}}const r=new Q;if(r.line=s,e.children.push(r),s[0]==="#"&&s[1]==="d"){const n=s.replace(";","").split(" ");r.additionalDefineKey=n[1],n.length===3&&(r.additionalDefineValue=n[2])}}return!1}function Bt(i,e,t,s){const r=new Q,n=new xt;return n.lineIndex=-1,n.lines=i.split(`
`),Ce(n,r),r.process(e,t,s)}function Mt(i,e){const t=i.defines,s={};for(const r of t){const a=r.replace("#define","").replace(";","").trim().split(" ");s[a[0]]=a.length>1?a[1]:""}return i.processor?.shaderLanguage===0&&(s.GL_ES="true"),s.__VERSION__=i.version,s[i.platformName]="true",pt(s,e?.isNDCHalfZRange,e?.useReverseDepthBuffer,e?.useExactSrgbConversions),s}function Ut(i,e,t){let s=Ot(i,e);if(!e.processor||e.processor.shaderLanguage===0&&s.indexOf("#version 3")!==-1&&(s=s.replace("#version 300 es",""),!e.processor.parseGLES3))return s;const r=e.defines,n=Mt(e,t);e.processor.preProcessor&&(s=e.processor.preProcessor(s,r,n,e.isFragment,e.processingContext));const a={};return s=Bt(s,n,e,a),e.processor.postProcessor&&(s=e.processor.postProcessor(s,r,e.isFragment,e.processingContext,t?{drawBuffersExtensionDisabled:!t.getCaps().drawBuffersExtension}:{},n,a)),t?._features.needShaderCodeInlining&&(s=t.inlineShaderCode(s)),s}function be(i,e,t){ee.length=0;let s;for(;(s=Dt.exec(i))!==null;)ee.push(s);let r=String(i),n=[i],a=!1;for(const o of ee){let l=o[1];if(l.indexOf("__decl__")!==-1&&(l=l.replace(At,""),e.supportsUniformBuffers&&(l=l.replace("Vertex","Ubo").replace("Fragment","Ubo")),l=l+"Declaration"),e.includesShadersStore[l]){let u=e.includesShadersStore[l];if(o[2]){const c=o[3].split(",");for(let d=0;d<c.length;d+=2){const _=new RegExp(c[d],"g"),C=c[d+1];u=u.replace(_,C)}}if(o[4]){const c=o[5];if(c.indexOf("..")!==-1){const d=c.split(".."),_=parseInt(d[0]);let C=parseInt(d[1]),S=u.slice(0);u="",isNaN(C)&&(C=e.indexParameters[d[1]]);for(let g=_;g<C;g++)e.supportsUniformBuffers||(S=S.replace(Ae,(R,M)=>M+"{X}")),u+=S.replace(Ee,g.toString())+`
`}else e.supportsUniformBuffers||(u=u.replace(Ae,(d,_)=>_+"{X}")),u=u.replace(Ee,c)}const h=[];for(const c of n){const d=c.split(o[0]);for(let _=0;_<d.length-1;_++)h.push(d[_]),h.push(u);h.push(d[d.length-1])}n=h,a=a||u.indexOf("#include<")>=0||u.indexOf("#include <")>=0}else{const u=e.shadersRepository+"ShadersInclude/"+l+".fx";We.loadFile(u,h=>{e.includesShadersStore[l]=h,be(n.join(""),e,t)});return}}ee.length=0,r=n.join(""),a?be(r.toString(),e,t):t(r)}const We={loadFile:(i,e,t,s,r,n)=>{throw O("FileTools")}};function It(i,e){return N(e).cachedPipelines[i]}function Vt(i){const e=i._name,t=i.context;if(e&&t){const s=N(t);s.cachedPipelines[e]?.dispose(),delete s.cachedPipelines[e]}}function Ht(i,e,t,s,r,n,a){let o,l;const u=U()?n?.getHostDocument():null;typeof e=="string"?o=e:e.vertexSource?o="source:"+e.vertexSource:e.vertexElement?o=u?.getElementById(e.vertexElement)||e.vertexElement:o=e.vertex||e,typeof e=="string"?l=e:e.fragmentSource?l="source:"+e.fragmentSource:e.fragmentElement?l=u?.getElementById(e.fragmentElement)||e.fragmentElement:l=e.fragment||e;const h=[void 0,void 0],c=()=>{if(h[0]&&h[1]){i.isFragment=!0;const[d,_]=h;Te(_,i,(C,S)=>{a&&(a._fragmentSourceCodeBeforeMigration=S),t&&(C=t("fragment",C));const g=Lt(d,C,i);i=null;const R=Wt(g.vertexCode,g.fragmentCode,e,r);s?.(R.vertexSourceCode,R.fragmentSourceCode)},n)}};Le(o,"Vertex","",d=>{Tt(i),Te(d,i,(_,C)=>{a&&(a._rawVertexSourceCode=d,a._vertexSourceCodeBeforeMigration=C),t&&(_=t("vertex",_)),h[0]=_,c()},n)},r),Le(l,"Fragment","Pixel",d=>{a&&(a._rawFragmentSourceCode=d),h[1]=d,c()},r)}function Le(i,e,t,s,r,n){if(typeof HTMLElement<"u"&&i instanceof HTMLElement){const l=dt(i);s(l);return}if(i.substring(0,7)==="source:"){s(i.substring(7));return}if(i.substring(0,7)==="base64:"){const l=window.atob(i.substring(7));s(l);return}const a=F.GetShadersStore(r);if(a[i+e+"Shader"]){s(a[i+e+"Shader"]);return}if(t&&a[i+t+"Shader"]){s(a[i+t+"Shader"]);return}let o;if(i[0]==="."||i[0]==="/"||i.indexOf("http")>-1?o=i:o=F.GetShadersRepository(r)+i,n=n||Me,!n)throw new Error("loadFileInjection is not defined");n(o+"."+e.toLowerCase()+".fx",s)}function Wt(i,e,t,s){if(t){const r=t.vertexElement||t.vertex||t.spectorName||t,n=t.fragmentElement||t.fragment||t.spectorName||t;return{vertexSourceCode:(s===1?"//":"")+"#define SHADER_NAME vertex:"+r+`
`+i,fragmentSourceCode:(s===1?"//":"")+"#define SHADER_NAME fragment:"+n+`
`+e}}else return{vertexSourceCode:i,fragmentSourceCode:e}}const Gt=(i,e,t,s)=>{try{const r=i.context?N(i.context):null;r&&(r.disableParallelShaderCompile=i.disableParallelCompilation);const n=i.existingPipelineContext||e(i.shaderProcessingContext);return n._name=i.name,i.name&&r&&(r.cachedPipelines[i.name]=n),t(n,i.vertex,i.fragment,!!i.createAsRaw,"","",i.rebuildRebind,i.defines,i.transformFeedbackVaryings,"",()=>{s(n,()=>{i.onRenderingStateCompiled?.(n)})}),n}catch(r){throw f.Error("Error compiling effect"),r}};let te=[];class Nt{static SetImmediate(e){te.length===0&&setTimeout(()=>{const t=te;te=[];for(const s of t)s()},1),te.push(e)}}function Oe(i,e,t){try{if(i())return e(),!0}catch(s){return t?.(s),!0}return!1}const qt=(i,e,t,s=16,r=3e4,n=!0,a)=>{if(n&&Oe(i,e,t))return null;const o=setInterval(()=>{Oe(i,e,t)?clearInterval(o):(r-=s,r<0&&(clearInterval(o),t?.(new Error("Operation timed out after maximum retries. "+(a||"")),!0)))},s);return()=>clearInterval(o)};class w{static get ShadersRepository(){return F.ShadersRepository}static set ShadersRepository(e){F.ShadersRepository=e}get isDisposed(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new x),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,s,r=null,n,a=null,o=null,l=null,u=null,h,c="",d=0,_){this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new x,this.onErrorObservable=new x,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=e,this._key=c;const C=this._key.replace(/\r/g,"").replace(/\n/g,"|");let S;if(t.attributes){const g=t;if(this._engine=s,this._attributesNames=g.attributes,this._uniformsNames=g.uniformsNames.concat(g.samplers),this._samplerList=g.samplers.slice(),this.defines=g.defines,this.onError=g.onError,this.onCompiled=g.onCompiled,this._fallbacks=g.fallbacks,this._indexParameters=g.indexParameters,this._transformFeedbackVaryings=g.transformFeedbackVaryings||null,this._multiTarget=!!g.multiTarget,this._shaderLanguage=g.shaderLanguage??0,this._disableParallelShaderCompilation=!!g.disableParallelShaderCompilation,g.uniformBuffersNames){this._uniformBuffersNamesList=g.uniformBuffersNames.slice();for(let R=0;R<g.uniformBuffersNames.length;R++)this._uniformBuffersNames[g.uniformBuffersNames[R]]=R}this._processFinalCode=g.processFinalCode??null,this._processCodeAfterIncludes=g.processCodeAfterIncludes??void 0,_=g.extraInitializationsAsync,S=g.existingPipelineContext}else this._engine=n,this.defines=a??"",this._uniformsNames=s.concat(r),this._samplerList=r?r.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=d,this.onError=u,this.onCompiled=l,this._indexParameters=h,this._fallbacks=o;this._engine.shaderPlatformName==="WEBGL2"&&(S=It(C,this._engine._gl)??S),this._attributeLocationByName={},this.uniqueId=w._UniqueIdSeed++,S?(this._pipelineContext=S,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,_),this._engine.onReleaseEffectsObservable.addOnce(()=>{this.isDisposed||this.dispose(!0)})}async _processShaderCodeAsync(e=null,t=!1,s=null,r){r&&await r(),this._processingContext=s||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const n={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:F.GetShadersRepository(this._shaderLanguage),includesShadersStore:F.GetIncludesShadersStore(this._shaderLanguage),version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};Ht(n,this.name,this._processFinalCode,(a,o)=>{this._vertexSourceCode=a,this._fragmentSourceCode=o,this._prepareEffect(t)},this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return this._engine.isDisposed||this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(e){return this._attributes[e]}getAttributeLocationByName(e){return this._attributeLocationByName[e]}getAttributesCount(){return this._attributes.length}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getUniform(e){return this._uniforms[e]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise(e=>{this.executeWhenCompiled(e)})}executeWhenCompiled(e){if(this.isReady()){e(this);return}this.onCompileObservable.add(t=>{e(t)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&this._checkIsReady(null)}_checkIsReady(e){qt(()=>this._isReadyInternal()||this._isDisposed,()=>{},t=>{this._processCompilationErrors(t,e)},16,12e4,!0,` - Effect: ${typeof this.name=="string"?this.name:this.key}`)}get vertexSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}get fragmentSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split(`
`),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!!(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride)}}}_rebuildProgram(e,t,s,r){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(n,a)=>{r&&r(a)},this.onCompiled=()=>{const n=this.getEngine().scenes;if(n)for(let a=0;a<n.length;a++)n[a].markAllMaterialsAsDirty(127);this._pipelineContext._handlesSpectorRebuildCallback?.(s)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(e){if(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let t=0;t<this._attributesNames.length;t++){const s=this._attributesNames[t];this._attributeLocationByName[s]=this._attributes[t]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),w.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(e=!1){const t=this._pipelineContext;this._isReady=!1;try{const s=!!(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride),r=s?null:this.defines,n=s?this._vertexSourceCodeOverride:this._vertexSourceCode,a=s?this._fragmentSourceCodeOverride:this._fragmentSourceCode,o=this._engine;this._pipelineContext=Gt({existingPipelineContext:e?t:null,vertex:n,fragment:a,context:o.shaderPlatformName==="WEBGL2"||o.shaderPlatformName==="WEBGL1"?o._gl:void 0,rebuildRebind:(l,u,h,c)=>this._rebuildProgram(l,u,h,c),defines:r,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:s,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:l=>{t&&!e&&this._engine._deletePipelineContext(t),l&&this._onRenderingStateCompiled(l)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(s){this._processCompilationErrors(s,t)}}_getShaderCodeAndErrorLine(e,t,s){const r=s?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let n=null;if(t&&e){const a=t.match(r);if(a&&a.length===2){const o=parseInt(a[1]),l=e.split(`
`,-1);l.length>=o&&(n=`Offending line [${o}] in ${s?"fragment":"vertex"} code: ${l[o-1]}`)}}return[e,n]}_processCompilationErrors(e,t=null){this._compilationError=e.message;const s=this._attributesNames,r=this._fallbacks;if(f.Error("Unable to compile effect:"),f.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),f.Error(`Attributes: ${s.join(" ")}`),f.Error(`Defines:
`+this.defines),w.LogShaderCodeOnCompilationError){let a=null,o=null,l=null;this._pipelineContext?._getVertexShaderCode()&&([l,a]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),l&&(f.Error("Vertex code:"),f.Error(l))),this._pipelineContext?._getFragmentShaderCode()&&([l,o]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),l&&(f.Error("Fragment code:"),f.Error(l))),a&&f.Error(a),o&&f.Error(o)}f.Error("Error: "+this._compilationError);const n=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};t&&(this._pipelineContext=t,this._isReady=!0,n()),r?(this._pipelineContext=null,r.hasMoreFallbacks?(this._allFallbacksProcessed=!1,f.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,n(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,t||n())}get isSupported(){return this._compilationError===""}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setTextureArray(e,t){const s=e+"Ex";if(this._samplerList.indexOf(s+"0")===-1){const r=this._samplerList.indexOf(e);for(let a=1;a<t.length;a++){const o=s+(a-1).toString();this._samplerList.splice(r+a,0,o)}let n=0;for(const a of this._samplerList)this._samplers[a]=n,n+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}bindUniformBuffer(e,t){const s=this._uniformBuffersNames[t];s===void 0||w._BaseCache[s]===e&&this._engine._features.useUBOBindingCache||(w._BaseCache[s]=e,this._engine.bindUniformBufferBase(e,s,t))}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}setInt2(e,t,s){return this._pipelineContext.setInt2(e,t,s),this}setInt3(e,t,s,r){return this._pipelineContext.setInt3(e,t,s,r),this}setInt4(e,t,s,r,n){return this._pipelineContext.setInt4(e,t,s,r,n),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUInt2(e,t,s){return this._pipelineContext.setUInt2(e,t,s),this}setUInt3(e,t,s,r){return this._pipelineContext.setUInt3(e,t,s,r),this}setUInt4(e,t,s,r,n){return this._pipelineContext.setUInt4(e,t,s,r,n),this}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}setFloat2(e,t,s){return this._pipelineContext.setFloat2(e,t,s),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setFloat3(e,t,s,r){return this._pipelineContext.setFloat3(e,t,s,r),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat4(e,t,s,r,n){return this._pipelineContext.setFloat4(e,t,s,r,n),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setColor4(e,t,s){return this._pipelineContext.setColor4(e,t,s),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(e=!1){if(e)this._refCount=0;else{if(w.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&Vt(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(e,t,s,r=0){t&&(F.GetShadersStore(r)[`${e}PixelShader`]=t),s&&(F.GetShadersStore(r)[`${e}VertexShader`]=s)}static ResetCache(){w._BaseCache={}}}w.LogShaderCodeOnCompilationError=!0;w.PersistentMode=!1;w.AutomaticallyClearCodeCache=!1;w._UniqueIdSeed=0;w._BaseCache={};w.ShadersStore=F.ShadersStore;w.IncludesShadersStore=F.IncludesShadersStore;class $t{static get Now(){return U()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}class Yt{constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class Xt{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get backFunc(){return this._func}set backFunc(e){this._backFunc!==e&&(this._backFunc=e,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get backOpStencilFail(){return this._backOpStencilFail}set backOpStencilFail(e){this._backOpStencilFail!==e&&(this._backOpStencilFail=e,this._isStencilOpDirty=!0)}get backOpDepthFail(){return this._backOpDepthFail}set backOpDepthFail(e){this._backOpDepthFail!==e&&(this._backOpDepthFail=e,this._isStencilOpDirty=!0)}get backOpStencilDepthPass(){return this._backOpStencilDepthPass}set backOpStencilDepthPass(e){this._backOpStencilDepthPass!==e&&(this._backOpStencilDepthPass=e,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}reset(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(e){if(!e)return;const t=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.backFunc=t?this.stencilMaterial.backFunc:this.stencilGlobal.backFunc,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.backOpStencilFail=t?this.stencilMaterial.backOpStencilFail:this.stencilGlobal.backOpStencilFail,this.backOpDepthFail=t?this.stencilMaterial.backOpDepthFail:this.stencilGlobal.backOpDepthFail,this.backOpStencilDepthPass=t?this.stencilMaterial.backOpStencilDepthPass:this.stencilGlobal.backOpStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFuncSeparate(e.FRONT,this.func,this.funcRef,this.funcMask),e.stencilFuncSeparate(e.BACK,this.backFunc,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOpSeparate(e.FRONT,this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),e.stencilOpSeparate(e.BACK,this.backOpStencilFail,this.backOpDepthFail,this.backOpStencilDepthPass),this._isStencilOpDirty=!1))}}class L{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.funcRef=1,this.funcMask=255,this.func=L.ALWAYS,this.opStencilFail=L.KEEP,this.opDepthFail=L.KEEP,this.opStencilDepthPass=L.REPLACE,this.backFunc=L.ALWAYS,this.backOpStencilFail=L.KEEP,this.backOpDepthFail=L.KEEP,this.backOpStencilDepthPass=L.REPLACE}get stencilFunc(){return this.func}set stencilFunc(e){this.func=e}get stencilBackFunc(){return this.backFunc}set stencilBackFunc(e){this.backFunc=e}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(e){this.funcRef=e}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(e){this.funcMask=e}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilBackOpStencilFail(){return this.backOpStencilFail}set stencilBackOpStencilFail(e){this.backOpStencilFail=e}get stencilBackOpDepthFail(){return this.backOpDepthFail}set stencilBackOpDepthFail(e){this.backOpDepthFail=e}get stencilBackOpStencilDepthPass(){return this.backOpStencilDepthPass}set stencilBackOpStencilDepthPass(e){this.backOpStencilDepthPass=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}get stencilTest(){return this.enabled}set stencilTest(e){this.enabled=e}}L.ALWAYS=519;L.KEEP=7680;L.REPLACE=7681;class Kt{constructor(e){this._supportBlendParametersPerTarget=e,this._blendFunctionParameters=new Array(32),this._blendEquationParameters=new Array(16),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=Array(8).fill(!1),this._numTargetEnabled=0,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._numTargetEnabled>0}setAlphaBlend(e,t=0){this._alphaBlend[t]!==e&&(e?this._numTargetEnabled++:this._numTargetEnabled--,this._alphaBlend[t]=e,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(e,t,s,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===s&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=s,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(e,t,s,r,n=0){const a=n*4;this._blendFunctionParameters[a+0]===e&&this._blendFunctionParameters[a+1]===t&&this._blendFunctionParameters[a+2]===s&&this._blendFunctionParameters[a+3]===r||(this._blendFunctionParameters[a+0]=e,this._blendFunctionParameters[a+1]=t,this._blendFunctionParameters[a+2]=s,this._blendFunctionParameters[a+3]=r,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(e,t,s=0){const r=s*2;this._blendEquationParameters[r+0]===e&&this._blendEquationParameters[r+1]===t||(this._blendEquationParameters[r+0]=e,this._blendEquationParameters[r+1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend.fill(!1),this._numTargetEnabled=0,this._blendFunctionParameters.fill(null),this._blendEquationParameters.fill(null),this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e,t=1){if(!this.isDirty)return;if(this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1),t===1||!this._supportBlendParametersPerTarget){this._isAlphaBlendDirty&&(this._alphaBlend[0]?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1);return}const s=e;if(this._isAlphaBlendDirty){for(let r=0;r<t;r++){const n=r<this._numTargetEnabled?r:0;this._alphaBlend[n]?s.enableIndexed(e.BLEND,r):s.disableIndexed(e.BLEND,r)}this._isAlphaBlendDirty=!1}if(this._isBlendFunctionParametersDirty){for(let r=0;r<t;r++){const n=r<this._numTargetEnabled?r*4:0;s.blendFuncSeparateIndexed(r,this._blendFunctionParameters[n+0],this._blendFunctionParameters[n+1],this._blendFunctionParameters[n+2],this._blendFunctionParameters[n+3])}this._isBlendFunctionParametersDirty=!1}if(this._isBlendEquationParametersDirty){for(let r=0;r<t;r++){const n=r<this._numTargetEnabled?r*2:0;s.blendEquationSeparateIndexed(r,this._blendEquationParameters[n+0],this._blendEquationParameters[n+1])}this._isBlendEquationParametersDirty=!1}}setAlphaMode(e,t){let s=32774;switch(e){case 0:break;case 7:this.setAlphaBlendFunctionParameters(1,771,1,1,t);break;case 8:this.setAlphaBlendFunctionParameters(1,771,1,771,t);break;case 2:this.setAlphaBlendFunctionParameters(770,771,1,1,t);break;case 6:this.setAlphaBlendFunctionParameters(1,1,0,1,t);break;case 1:this.setAlphaBlendFunctionParameters(770,1,0,1,t);break;case 3:this.setAlphaBlendFunctionParameters(0,769,1,1,t),s=32778;break;case 4:this.setAlphaBlendFunctionParameters(774,0,1,1,t);break;case 5:this.setAlphaBlendFunctionParameters(770,769,1,1,t);break;case 9:this.setAlphaBlendFunctionParameters(32769,32770,32771,32772,t);break;case 10:this.setAlphaBlendFunctionParameters(1,769,1,771,t);break;case 11:this.setAlphaBlendFunctionParameters(1,1,1,1,t);break;case 12:this.setAlphaBlendFunctionParameters(772,1,0,0,t);break;case 13:this.setAlphaBlendFunctionParameters(775,769,773,771,t);break;case 14:this.setAlphaBlendFunctionParameters(1,771,1,771,t);break;case 15:this.setAlphaBlendFunctionParameters(1,1,1,0,t);break;case 16:this.setAlphaBlendFunctionParameters(775,769,0,1,t);break;case 17:this.setAlphaBlendFunctionParameters(770,771,1,771,t);break;case 18:this.setAlphaBlendFunctionParameters(1,1,1,1,t),s=32775;break;case 19:this.setAlphaBlendFunctionParameters(1,1,1,1,t),s=32776;break;case 20:this.setAlphaBlendFunctionParameters(1,35065,0,1,t);break}this.setAlphaEquationParameters(s,s,t)}}const oe=new Map;function W(i,e){Zt(i)&&f.Warn(`Extension with the name '${i}' already exists`),oe.set(i,e)}function Zt(i){return oe.delete(i)}function Qt(i,e){(e==="image/ktx"||e==="image/ktx2")&&(i=".ktx"),oe.has(i)||(i.endsWith(".ies")&&W(".ies",async()=>await H(()=>import("./iesTextureLoader.B5ImPzjh.js"),__vite__mapDeps([0,1])).then(s=>new s._IESTextureLoader)),i.endsWith(".dds")&&W(".dds",async()=>await H(()=>import("./ddsTextureLoader.BY24LCNS.js"),__vite__mapDeps([2,3,4,1,5,6,7,8,9,10,11,12,13,14,15,16,17])).then(s=>new s._DDSTextureLoader)),i.endsWith(".basis")&&W(".basis",async()=>await H(()=>import("./basisTextureLoader.DWkjOXED.js"),__vite__mapDeps([18,19,4,1,15,14,9,10,7,5])).then(s=>new s._BasisTextureLoader)),i.endsWith(".env")&&W(".env",async()=>await H(()=>import("./envTextureLoader.CauFDrvC.js"),__vite__mapDeps([20,5,19,4,1,15,3,6,7,8,9,10,21,16,22,23,13,14,17,24,25,12,26])).then(s=>new s._ENVTextureLoader)),i.endsWith(".hdr")&&W(".hdr",async()=>await H(()=>import("./hdrTextureLoader.CMy9M6PA.js"),__vite__mapDeps([27,4,1])).then(s=>new s._HDRTextureLoader)),(i.endsWith(".ktx")||i.endsWith(".ktx2"))&&(W(".ktx",async()=>await H(()=>import("./ktxTextureLoader.qGmt6mYl.js"),__vite__mapDeps([28,19,4,1,15,5])).then(s=>new s._KTXTextureLoader)),W(".ktx2",async()=>await H(()=>import("./ktxTextureLoader.qGmt6mYl.js"),__vite__mapDeps([28,19,4,1,15,5])).then(s=>new s._KTXTextureLoader))),i.endsWith(".tga")&&W(".tga",async()=>await H(()=>import("./tgaTextureLoader.B1Zo62PV.js"),__vite__mapDeps([29,4,1,5])).then(s=>new s._TGATextureLoader)),i.endsWith(".exr")&&W(".exr",async()=>await H(()=>import("./exrTextureLoader.5Jkf3uws.js"),__vite__mapDeps([30,1,19,4,15,5])).then(s=>new s._ExrTextureLoader)));const t=oe.get(i);return t?Promise.resolve(t(e)):null}function Ge(i,e){if(U()){const{requestAnimationFrame:t}=e||window;if(typeof t=="function")return t(i)}else if(typeof requestAnimationFrame=="function")return requestAnimationFrame(i);return setTimeout(i,16)}class G{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(e){return this._shaderProcessor}_resetAlphaMode(){this._alphaMode.fill(-1),this._alphaEquation.fill(-1)}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,e?this._depthCullingState.depthFunc=518:this._depthCullingState.depthFunc=515)}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(e){if(e){this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}else{let t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+=`
`),t+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(t&&(t+=`
`),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}}_rebuildInternalTextures(){const e=this._internalTexturesCache.slice();for(const t of e)t._rebuild()}_rebuildRenderTargetWrappers(){const e=this._renderTargetWrapperCache.slice();for(const t of e)t._rebuild()}_rebuildEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}w.ResetCache()}_rebuildGraphicsResources(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){f.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(e){setTimeout(()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,s=this._depthCullingState.depthFunc,r=this._depthCullingState.depthMask,n=this._stencilState.stencilTest;e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=s,this._depthCullingState.depthMask=r,this._stencilState.stencilTest=n,this._flagContextRestored()},0)}get isDisposed(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(e){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(e){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(e){if(!e){this._activeRenderLoops.length=0,this._cancelFrame();return}const t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),this._activeRenderLoops.length==0&&this._cancelFrame())}_cancelFrame(){if(this._frameHandler!==0){const e=this._frameHandler;if(this._frameHandler=0,U()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if(typeof t=="function")return t(e)}else if(typeof cancelAnimationFrame=="function")return cancelAnimationFrame(e);return clearTimeout(e)}}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(e){if(this._maxFPS=e,e!==void 0){if(e<=0){this._minFrameTime=Number.MAX_VALUE;return}this._minFrameTime=1e3/e}}_isOverFrameTime(e){if(!e||this._maxFPS===void 0)return!1;const t=e-this._lastFrameTime;return this._lastFrameTime=e,this._renderAccumulator+=t,this._renderAccumulator<this._minFrameTime?!0:(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(e){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(e)){let t=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(t=!1),t&&(this.beginFrame(),!this.skipFrameRender&&!this._renderViews()&&this._renderFrame(),this.endFrame())}}_renderLoop(e){this._processFrame(e),this._activeRenderLoops.length>0&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++){const t=this._activeRenderLoops[e];t()}}_renderViews(){return!1}_queueNewFrame(e,t){return Ge(e,t)}runRenderLoop(e){this._activeRenderLoops.indexOf(e)===-1&&(this._activeRenderLoops.push(e),this._activeRenderLoops.length===1&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(e){this._depthCullingState.depthTest=e}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getZOffset(){const e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}getZOffsetUnits(){const e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}getHostWindow(){return U()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=!0}_rebuildTextures(){for(const e of this.scenes)e._rebuildTextures();for(const e of this._virtualScenes)e._rebuildTextures()}_releaseRenderTargetWrapper(e){const t=this._renderTargetWrapperCache.indexOf(e);t!==-1&&this._renderTargetWrapperCache.splice(t,1)}get currentViewport(){return this._cachedViewport}setViewport(e,t,s){const r=t||this.getRenderWidth(),n=s||this.getRenderHeight(),a=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(a*r,o*n,r*e.width,n*e.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(e){return new Path2D(e)}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}_createTextureBase(e,t,s,r,n=3,a=null,o=null,l,u,h=null,c=null,d=null,_=null,C,S,g){e=e||"";const R=e.substring(0,5)==="data:",M=e.substring(0,5)==="blob:",E=R&&e.indexOf(";base64,")!==-1,m=c||new ce(this,1);m!==c&&(m.label=e.substring(0,60));const p=e;this._transformTextureUrl&&!E&&!c&&!h&&(e=this._transformTextureUrl(e)),p!==e&&(m._originalUrl=p);const y=e.lastIndexOf(".");let I=_||(y>-1?e.substring(y).toLowerCase():"");I.indexOf("?")>-1&&(I=I.split("?")[0]);const j=Qt(I,C);r&&r.addPendingData(m),m.url=e,m.generateMipMaps=!t,m.samplingMode=n,m.invertY=s,m._useSRGBBuffer=this._getUseSRGBBuffer(!!g,t),this._doNotHandleContextLost||(m._buffer=h);let Y=null;a&&!c&&(Y=m.onLoadedObservable.add(a)),c||this._internalTexturesCache.push(m);const J=(T,B)=>{r&&r.removePendingData(m),e===p?(Y&&m.onLoadedObservable.remove(Y),P.UseFallbackTexture&&e!==P.FallbackTexture&&this._createTextureBase(P.FallbackTexture,t,m.invertY,r,n,null,o,l,u,h,m),T=(T||"Unknown error")+(P.UseFallbackTexture?" - Fallback texture was used":""),m.onErrorObservable.notifyObservers({message:T,exception:B}),o&&o(T,B)):(f.Warn(`Failed to load ${e}, falling back to ${p}`),this._createTextureBase(p,t,m.invertY,r,n,a,o,l,u,h,m,d,_,C,S,g))};if(j){const T=async B=>{(await j).loadData(B,m,(ze,je,Je,et,tt,st)=>{st?J("TextureLoader failed to load data"):l(m,I,r,{width:ze,height:je},m.invertY,!Je,et,()=>(tt(),!1),n)},S)};h?h instanceof ArrayBuffer?T(new Uint8Array(h)):ArrayBuffer.isView(h)?T(h):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,B=>{T(new Uint8Array(B))},void 0,r?r.offlineProvider:void 0,!0,(B,Re)=>{J("Unable to load "+(B&&B.responseURL,Re))})}else{const T=B=>{M&&!this._doNotHandleContextLost&&(m._buffer=B),l(m,I,r,B,m.invertY,t,!1,u,n)};!R||E?h&&(typeof h.decoding=="string"||h.close)?T(h):G._FileToolsLoadImage(e||"",T,J,r?r.offlineProvider:null,C,m.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):typeof h=="string"||h instanceof ArrayBuffer||ArrayBuffer.isView(h)||h instanceof Blob?G._FileToolsLoadImage(h,T,J,r?r.offlineProvider:null,C,m.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):h&&T(h)}return m}_rebuildBuffers(){for(const e of this._uniformBuffers)e._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:ue()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(e){this._name=e}static get NpmPackage(){return"babylonjs@8.28.1"}static get Version(){return"8.28.1"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(e,t,s){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Yt,this._stencilStateComposer=new Xt,this._stencilState=new L,this._alphaState=new Kt(!1),this._alphaMode=Array(8).fill(-1),this._alphaEquation=Array(8).fill(-1),this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new x,this.onCanvasFocusObservable=new x,this.onNewSceneAddedObservable=new x,this.onResizeObservable=new x,this.onCanvasPointerOutObservable=new x,this.onEffectErrorObservable=new x,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new x,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=a=>this._renderLoop(a),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new x,this.onAfterShaderCompilationObservable=new x,this.onBeginFrameObservable=new x,this.onEndFrameObservable=new x,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new x,this.onContextRestoredObservable=new x,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new x,this.onReleaseEffectsObservable=new x,P.Instances.push(this),this.startTime=$t.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,it.SetMatrixPrecision(!!t.useHighPrecisionMatrix),ft()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=s??!1,t.antialias=e??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.stencil=t.stencil??!0,this._audioContext=t.audioEngineOptions?.audioContext??null,this._audioDestination=t.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;const r=U()&&window.devicePixelRatio||1,n=t.limitDeviceRatio||r;s=s||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=s?1/Math.min(n,r):1,this._lastDevicePixelRatio=r,this._creationOptions=t}resize(e=!1){let t,s;if(this.adaptToDeviceRatio){const r=U()&&window.devicePixelRatio||1,n=this._lastDevicePixelRatio/r;this._lastDevicePixelRatio=r,this._hardwareScalingLevel*=n}if(U()&&ue())if(this._renderingCanvas){const r=this._renderingCanvas.getBoundingClientRect?.();t=this._renderingCanvas.clientWidth||r?.width||this._renderingCanvas.width*this._hardwareScalingLevel||100,s=this._renderingCanvas.clientHeight||r?.height||this._renderingCanvas.height*this._hardwareScalingLevel||100}else t=window.innerWidth,s=window.innerHeight;else t=this._renderingCanvas?this._renderingCanvas.width:100,s=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,s/this._hardwareScalingLevel,e)}setSize(e,t,s=!1){if(!this._renderingCanvas||(e=e|0,t=t|0,!s&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t))return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let r=0;r<this.scenes.length;r++){const n=this.scenes[r];for(let a=0;a<n.cameras.length;a++){const o=n.cameras[a];o._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(e,t,s,r,n,a,o,l,u,h,c){throw O("engine.rawTexture")}createRawCubeTexture(e,t,s,r,n,a,o,l){throw O("engine.rawTexture")}createRawTexture3D(e,t,s,r,n,a,o,l,u,h,c){throw O("engine.rawTexture")}createRawTexture2DArray(e,t,s,r,n,a,o,l,u,h,c){throw O("engine.rawTexture")}_sharedInit(e){this._renderingCanvas=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const e=navigator.userAgent;this.hostInformation.isMobile=e.indexOf("Mobile")!==-1||e.indexOf("Mac")!==-1&&ue()&&"ontouchend"in document},this._checkForMobile(),U()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(e){return document.createElement("video")}_reportDrawCall(e=1){this._drawCalls?.addCount(e,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return this._timeStep*1e3}_createImageBitmapFromSource(e,t){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(e,t){return createImageBitmap(e,t)}resizeImageBitmap(e,t,s){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(e){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(e,t){if(typeof document>"u")return new OffscreenCanvas(e,t);const s=document.createElement("canvas");return s.width=e,s.height=t,s}createCanvas(e,t){return G._CreateCanvas(e,t)}static _FileToolsLoadImage(e,t,s,r,n,a,o){throw O("FileTools")}_loadFile(e,t,s,r,n,a){const o=Me(e,t,s,r,n,a);return this._activeRequests.push(o),o.onCompleteObservable.add(()=>{const l=this._activeRequests.indexOf(o);l!==-1&&this._activeRequests.splice(l,1)}),o}static _FileToolsLoadFile(e,t,s,r,n,a){if(ne.loadFile)return ne.loadFile(e,t,s,r,n,a);throw O("FileTools")}dispose(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();this.releaseComputeEffects?.(),w.ResetCache();for(const t of this._activeRequests)t.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),U()&&window.removeEventListener("resize",this._checkForMobile);const e=P.Instances.indexOf(this);e>=0&&P.Instances.splice(e,1),P.Instances.length||(P.OnEnginesDisposedObservable.notifyObservers(this),P.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(e){throw O("LoadingScreen")}static MarkAllMaterialsAsDirty(e,t){for(let s=0;s<P.Instances.length;s++){const r=P.Instances[s];for(let n=0;n<r.scenes.length;n++)r.scenes[n].markAllMaterialsAsDirty(e,t)}}}G._RenderPassIdCounter=0;G._RescalePostProcessFactory=null;G.CollisionsEpsilon=.001;G.QueueNewFrame=Ge;function Ss(i,e,t,s){var r=arguments.length,n=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(i,e,t,s);else for(var o=i.length-1;o>=0;o--)(a=i[o])&&(n=(r<3?a(n):r>3?a(e,t,n):a(e,t))||n);return r>3&&n&&Object.defineProperty(e,t,n),n}const se={},re={};function zt(i){const e=i.getClassName();return re[e]||(re[e]={}),re[e]}function ye(i){const e=i.getClassName();if(se[e])return se[e];se[e]={};const t=se[e];let s=i,r=e;for(;r;){const n=re[r];for(const l in n)t[l]=n[l];let a,o=!1;do{if(a=Object.getPrototypeOf(s),!a.getClassName){o=!0;break}if(a.getClassName()!==r)break;s=a}while(a);if(o)break;r=a.getClassName(),s=a}return t}function V(i,e){return(t,s)=>{const r=zt(t);r[s]||(r[s]={type:i,sourceName:e})}}function jt(i,e=null){return(t,s)=>{const r=e||"_"+s;Object.defineProperty(t,s,{get:function(){return this[r]},set:function(n){typeof this[r]?.equals=="function"&&this[r].equals(n)||this[r]!==n&&(this[r]=n,t[i].apply(this))},enumerable:!0,configurable:!0})}}function xs(i,e=null){return jt(i,e)}function Fs(i){return V(0,i)}function vs(i){return V(1,i)}function Rs(i){return V(2,i)}function ws(i){return V(3,i)}function Ps(i){return V(4,i)}function Ds(i){return V(5,i)}function As(i){return V(6,i)}function Es(i){return V(7,i)}function Ts(i){return V(8,i)}function Ls(i){return V(10,i)}function ke(i,e,t,s){const r=t.value;t.value=(...n)=>{let a=r;if(typeof _native<"u"&&_native[e]){const o=_native[e];s?a=(...l)=>s(...l)?o(...l):r(...l):a=o}return i[e]=a,a(...n)}}ke.filter=function(i){return(e,t,s)=>ke(e,t,s,i)};function Os(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const e=Math.random()*16|0;return(i==="x"?e:e&3|8).toString(16)})}function Jt(){return typeof _native<"u"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}class D{constructor(){this._xhr=Jt(),this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(D.CustomRequestHeaders).length>0||D.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const e in D.CustomRequestHeaders){const t=D.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}}_shouldSkipRequestModifications(e){return D.SkipRequestModificationForBabylonCDN&&(e.includes("preview.babylonjs.com")||e.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(e){this._xhr.onprogress=e}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(e){this._xhr.responseType=e}get timeout(){return this._xhr.timeout}set timeout(e){this._xhr.timeout=e}addEventListener(e,t,s){this._xhr.addEventListener(e,t,s)}removeEventListener(e,t,s){this._xhr.removeEventListener(e,t,s)}abort(){this._xhr.abort()}send(e){D.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)}open(e,t){for(const s of D.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;t=s(this._xhr,t)||t}t=t.replace("file:http:","http:"),t=t.replace("file:https:","https:"),this._requestURL=t,this._xhr.open(e,t,!0)}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}getResponseHeader(e){return this._xhr.getResponseHeader(e)}}D.CustomRequestHeaders={};D.CustomRequestModifiers=new Array;D.SkipRequestModificationForBabylonCDN=!0;class K{}K.FilesToLoad={};class es{static ExponentialBackoff(e=3,t=500){return(s,r,n)=>r.status!==0||n>=e||s.indexOf("file:")!==-1?-1:Math.pow(2,n)*t}}class $ extends Error{}$._setPrototypeOf=Object.setPrototypeOf||((i,e)=>(i.__proto__=e,i));const xe={MeshInvalidPositionsError:0,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class z extends ${constructor(e,t,s){super(e),this.errorCode=t,this.innerError=s,this.name="RuntimeError",$._setPrototypeOf(this,z.prototype)}}const ts=i=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,r,n,a,o,l,u,h=0;const c=ArrayBuffer.isView(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);for(;h<c.length;)s=c[h++],r=h<c.length?c[h++]:Number.NaN,n=h<c.length?c[h++]:Number.NaN,a=s>>2,o=(s&3)<<4|r>>4,l=(r&15)<<2|n>>6,u=n&63,isNaN(r)?l=u=64:isNaN(n)&&(u=64),t+=e.charAt(a)+e.charAt(o)+e.charAt(l)+e.charAt(u);return t},Ne=i=>atob(i),ss=i=>{const e=Ne(i),t=e.length,s=new Uint8Array(new ArrayBuffer(t));for(let r=0;r<t;r++)s[r]=e.charCodeAt(r);return s.buffer},qe=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class le extends z{constructor(e,t){super(e,xe.LoadFileError),this.name="LoadFileError",$._setPrototypeOf(this,le.prototype),t instanceof D?this.request=t:this.file=t}}class he extends z{constructor(e,t){super(e,xe.RequestFileError),this.request=t,this.name="RequestFileError",$._setPrototypeOf(this,he.prototype)}}class Fe extends z{constructor(e,t){super(e,xe.ReadFileError),this.file=t,this.name="ReadFileError",$._setPrototypeOf(this,Fe.prototype)}}const is=i=>(i=i.replace(/#/gm,"%23"),i),k={DefaultRetryStrategy:es.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:i=>i,ScriptBaseUrl:"",ScriptPreprocessUrl:i=>i,CleanUrl:is},$e=(i,e)=>{if(!(i&&i.indexOf("data:")===0)&&k.CorsBehavior)if(typeof k.CorsBehavior=="string"||k.CorsBehavior instanceof String)e.crossOrigin=k.CorsBehavior;else{const t=k.CorsBehavior(i);t&&(e.crossOrigin=t)}},Ye=(i,e,t,s,r="",n,a=P.LastCreatedEngine)=>{if(typeof HTMLImageElement>"u"&&!a?._features.forceBitmapOverHTMLImageElement)return t("LoadImage is only supported in web or BabylonNative environments."),null;let o,l=!1;i instanceof ArrayBuffer||ArrayBuffer.isView(i)?typeof Blob<"u"&&typeof URL<"u"?(o=URL.createObjectURL(new Blob([i],{type:r})),l=!0):o=`data:${r};base64,`+ts(i):i instanceof Blob?(o=URL.createObjectURL(i),l=!0):(o=k.CleanUrl(i),o=k.PreprocessUrl(o));const u=p=>{if(t){const y=o||i.toString();t(`Error while trying to load image: ${y.indexOf("http")===0||y.length<=128?y:y.slice(0,128)+"..."}`,p)}};if(a?._features.forceBitmapOverHTMLImageElement)return Z(o,p=>{a.createImageBitmap(new Blob([p],{type:r}),{premultiplyAlpha:"none",...n}).then(y=>{e(y),l&&URL.revokeObjectURL(o)}).catch(y=>{t&&t("Error while trying to load image: "+i,y)})},void 0,s||void 0,!0,(p,y)=>{u(y)}),null;const h=new Image;$e(o,h);const c=[],d=()=>{for(const p of c)p.target.addEventListener(p.name,p.handler)},_=()=>{for(const p of c)p.target.removeEventListener(p.name,p.handler);c.length=0},C=()=>{_(),e(h),l&&h.src&&URL.revokeObjectURL(h.src)},S=p=>{_(),u(p),l&&h.src&&URL.revokeObjectURL(h.src)},g=p=>{if(p.blockedURI!==h.src||p.disposition==="report")return;_();const y=new Error(`CSP violation of policy ${p.effectiveDirective} ${p.blockedURI}. Current policy is ${p.originalPolicy}`);P.UseFallbackTexture=!1,u(y),l&&h.src&&URL.revokeObjectURL(h.src),h.src=""};c.push({target:h,name:"load",handler:C}),c.push({target:h,name:"error",handler:S}),c.push({target:document,name:"securitypolicyviolation",handler:g}),d();const R=o.substring(0,5)==="blob:",M=o.substring(0,5)==="data:",E=()=>{R||M||!D.IsCustomRequestAvailable?h.src=o:Z(o,(p,y,I)=>{const ve=!r&&I?I:r,j=new Blob([p],{type:ve}),Y=URL.createObjectURL(j);l=!0,h.src=Y},void 0,s||void 0,!0,(p,y)=>{u(y)})},m=()=>{s&&s.loadImage(o,h)};if(!R&&!M&&s&&s.enableTexturesOffline)s.open(m,E);else{if(o.indexOf("file:")!==-1){const p=decodeURIComponent(o.substring(5).toLowerCase());if(K.FilesToLoad[p]&&typeof URL<"u"){try{let y;try{y=URL.createObjectURL(K.FilesToLoad[p])}catch{y=URL.createObjectURL(K.FilesToLoad[p])}h.src=y,l=!0}catch{h.src=""}return h}}E()}return h},Se=(i,e,t,s,r)=>{const n=new FileReader,a={onCompleteObservable:new x,abort:()=>n.abort()};return n.onloadend=()=>a.onCompleteObservable.notifyObservers(a),r&&(n.onerror=()=>{r(new Fe(`Unable to read ${i.name}`,i))}),n.onload=o=>{e(o.target.result)},t&&(n.onprogress=t),s?n.readAsArrayBuffer(i):n.readAsText(i),a},Z=(i,e,t,s,r,n,a)=>{if(i.name)return Se(i,e,t,r,n?h=>{n(void 0,h)}:void 0);const o=i;if(o.indexOf("file:")!==-1){let h=decodeURIComponent(o.substring(5).toLowerCase());h.indexOf("./")===0&&(h=h.substring(2));const c=K.FilesToLoad[h];if(c)return Se(c,e,t,r,n?d=>n(void 0,new le(d.message,d.file)):void 0)}const{match:l,type:u}=ns(o);if(l){const h={onCompleteObservable:new x,abort:()=>()=>{}};try{const c=r?Ze(o):Qe(o);e(c,void 0,u)}catch(c){n?n(void 0,c):f.Error(c.message||"Failed to parse the Data URL")}return Nt.SetImmediate(()=>{h.onCompleteObservable.notifyObservers(h)}),h}return Xe(o,(h,c)=>{e(h,c?.responseURL,c?.getResponseHeader("content-type"))},t,s,r,n?h=>{n(h.request,new le(h.message,h.request))}:void 0,a)},Xe=(i,e,t,s,r,n,a)=>{s!==null&&(s??(s=P.LastCreatedScene?.offlineProvider)),i=k.CleanUrl(i),i=k.PreprocessUrl(i);const o=k.BaseUrl+i;let l=!1;const u={onCompleteObservable:new x,abort:()=>l=!0},h=()=>{let c=new D,d=null,_;const C=()=>{c&&(t&&c.removeEventListener("progress",t),_&&c.removeEventListener("readystatechange",_),c.removeEventListener("loadend",S))};let S=()=>{C(),u.onCompleteObservable.notifyObservers(u),u.onCompleteObservable.clear(),t=void 0,_=null,S=null,n=void 0,a=void 0,e=void 0};u.abort=()=>{l=!0,S&&S(),c&&c.readyState!==(XMLHttpRequest.DONE||4)&&c.abort(),d!==null&&(clearTimeout(d),d=null),c=null};const g=M=>{const E=M.message||"Unknown error";n&&c?n(new he(E,c)):f.Error(E)},R=M=>{if(c){if(c.open("GET",o),a)try{a(c)}catch(E){g(E);return}r&&(c.responseType="arraybuffer"),t&&c.addEventListener("progress",t),S&&c.addEventListener("loadend",S),_=()=>{if(!(l||!c)&&c.readyState===(XMLHttpRequest.DONE||4)){if(_&&c.removeEventListener("readystatechange",_),c.status>=200&&c.status<300||c.status===0&&(!U()||Ke())){const p=r?c.response:c.responseText;if(p!==null){try{e&&e(p,c)}catch(y){g(y)}return}}const E=k.DefaultRetryStrategy;if(E){const p=E(o,c,M);if(p!==-1){C(),c=new D,d=setTimeout(()=>R(M+1),p);return}}const m=new he("Error status: "+c.status+" "+c.statusText+" - Unable to load "+o,c);n&&n(m)}},c.addEventListener("readystatechange",_),c.send()}};R(0)};if(s&&s.enableSceneOffline&&!i.startsWith("blob:")){const c=_=>{_&&_.status>400?n&&n(_):h()},d=()=>{s&&s.loadFile(k.BaseUrl+i,_=>{!l&&e&&e(_),u.onCompleteObservable.notifyObservers(u)},t?_=>{!l&&t&&t(_)}:void 0,c,r)};s.open(d,c)}else h();return u},Ke=()=>typeof location<"u"&&location.protocol==="file:",rs=i=>qe.test(i),ns=i=>{const e=qe.exec(i);return e===null||e.length===0?{match:!1,type:""}:{match:!0,type:e[0].replace("data:","").replace(";base64,","")}};function Ze(i){return ss(i.split(",")[1])}const Qe=i=>Ne(i.split(",")[1]),as=()=>{G._FileToolsLoadImage=Ye,ne.loadFile=Z,We.loadFile=Z};as();let X;const os=(i,e,t,s,r,n,a,o,l,u)=>{X={DecodeBase64UrlToBinary:i,DecodeBase64UrlToString:e,DefaultRetryStrategy:t.DefaultRetryStrategy,BaseUrl:t.BaseUrl,CorsBehavior:t.CorsBehavior,PreprocessUrl:t.PreprocessUrl,IsBase64DataUrl:s,IsFileURL:r,LoadFile:n,LoadImage:a,ReadFile:o,RequestFile:l,SetCorsBehavior:u},Object.defineProperty(X,"DefaultRetryStrategy",{get:function(){return t.DefaultRetryStrategy},set:function(h){t.DefaultRetryStrategy=h}}),Object.defineProperty(X,"BaseUrl",{get:function(){return t.BaseUrl},set:function(h){t.BaseUrl=h}}),Object.defineProperty(X,"PreprocessUrl",{get:function(){return t.PreprocessUrl},set:function(h){t.PreprocessUrl=h}}),Object.defineProperty(X,"CorsBehavior",{get:function(){return t.CorsBehavior},set:function(h){t.CorsBehavior=h}})};os(Ze,Qe,k,rs,Ke,Z,Ye,Se,Xe,$e);class q{static Eval(e,t){return e.match(/\([^()]*\)/g)?e=e.replace(/\([^()]*\)/g,s=>(s=s.slice(1,s.length-1),q._HandleParenthesisContent(s,t))):e=q._HandleParenthesisContent(e,t),e==="true"?!0:e==="false"?!1:q.Eval(e,t)}static _HandleParenthesisContent(e,t){t=t||(n=>n==="true");let s;const r=e.split("||");for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)){let a=q._SimplifyNegation(r[n].trim());const o=a.split("&&");if(o.length>1)for(let l=0;l<o.length;++l){const u=q._SimplifyNegation(o[l].trim());if(u!=="true"&&u!=="false"?u[0]==="!"?s=!t(u.substring(1)):s=t(u):s=u==="true",!s){a="false";break}}if(s||a==="true"){s=!0;break}a!=="true"&&a!=="false"?a[0]==="!"?s=!t(a.substring(1)):s=t(a):s=a==="true"}return s?"true":"false"}static _SimplifyNegation(e){return e=e.replace(/^[\s!]+/,t=>(t=t.replace(/[\s]/g,()=>""),t.length%2?"!":"")),e=e.trim(),e==="!true"?e="false":e==="!false"&&(e="true"),e}}class v{static EnableFor(e){e._tags=e._tags||{},e.hasTags=()=>v.HasTags(e),e.addTags=t=>v.AddTagsTo(e,t),e.removeTags=t=>v.RemoveTagsFrom(e,t),e.matchesTagsQuery=t=>v.MatchesQuery(e,t)}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static HasTags(e){if(!e._tags)return!1;const t=e._tags;for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s))return!0;return!1}static GetTags(e,t=!0){if(!e._tags)return null;if(t){const s=[];for(const r in e._tags)Object.prototype.hasOwnProperty.call(e._tags,r)&&e._tags[r]===!0&&s.push(r);return s.join(" ")}else return e._tags}static AddTagsTo(e,t){if(!t||typeof t!="string")return;const s=t.split(" ");for(const r of s)v._AddTagTo(e,r)}static _AddTagTo(e,t){t=t.trim(),!(t===""||t==="true"||t==="false")&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(v.EnableFor(e),e._tags[t]=!0))}static RemoveTagsFrom(e,t){if(!v.HasTags(e))return;const s=t.split(" ");for(const r in s)v._RemoveTagFrom(e,s[r])}static _RemoveTagFrom(e,t){delete e._tags[t]}static MatchesQuery(e,t){return t===void 0?!0:t===""?v.HasTags(e):q.Eval(t,s=>v.HasTags(e)&&e._tags[s])}}const Be=function(i,e,t,s={}){const r=i();v&&v.HasTags(e)&&v.AddTagsTo(r,v.GetTags(e,!0));const n=ye(r),a={};for(const o in n){const l=n[o],u=e[o],h=l.type;if(u!=null&&(o!=="uniqueId"||A.AllowLoadingUniqueId))switch(h){case 0:case 6:case 9:case 11:r[o]=u;break;case 1:s.cloneTexturesOnlyOnce&&a[u.uniqueId]?r[o]=a[u.uniqueId]:(r[o]=t||u.isRenderTarget?u:u.clone(),a[u.uniqueId]=r[o]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:r[o]=t?u:u.clone();break}}return r};class A{static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let s=0;s<e.animations.length;s++){const r=e.animations[s];t.animations.push(r.serialize())}}}static Serialize(e,t){t||(t={}),v&&(t.tags=v.GetTags(e));const s=ye(e);for(const r in s){const n=s[r],a=n.sourceName||r,o=n.type,l=e[r];if(l!=null&&(r!=="uniqueId"||A.AllowLoadingUniqueId))switch(o){case 0:Array.isArray(l)?t[a]=l.slice():t[a]=l;break;case 1:t[a]=l.serialize();break;case 2:t[a]=l.asArray();break;case 3:t[a]=l.serialize();break;case 4:t[a]=l.asArray();break;case 5:t[a]=l.asArray();break;case 6:t[a]=l.id;break;case 7:t[a]=l.serialize();break;case 8:t[a]=l.asArray();break;case 9:t[a]=l.serialize();break;case 10:t[a]=l.asArray();break;case 11:t[a]=l.id;break;case 12:t[a]=l.asArray();break}}return t}static ParseProperties(e,t,s,r){r||(r="");const n=ye(t);for(const a in n){const o=n[a],l=e[o.sourceName||a],u=o.type;if(l!=null&&(a!=="uniqueId"||A.AllowLoadingUniqueId)){const h=t;switch(u){case 0:h[a]=l;break;case 1:s&&(h[a]=A._TextureParser(l,s,r));break;case 2:h[a]=ht.FromArray(l);break;case 3:h[a]=A._FresnelParametersParser(l);break;case 4:h[a]=ot.FromArray(l);break;case 5:h[a]=at.FromArray(l);break;case 6:s&&(h[a]=s.getLastMeshById(l));break;case 7:h[a]=A._ColorCurvesParser(l);break;case 8:h[a]=lt.FromArray(l);break;case 9:h[a]=A._ImageProcessingConfigurationParser(l);break;case 10:h[a]=nt.FromArray(l);break;case 11:s&&(h[a]=s.getCameraById(l));break;case 12:h[a]=rt.FromArray(l);break}}}}static Parse(e,t,s,r=null){const n=e();return v&&v.AddTagsTo(n,t.tags),A.ParseProperties(t,n,s,r),n}static Clone(e,t,s={}){return Be(e,t,!1,s)}static Instanciate(e,t){return Be(e,t,!0)}}A.AllowLoadingUniqueId=!1;A._ImageProcessingConfigurationParser=i=>{throw O("ImageProcessingConfiguration")};A._FresnelParametersParser=i=>{throw O("FresnelParameters")};A._ColorCurvesParser=i=>{throw O("ColorCurves")};A._TextureParser=(i,e,t)=>{throw O("Texture")};export{gs as $,G as A,N as B,Kt as C,Ze as D,ts as E,k as F,dt as G,Vt as H,U as I,pt as J,mt as K,f as L,bs as M,bt as N,Ct as O,$t as P,ds as Q,Os as R,A as S,Nt as T,Ie as U,ps as V,D as W,Ue as X,_s as Y,ms as Z,O as _,Ss as a,_t as a0,us as a1,ue as a2,z as a3,xe as a4,v as a5,Ls as a6,Es as a7,Ps as a8,Xe as a9,Rs as b,Ds as c,F as d,vs as e,$e as f,Ye as g,Z as h,Se as i,rs as j,ft as k,Cs as l,xs as m,ce as n,Qt as o,ke as p,be as q,ws as r,Fs as s,As as t,qt as u,He as v,w,ys as x,Ts as y,fs as z};
