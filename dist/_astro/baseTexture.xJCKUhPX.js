import{R as y,S as g,a as r,s,e as A}from"./decorators.serialization.DTWIlLMH.js";import{O as D,E as M,M as m}from"./math.vector.C8FsJn6B.js";import{S}from"./math.size.F3xmSqZc.js";class f{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return this._texture?this._texture.isCube:!1}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return e?.shareDepth!==void 0}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=S.Zero(),this._cachedBaseSize=S.Zero(),this._initialSamplingMode=2,this._texture=f._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return this.delayLoadState===4?(this.delayLoad(),!1):this._texture?this._texture.isReady:!1}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return!this.isReady()||!this._texture?(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize):this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e,t=!1){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture,this._texture.generateMipMaps&&t)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}class i extends f{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){if(this._texture)this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace);else return this._gammaSpace;return this._texture._gammaSpace&&!this._texture._useSRGBBuffer}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this.getScene()?.markAllMaterialsAsDirty(1,t=>t.hasTexture(this))}get isRGBD(){return this._texture!=null&&this._texture._isRGBD}set isRGBD(e){e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),this.getScene()?.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return this._texture?this._texture._linearSpecularLOD:!1}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=y()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e,t=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=i.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new D,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?i._IsScene(e)?this._scene=e:this._engine=e:this._scene=M.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return m.IdentityReadOnly}getReflectionTextureMatrix(){return m.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,n,u,o,_){const a=this._getEngine();if(!a)return null;const h=a._getUseSRGBBuffer(!!o,t),l=a.getLoadedTexturesCache();for(let p=0;p<l.length;p++){const d=l[p];if((o===void 0||h===d._useSRGBBuffer)&&(u===void 0||u===d.invertY)&&d.url===e&&d.generateMipMaps===!t&&(!n||n===d.samplingMode)&&(_===void 0||_===d.isCube))return d.incrementReferences(),d}return null}_rebuild(e=!1){}clone(){return null}get textureType(){return this._texture&&this._texture.type!==void 0?this._texture.type:0}get textureFormat(){return this._texture&&this._texture.format!==void 0?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,n=null,u=!0,o=!1,_=0,a=0,h=Number.MAX_VALUE,l=Number.MAX_VALUE){if(!this._texture)return null;const p=this._getEngine();if(!p)return null;const d=this.getSize();let c=d.width,x=d.height;t!==0&&(c=c/Math.pow(2,t),x=x/Math.pow(2,t),c=Math.round(c),x=Math.round(x)),h=Math.min(c,h),l=Math.min(x,l);try{return this._texture.isCube?p._readTexturePixels(this._texture,h,l,e,t,n,u,o,_,a):p._readTexturePixels(this._texture,h,l,-1,t,n,u,o,_,a)}catch{return null}}_readPixelsSync(e=0,t=0,n=null,u=!0,o=!1){if(!this._texture)return null;const _=this.getSize();let a=_.width,h=_.height;const l=this._getEngine();if(!l)return null;t!=0&&(a=a/Math.pow(2,t),h=h/Math.pow(2,t),a=Math.round(a),h=Math.round(h));try{return this._texture.isCube?l._readTexturePixelsSync(this._texture,a,h,e,t,n,u,o):l._readTexturePixelsSync(this._texture,a,h,-1,t,n,u,o)}catch{return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;const t=g.Serialize(this);return g.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let n=e.length;if(n===0){t();return}for(let u=0;u<e.length;u++){const o=e[u];if(o.isReady())--n===0&&t();else{const _=o.onLoadObservable;_?_.addOnce(()=>{--n===0&&t()}):--n===0&&t()}}}static _IsScene(e){return e.getClassName()==="Scene"}}i.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4;r([s()],i.prototype,"uniqueId",void 0);r([s()],i.prototype,"name",void 0);r([s()],i.prototype,"displayName",void 0);r([s()],i.prototype,"metadata",void 0);r([s("hasAlpha")],i.prototype,"_hasAlpha",void 0);r([s("getAlphaFromRGB")],i.prototype,"_getAlphaFromRGB",void 0);r([s()],i.prototype,"level",void 0);r([s("coordinatesIndex")],i.prototype,"_coordinatesIndex",void 0);r([s()],i.prototype,"optimizeUVAllocation",void 0);r([s("coordinatesMode")],i.prototype,"_coordinatesMode",void 0);r([s()],i.prototype,"wrapU",null);r([s()],i.prototype,"wrapV",null);r([s()],i.prototype,"wrapR",void 0);r([s()],i.prototype,"anisotropicFilteringLevel",void 0);r([s()],i.prototype,"isCube",null);r([s()],i.prototype,"is3D",null);r([s()],i.prototype,"is2DArray",null);r([s()],i.prototype,"gammaSpace",null);r([s()],i.prototype,"invertZ",void 0);r([s()],i.prototype,"lodLevelInAlpha",void 0);r([s()],i.prototype,"lodGenerationOffset",null);r([s()],i.prototype,"lodGenerationScale",null);r([s()],i.prototype,"linearSpecularLOD",null);r([A()],i.prototype,"irradianceTexture",null);r([s()],i.prototype,"isRenderTarget",void 0);export{i as B};
