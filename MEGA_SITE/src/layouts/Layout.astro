---
export interface Props {
  title: string;
  description?: string;
  image?: string;
  canonicalURL?: string | URL;
  lang?: string;
  type?: 'website' | 'article';
  robots?: string;
  theme?: 'cyberpunk' | 'zen' | 'polish' | 'admin';
  showNavigation?: boolean;
  fullscreen?: boolean;
}

const {
  title,
  description = "MEGA SITE - Zaawansowana platforma AI z Voice Assistant, Admin Dashboard, POLACZEK Agent System i Stable Diffusion",
  image = "/site-thumbnail.png",
  canonicalURL = Astro.site ? new URL(Astro.url.pathname, Astro.site) : new URL(Astro.url.pathname, 'https://www.mybonzo.com'),
  lang = "pl",
  type = "website",
  robots = "index, follow",
  theme = "cyberpunk",
  showNavigation = true,
  fullscreen = false
} = Astro.props;

// Theme configurations
const themes = {
  cyberpunk: {
    bg: 'bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900',
    accent: 'text-cyan-400',
    border: 'border-cyan-500/30'
  },
  zen: {
    bg: 'bg-gradient-to-br from-slate-900 via-gray-800 to-slate-900',
    accent: 'text-green-400',
    border: 'border-green-500/30'
  },
  polish: {
    bg: 'bg-gradient-to-br from-red-900 via-white to-red-900',
    accent: 'text-red-600',
    border: 'border-red-500/30'
  },
  admin: {
    bg: 'bg-gradient-to-br from-blue-900 via-indigo-900 to-blue-900',
    accent: 'text-blue-400',
    border: 'border-blue-500/30'
  }
};

const currentTheme = themes[theme];
const formattedTitle = title ? `${title} | MEGA SITE` : "MEGA SITE - LUC de ZEN ON";
---

<!DOCTYPE html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- SEO Meta Tags -->
    <title>{formattedTitle}</title>
    <meta name="description" content={description} />
    <meta name="robots" content={robots} />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={formattedTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.url)} />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={formattedTitle} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.url)} />
    
    <!-- Polish Language Support -->
    <meta http-equiv="Content-Language" content="pl" />
    <meta name="language" content="Polish" />
    
    <!-- PWA Support -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#1e1b4b" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="MEGA SITE" />
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="/fonts/Neuropol.otf" as="font" type="font/otf" crossorigin />
    <link rel="preload" href="/fonts/Steelfish Outline.otf" as="font" type="font/otf" crossorigin />
    
    <!-- Performance Optimizations -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    
    <!-- Import Global Styles with TailwindCSS -->
    <link rel="stylesheet" href="/src/styles/global.css" />
    
    <style>
      @font-face {
        font-family: 'Neuropol';
        src: url('/fonts/Neuropol.otf') format('opentype');
        font-display: swap;
      }
      
      @font-face {
        font-family: 'Steelfish';
        src: url('/fonts/Steelfish Outline.otf') format('opentype');
        font-display: swap;
      }
      
      .font-neuropol { font-family: 'Neuropol', sans-serif; }
      .font-steelfish { font-family: 'Steelfish', sans-serif; }
      
      /* Cyberpunk Animations */
      .glow {
        text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor;
        animation: glow 2s ease-in-out infinite alternate;
      }
      
      @keyframes glow {
        from { opacity: 1; }
        to { opacity: 0.7; }
      }
      
      .bg-glass {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      /* Loading Animation */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease-out;
      }
      
      .loading-screen.hidden {
        opacity: 0;
        pointer-events: none;
      }
      
      /* Responsive Design */
      @media (max-width: 768px) {
        .mobile-hidden { display: none !important; }
        .mobile-full { width: 100% !important; }
      }
    </style>
  </head>
  
  <body class={`${currentTheme.bg} text-white min-h-screen antialiased ${fullscreen ? 'overflow-hidden' : ''}`}>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
      <div class="text-center">
        <div class="glow text-cyan-400 text-4xl font-neuropol mb-4">MEGA SITE</div>
        <div class="animate-spin w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full mx-auto"></div>
        <div class="text-cyan-300 mt-4">Ładowanie zaawansowanych funkcji AI...</div>
      </div>
    </div>
    
    <!-- Main Navigation -->
    {showNavigation && (
      <nav class="fixed top-0 w-full bg-glass backdrop-blur-lg z-50 border-b border-cyan-500/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <a href="/" class="glow text-2xl font-neuropol text-cyan-400 hover:text-cyan-300 transition-colors">
                MEGA SITE
              </a>
            </div>
            
            <div class="hidden md:block">
              <div class="ml-10 flex items-baseline space-x-4">
                <a href="/" class="hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Home</a>
                <a href="/dashboard" class="hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Dashboard</a>
                <a href="/admin" class="hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Admin</a>
                <a href="/agents" class="hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">AI Agents</a>
                <a href="/voice-ai" class="hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Voice AI</a>
                <a href="/stable-diffusion" class="hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Image Gen</a>
                <a href="/polaczek" class="hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">POLACZEK</a>
              </div>
            </div>
            
            <!-- Mobile menu button -->
            <div class="md:hidden">
              <button id="mobile-menu-button" type="button" class="bg-glass p-2 rounded-md text-cyan-400 hover:text-cyan-300">
                <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
              </button>
            </div>
          </div>
        </div>
        
        <!-- Mobile menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-glass backdrop-blur-lg border-t border-cyan-500/30">
          <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
            <a href="/" class="block hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Home</a>
            <a href="/dashboard" class="block hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Dashboard</a>
            <a href="/admin" class="block hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Admin</a>
            <a href="/agents" class="block hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">AI Agents</a>
            <a href="/voice-ai" class="block hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Voice AI</a>
            <a href="/stable-diffusion" class="block hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">Image Gen</a>
            <a href="/polaczek" class="block hover:text-cyan-400 transition-colors px-3 py-2 rounded-md">POLACZEK</a>
          </div>
        </div>
      </nav>
    )}
    
    <!-- Main Content -->
    <main class={`${showNavigation ? 'pt-16' : ''} ${fullscreen ? 'h-screen' : 'min-h-screen'}`}>
      <slot />
    </main>
    
    <!-- Footer -->
    {!fullscreen && (
      <footer class="border-t border-cyan-500/30 bg-glass backdrop-blur-lg mt-auto">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
              <h3 class="text-lg font-neuropol text-cyan-400 mb-4">MEGA SITE</h3>
              <p class="text-gray-300 text-sm">Zaawansowana platforma AI z pełną obsługą języka polskiego.</p>
            </div>
            <div>
              <h4 class="text-md font-semibold text-cyan-400 mb-4">AI Systems</h4>
              <ul class="space-y-2 text-sm text-gray-300">
                <li><a href="/voice-ai" class="hover:text-cyan-400 transition-colors">Voice AI Assistant</a></li>
                <li><a href="/stable-diffusion" class="hover:text-cyan-400 transition-colors">Image Generation</a></li>
                <li><a href="/polaczek" class="hover:text-cyan-400 transition-colors">POLACZEK Agent</a></li>
                <li><a href="/agents" class="hover:text-cyan-400 transition-colors">Multi AI Chat</a></li>
              </ul>
            </div>
            <div>
              <h4 class="text-md font-semibold text-cyan-400 mb-4">Administration</h4>
              <ul class="space-y-2 text-sm text-gray-300">
                <li><a href="/admin" class="hover:text-cyan-400 transition-colors">Admin Dashboard</a></li>
                <li><a href="/admin/monitoring" class="hover:text-cyan-400 transition-colors">System Monitor</a></li>
                <li><a href="/admin/analytics" class="hover:text-cyan-400 transition-colors">Analytics</a></li>
                <li><a href="/backroom" class="hover:text-cyan-400 transition-colors">Backroom System</a></li>
              </ul>
            </div>
            <div>
              <h4 class="text-md font-semibold text-cyan-400 mb-4">Resources</h4>
              <ul class="space-y-2 text-sm text-gray-300">
                <li><a href="/docs" class="hover:text-cyan-400 transition-colors">Documentation</a></li>
                <li><a href="/api" class="hover:text-cyan-400 transition-colors">API Reference</a></li>
                <li><a href="/support" class="hover:text-cyan-400 transition-colors">Support</a></li>
                <li><a href="/status" class="hover:text-cyan-400 transition-colors">System Status</a></li>
              </ul>
            </div>
          </div>
          <div class="mt-8 pt-8 border-t border-cyan-500/30">
            <div class="flex flex-col md:flex-row justify-between items-center">
              <p class="text-gray-400 text-sm">© 2025 LUC de ZEN ON. Wszystkie prawa zastrzeżone.</p>
              <div class="flex space-x-4 mt-4 md:mt-0">
                <button id="theme-toggle" class="text-gray-400 hover:text-cyan-400 transition-colors">
                  <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                  </svg>
                </button>
                <a href="/privacy" class="text-gray-400 hover:text-cyan-400 transition-colors text-sm">Privacy</a>
                <a href="/terms" class="text-gray-400 hover:text-cyan-400 transition-colors text-sm">Terms</a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    )}
    
    <!-- Background Effects -->
    <div class="fixed inset-0 pointer-events-none z-0">
      <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl animate-pulse"></div>
      <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    </div>
    
    <!-- Scripts -->
    <script>
      // Remove loading screen
      window.addEventListener('load', () => {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.classList.add('hidden');
          setTimeout(() => {
            loadingScreen.remove();
          }, 500);
        }
      });
      
      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
        });
      }
      
      // Theme toggle functionality
      const themeToggle = document.getElementById('theme-toggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          // Theme switching logic can be implemented here
          console.log('Theme toggle clicked');
        });
      }
      
      // PWA Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
      
      // Performance monitoring
      if ('performance' in window) {
        window.addEventListener('load', () => {
          const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
          console.log('Page load time:', loadTime + 'ms');
        });
      }
    </script>
    
    <!-- Error Boundary -->
    <script>
      window.addEventListener('error', (event) => {
        console.error('Global error caught:', event.error);
        // Send error to monitoring service
      });
      
      window.addEventListener('unhandledrejection', (event) => {
        console.error('Unhandled promise rejection:', event.reason);
        // Send error to monitoring service
      });
    </script>
  </body>
</html>
