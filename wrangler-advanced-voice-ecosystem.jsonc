{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "voice-ai-ecosystem-advanced",
  "main": "src/workers/advanced-voice-agent.ts",
  "compatibility_date": "2025-01-15",
  "compatibility_flags": ["nodejs_compat"],
  
  "vars": {
    "ENVIRONMENT": "production",
    "DEBUG_MODE": "false",
    "MAX_CONNECTIONS": "1000",
    "DEFAULT_MODEL": "gpt-4o",
    "VOICE_QUALITY": "high",
    "RAG_SIMILARITY_THRESHOLD": "0.7"
  },

  "secrets": [
    "OPENAI_API_KEY",
    "ANTHROPIC_API_KEY",
    "DEEPSEEK_API_KEY",
    "PERPLEXITY_API_KEY",
    "GOOGLE_AI_STUDIO_API_KEY",
    "HUGGINGFACE_API_KEY",
    "ELEVENLABS_API_KEY",
    "CLOUDFLARE_API_TOKEN",
    "WEBHOOK_SECRET",
    "EMAIL_API_KEY"
  ],

  "kv_namespaces": [
    {
      "binding": "VOICE_CACHE",
      "id": "voice-cache-namespace",
      "preview_id": "voice-cache-preview"
    },
    {
      "binding": "USER_SESSIONS",
      "id": "user-sessions-namespace", 
      "preview_id": "user-sessions-preview"
    },
    {
      "binding": "AGENT_METRICS",
      "id": "agent-metrics-namespace",
      "preview_id": "agent-metrics-preview"
    }
  ],

  "r2_buckets": [
    {
      "binding": "VOICE_RECORDINGS",
      "bucket_name": "voice-recordings-bucket",
      "preview_bucket_name": "voice-recordings-preview"
    },
    {
      "binding": "DOCUMENT_STORAGE", 
      "bucket_name": "document-storage-bucket",
      "preview_bucket_name": "document-storage-preview"
    },
    {
      "binding": "BROWSER_SCREENSHOTS",
      "bucket_name": "browser-screenshots-bucket",
      "preview_bucket_name": "browser-screenshots-preview"
    }
  ],

  "vectorize": [
    {
      "binding": "VOICE_EMBEDDINGS",
      "index_name": "voice-embeddings-index",
      "dimensions": 768,
      "metric": "cosine"
    },
    {
      "binding": "CONVERSATION_VECTORS",
      "index_name": "conversation-vectors-index", 
      "dimensions": 1536,
      "metric": "euclidean"
    }
  ],

  "durable_objects": {
    "bindings": [
      {
        "name": "VoiceAgent",
        "class_name": "VoiceAgent"
      },
      {
        "name": "RAGAgent", 
        "class_name": "RAGAgent"
      },
      {
        "name": "BrowserAgent",
        "class_name": "BrowserAgent"
      },
      {
        "name": "WorkflowAgent",
        "class_name": "WorkflowAgent"
      },
      {
        "name": "MultiAgentOrchestrator",
        "class_name": "MultiAgentOrchestrator"
      }
    ]
  },

  "workflows": [
    {
      "name": "EMAIL_WORKFLOW",
      "class_name": "EmailWorkflow",
      "script_name": "email-workflows"
    },
    {
      "name": "RESEARCH_WORKFLOW", 
      "class_name": "ResearchWorkflow",
      "script_name": "research-workflows"
    },
    {
      "name": "PROCESSING_WORKFLOW",
      "class_name": "ProcessingWorkflow", 
      "script_name": "processing-workflows"
    },
    {
      "name": "NOTIFICATION_WORKFLOW",
      "class_name": "NotificationWorkflow",
      "script_name": "notification-workflows"
    }
  ],

  "services": [
    {
      "binding": "BROWSER_API",
      "service": "browser-rendering-service"
    },
    {
      "binding": "AI_GATEWAY",
      "service": "ai-gateway-service"
    },
    {
      "binding": "ANALYTICS_API", 
      "service": "analytics-service"
    }
  ],

  "queues": {
    "producers": [
      {
        "binding": "VOICE_PROCESSING_QUEUE",
        "queue": "voice-processing"
      },
      {
        "binding": "RAG_INDEXING_QUEUE",
        "queue": "rag-indexing"
      },
      {
        "binding": "BROWSER_TASKS_QUEUE",
        "queue": "browser-tasks"
      },
      {
        "binding": "NOTIFICATION_QUEUE",
        "queue": "notifications"
      }
    ],
    "consumers": [
      {
        "queue": "voice-processing",
        "max_batch_size": 10,
        "max_batch_timeout": 30,
        "max_retries": 3,
        "dead_letter_queue": "voice-processing-dlq"
      },
      {
        "queue": "rag-indexing", 
        "max_batch_size": 50,
        "max_batch_timeout": 60,
        "max_retries": 5,
        "dead_letter_queue": "rag-indexing-dlq"
      },
      {
        "queue": "browser-tasks",
        "max_batch_size": 5,
        "max_batch_timeout": 120,
        "max_retries": 2,
        "dead_letter_queue": "browser-tasks-dlq"
      }
    ]
  },

  "analytics_engine_datasets": [
    {
      "binding": "VOICE_ANALYTICS",
      "dataset": "voice_metrics"
    },
    {
      "binding": "AGENT_ANALYTICS",
      "dataset": "agent_performance"
    },
    {
      "binding": "USER_ANALYTICS", 
      "dataset": "user_interactions"
    }
  ],

  "ai": {
    "binding": "AI"
  },

  "browser": {
    "binding": "BROWSER"
  },

  "hyperdrive": [
    {
      "binding": "POSTGRES_DB",
      "id": "postgres-hyperdrive-id"
    }
  ],

  "d1_databases": [
    {
      "binding": "METADATA_DB",
      "database_name": "voice-ai-metadata",
      "database_id": "metadata-db-id"
    },
    {
      "binding": "ANALYTICS_DB",
      "database_name": "voice-ai-analytics", 
      "database_id": "analytics-db-id"
    }
  ],

  "migrations": [
    {
      "tag": "v1",
      "new_sqlite_classes": [
        "VoiceAgent",
        "RAGAgent", 
        "BrowserAgent",
        "WorkflowAgent",
        "MultiAgentOrchestrator"
      ]
    },
    {
      "tag": "v2",
      "new_classes": [
        "EmailWorkflow",
        "ResearchWorkflow",
        "ProcessingWorkflow",
        "NotificationWorkflow"
      ]
    }
  ],

  "triggers": {
    "crons": [
      {
        "cron": "0 */6 * * *",
        "name": "cleanup-old-data"
      },
      {
        "cron": "*/5 * * * *", 
        "name": "collect-metrics"
      },
      {
        "cron": "0 0 * * *",
        "name": "daily-analytics"
      },
      {
        "cron": "0 */1 * * *",
        "name": "health-check"
      }
    ]
  },

  "observability": {
    "enabled": true,
    "head_sampling_rate": 1.0
  },

  "upload": {
    "exclude": [
      "*.md",
      "*.txt", 
      "docs/**",
      "tests/**",
      "*.log",
      ".env*",
      "node_modules/**"
    ]
  },

  "limits": {
    "cpu_ms": 50000,
    "memory_mb": 512
  },

  "placement": {
    "mode": "smart"
  }
}
