{
  // COMPLETE CLOUDFLARE VOICE AI ECOSYSTEM - ENHANCED CONFIGURATION
  // Wrangler configuration with ALL discovered Cloudflare features
  
  "name": "voice-ai-ecosystem-complete",
  "main": "./src/workers/advanced-voice-agent.ts",
  "compatibility_date": "2024-09-05",
  "compatibility_flags": ["nodejs_compat"],
  
  // === ENVIRONMENT CONFIGURATION ===
  "env": {
    "development": {
      "name": "voice-ai-ecosystem-dev",
      "vars": {
        "ENVIRONMENT": "development",
        "DEBUG": "true",
        "AI_GATEWAY_ACCOUNT_ID": "your-account-id",
        "AI_GATEWAY_ID": "voice-ai-gateway"
      }
    },
    "staging": {
      "name": "voice-ai-ecosystem-staging", 
      "vars": {
        "ENVIRONMENT": "staging",
        "DEBUG": "false",
        "AI_GATEWAY_ACCOUNT_ID": "your-account-id",
        "AI_GATEWAY_ID": "voice-ai-gateway-staging"
      }
    },
    "production": {
      "name": "voice-ai-ecosystem-prod",
      "vars": {
        "ENVIRONMENT": "production",
        "DEBUG": "false",
        "AI_GATEWAY_ACCOUNT_ID": "your-account-id",
        "AI_GATEWAY_ID": "voice-ai-gateway-prod"
      }
    }
  },

  // === GLOBAL VARIABLES ===
  "vars": {
    "VOICE_MODEL": "@cf/meta/llama-3.1-8b-instruct",
    "EMBEDDING_MODEL": "@cf/baai/bge-base-en-v1.5",
    "IMAGE_MODEL": "@cf/lykon/dreamshaper-8-lcm",
    "SPEECH_MODEL": "@cf/openai/whisper",
    "TTS_MODEL": "@cf/microsoft/speecht5_tts",
    "MAX_VOICE_DURATION": "30",
    "MAX_FILE_SIZE": "50MB",
    "RATE_LIMIT_REQUESTS": "1000",
    "RATE_LIMIT_WINDOW": "3600",
    "SESSION_TIMEOUT": "1800",
    "WEBSOCKET_TIMEOUT": "300",
    "AI_GATEWAY_CACHE_TTL": "3600",
    "CUSTOM_COST_PER_TOKEN_IN": "0.000001",
    "CUSTOM_COST_PER_TOKEN_OUT": "0.000002"
  },

  // === SECRETS STORE INTEGRATION ===
  "secrets_store": {
    "store_id": "your-secrets-store-id",
    "bindings": [
      {
        "binding": "SECRETS_STORE",
        "store_id": "your-secrets-store-id"
      }
    ]
  },

  // === AI GATEWAY CONFIGURATION ===
  "ai_gateway": {
    "account_id": "your-account-id",
    "gateway_id": "voice-ai-gateway",
    "providers": [
      {
        "name": "openai",
        "endpoint": "https://api.openai.com/v1",
        "auth_type": "bearer",
        "cache_ttl": 3600,
        "rate_limit": 1000,
        "custom_costs": {
          "enabled": true,
          "default_per_token_in": 0.000001,
          "default_per_token_out": 0.000002
        }
      },
      {
        "name": "anthropic", 
        "endpoint": "https://api.anthropic.com",
        "auth_type": "x-api-key",
        "cache_ttl": 3600,
        "rate_limit": 500
      },
      {
        "name": "huggingface",
        "endpoint": "https://api-inference.huggingface.co/models",
        "auth_type": "bearer",
        "cache_ttl": 7200,
        "rate_limit": 2000
      },
      {
        "name": "google-vertex",
        "endpoint": "https://us-east4-aiplatform.googleapis.com/v1",
        "auth_type": "bearer",
        "cache_ttl": 3600,
        "rate_limit": 300
      },
      {
        "name": "perplexity",
        "endpoint": "https://api.perplexity.ai",
        "auth_type": "bearer",
        "cache_ttl": 3600,
        "rate_limit": 200
      }
    ],
    "websockets": {
      "enabled": true,
      "realtime_support": true,
      "non_realtime_support": true,
      "max_connections": 1000,
      "idle_timeout": 300,
      "message_size_limit": "1MB"
    }
  },

  // === WORKERS AI BINDING ===
  "ai": {
    "binding": "AI"
  },

  // === BROWSER RENDERING API ===
  "browser": {
    "binding": "BROWSER"
  },

  // === DURABLE OBJECTS (5 AGENTS) ===
  "durable_objects": {
    "bindings": [
      {
        "name": "VOICE_AGENT",
        "class_name": "VoiceAgent",
        "script_name": "voice-ai-ecosystem-complete"
      },
      {
        "name": "RAG_AGENT", 
        "class_name": "RAGAgent",
        "script_name": "voice-ai-ecosystem-complete"
      },
      {
        "name": "BROWSER_AGENT",
        "class_name": "BrowserAgent", 
        "script_name": "voice-ai-ecosystem-complete"
      },
      {
        "name": "AI_GATEWAY_AGENT",
        "class_name": "AIGatewayAgent",
        "script_name": "voice-ai-ecosystem-complete"
      },
      {
        "name": "WORKFLOW_AGENT",
        "class_name": "WorkflowAgent",
        "script_name": "voice-ai-ecosystem-complete"
      }
    ]
  },

  // === VECTORIZE INDEXES ===
  "vectorize": [
    {
      "binding": "VOICE_RAG_INDEX",
      "index_name": "voice-rag-index",
      "dimensions": 1536,
      "metric": "cosine"
    },
    {
      "binding": "CONVERSATION_INDEX",
      "index_name": "conversation-history-index", 
      "dimensions": 1536,
      "metric": "cosine"
    },
    {
      "binding": "KNOWLEDGE_INDEX",
      "index_name": "knowledge-base-index",
      "dimensions": 1536, 
      "metric": "cosine"
    }
  ],

  // === R2 STORAGE BUCKETS ===
  "r2_buckets": [
    {
      "binding": "VOICE_STORAGE",
      "bucket_name": "voice-ai-storage"
    },
    {
      "binding": "MEDIA_STORAGE", 
      "bucket_name": "voice-ai-media"
    },
    {
      "binding": "BACKUP_STORAGE",
      "bucket_name": "voice-ai-backups"
    }
  ],

  // === KV NAMESPACES ===
  "kv_namespaces": [
    {
      "binding": "SESSIONS",
      "id": "voice-ai-sessions",
      "preview_id": "voice-ai-sessions-preview"
    },
    {
      "binding": "VOICE_CACHE",
      "id": "voice-ai-cache", 
      "preview_id": "voice-ai-cache-preview"
    },
    {
      "binding": "USER_PROFILES",
      "id": "voice-ai-users",
      "preview_id": "voice-ai-users-preview"
    },
    {
      "binding": "AI_GATEWAY_CACHE",
      "id": "ai-gateway-cache",
      "preview_id": "ai-gateway-cache-preview"
    },
    {
      "binding": "WEBSOCKET_SESSIONS",
      "id": "websocket-sessions",
      "preview_id": "websocket-sessions-preview"
    }
  ],

  // === D1 DATABASES ===
  "d1_databases": [
    {
      "binding": "VOICE_DB",
      "database_name": "voice-ai-database",
      "database_id": "your-d1-database-id"
    },
    {
      "binding": "ANALYTICS_DB",
      "database_name": "voice-ai-analytics",
      "database_id": "your-analytics-db-id"
    }
  ],

  // === QUEUES ===
  "queues": {
    "consumers": [
      {
        "queue": "voice-processing-queue",
        "max_batch_size": 10,
        "max_batch_timeout": 30,
        "max_retries": 3,
        "dead_letter_queue": "voice-processing-dlq"
      },
      {
        "queue": "rag-indexing-queue",
        "max_batch_size": 50,
        "max_batch_timeout": 60,
        "max_retries": 5,
        "dead_letter_queue": "rag-indexing-dlq"
      },
      {
        "queue": "browser-tasks-queue",
        "max_batch_size": 5,
        "max_batch_timeout": 120,
        "max_retries": 3,
        "dead_letter_queue": "browser-tasks-dlq"
      },
      {
        "queue": "ai-gateway-queue",
        "max_batch_size": 100,
        "max_batch_timeout": 30,
        "max_retries": 3,
        "dead_letter_queue": "ai-gateway-dlq"
      }
    ],
    "producers": [
      {
        "binding": "VOICE_QUEUE",
        "queue": "voice-processing-queue"
      },
      {
        "binding": "RAG_QUEUE", 
        "queue": "rag-indexing-queue"
      },
      {
        "binding": "BROWSER_QUEUE",
        "queue": "browser-tasks-queue"
      },
      {
        "binding": "AI_GATEWAY_QUEUE",
        "queue": "ai-gateway-queue"
      }
    ]
  },

  // === WORKFLOWS (4 DEFINITIONS) ===
  "workflows": [
    {
      "binding": "VOICE_WORKFLOW",
      "class_name": "VoiceProcessingWorkflow"
    },
    {
      "binding": "RAG_WORKFLOW",
      "class_name": "RAGIndexingWorkflow"
    },
    {
      "binding": "BROWSER_WORKFLOW", 
      "class_name": "BrowserAutomationWorkflow"
    },
    {
      "binding": "AI_GATEWAY_WORKFLOW",
      "class_name": "AIGatewayWorkflow"
    }
  ],

  // === ANALYTICS ENGINE ===
  "analytics_engine_datasets": [
    {
      "binding": "VOICE_ANALYTICS",
      "dataset": "voice_ai_metrics"
    },
    {
      "binding": "PERFORMANCE_ANALYTICS",
      "dataset": "performance_metrics"
    },
    {
      "binding": "AI_GATEWAY_ANALYTICS",
      "dataset": "ai_gateway_metrics"
    },
    {
      "binding": "WEBSOCKET_ANALYTICS",
      "dataset": "websocket_metrics"
    }
  ],

  // === CRON TRIGGERS ===
  "triggers": {
    "crons": [
      {
        "cron": "0 */6 * * *",
        "handler": "scheduledCleanup"
      },
      {
        "cron": "0 0 * * *", 
        "handler": "dailyAnalytics"
      },
      {
        "cron": "*/15 * * * *",
        "handler": "healthCheck"
      },
      {
        "cron": "0 */12 * * *",
        "handler": "ragIndexMaintenance"
      },
      {
        "cron": "0 1 * * 0",
        "handler": "weeklyBackup"
      }
    ]
  },

  // === LIMITS & PERFORMANCE ===
  "limits": {
    "cpu_ms": 30000,
    "memory_mb": 512,
    "subrequest_limit": 1000
  },

  // === OBSERVABILITY ===
  "observability": {
    "enabled": true,
    "head_sampling_rate": 0.01,
    "tail_sampling": {
      "enabled": true,
      "sampling_rate": 0.1
    }
  },

  // === NODE.JS COMPATIBILITY ===
  "node_compat": true,

  // === MINIFLARE CONFIG FOR LOCAL DEVELOPMENT ===
  "miniflare": {
    "kv_persist": "./kv-data",
    "d1_persist": "./d1-data", 
    "r2_persist": "./r2-data",
    "durable_objects_persist": "./do-data"
  },

  // === WEBSOCKET HIBERNATION ===
  "websocket_hibernation": true,

  // === CUSTOM DOMAINS ===
  "routes": [
    {
      "pattern": "voice-ai.your-domain.com/*",
      "zone_name": "your-domain.com"
    },
    {
      "pattern": "api.voice-ai.your-domain.com/*", 
      "zone_name": "your-domain.com"
    }
  ],

  // === PLACEMENT (for better performance) ===
  "placement": {
    "mode": "smart"
  },

  // === BUILD CONFIGURATION ===
  "build": {
    "command": "npm run build",
    "cwd": "./",
    "watch_dir": "./src"
  },

  // === TAIL WORKERS FOR MONITORING ===
  "tail_consumers": [
    {
      "service": "voice-ai-monitor",
      "environment": "production"
    }
  ],

  // === SERVICE BINDINGS ===
  "services": [
    {
      "binding": "AUTH_SERVICE",
      "service": "voice-ai-auth"
    },
    {
      "binding": "METRICS_SERVICE",
      "service": "voice-ai-metrics"
    }
  ],

  // === HYPERDRIVE (for database connections) ===
  "hyperdrive": [
    {
      "binding": "POSTGRES_HYPERDRIVE",
      "id": "your-hyperdrive-id"
    }
  ],

  // === EMAIL SENDING ===
  "send_email": [
    {
      "binding": "EMAIL_SERVICE",
      "destination_address": "admin@your-domain.com"
    }
  ]
}
