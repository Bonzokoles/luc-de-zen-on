<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Agent Connections - MyBonzo</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            border: 1px solid #333;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,255,0,0.05);
        }
        .test-result {
            margin: 10px 0;
            padding: 8px;
            border-left: 4px solid #00ff00;
            background: rgba(0,255,0,0.1);
        }
        .error {
            border-left-color: #ff0000;
            background: rgba(255,0,0,0.1);
            color: #ff6666;
        }
        .success {
            border-left-color: #00ff00;
            background: rgba(0,255,0,0.1);
            color: #66ff66;
        }
        button {
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #00ff00;
            color: #000;
        }
        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #333;
            color: #fff;
            padding: 10px;
            text-align: center;
            z-index: 1000;
        }
        .main-content {
            margin-top: 60px;
        }
    </style>
</head>
<body>
    <div class="status-bar">
        üîß LOCAL TEST ENVIRONMENT - Agent Connection Validator
    </div>
    
    <div class="main-content">
        <h1>üöÄ AGENT CONNECTION TEST SUITE</h1>
        
        <div class="test-section">
            <h2>üì° API Availability Test</h2>
            <button onclick="testAPIs()">Test All APIs</button>
            <div id="apiResults"></div>
        </div>
        
        <div class="test-section">
            <h2>ü§ñ Agent System Test</h2>
            <button onclick="testAgentSystem()">Test Agent System</button>
            <div id="agentResults"></div>
        </div>
        
        <div class="test-section">
            <h2>üîó Agent-Visualizer Connection Test</h2>
            <button onclick="testConnections()">Test Connections</button>
            <div id="connectionResults"></div>
        </div>
        
        <div class="test-section">
            <h2>üéµ Music Agent Test</h2>
            <button onclick="testMusicAgent()">Test Music System</button>
            <button onclick="testVisualizerIntegration()">Test Visualizer Integration</button>
            <div id="musicResults"></div>
        </div>
        
        <div class="test-section">
            <h2>üé§ Voice Agent Test</h2>
            <button onclick="testVoiceAgent()">Test Voice System</button>
            <div id="voiceResults"></div>
        </div>
        
        <div class="test-section">
            <h2>üìã Test Summary</h2>
            <div id="summaryResults"></div>
        </div>
    </div>

    <!-- Include the actual floating buttons script -->
    <script src="dist/scripts/floating-buttons-real.js"></script>
    
    <!-- Test Scripts -->
    <script>
        let testResults = {
            apis: {},
            agents: {},
            connections: {},
            summary: {}
        };

        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(div);
            console.log(message);
        }

        function testAPIs() {
            logResult('apiResults', 'üîç Testing API availability...', 'info');
            
            const apis = [
                { name: 'VOICE_DEBUG', key: 'VOICE_DEBUG' },
                { name: 'CYBER_MUSIC', key: 'CYBER_MUSIC' },
                { name: 'CYBER_MUSIC_PL', key: 'CYBER_MUSIC_PL' },
                { name: 'mybonzoButtons', key: 'mybonzoButtons' }
            ];

            let passedTests = 0;
            apis.forEach(api => {
                const found = typeof window[api.key] !== 'undefined';
                testResults.apis[api.name] = found;
                
                if (found) {
                    logResult('apiResults', `‚úÖ ${api.name}: FOUND`, 'success');
                    if (window[api.key] && typeof window[api.key] === 'object') {
                        const methods = Object.keys(window[api.key]);
                        logResult('apiResults', `   üìã Methods: ${methods.join(', ')}`, 'info');
                    }
                    passedTests++;
                } else {
                    logResult('apiResults', `‚ùå ${api.name}: NOT FOUND`, 'error');
                }
            });
            
            logResult('apiResults', `üìä API Test Summary: ${passedTests}/${apis.length} passed`, passedTests === apis.length ? 'success' : 'error');
        }

        function testAgentSystem() {
            logResult('agentResults', 'ü§ñ Testing agent system...', 'info');
            
            if (!window.mybonzoButtons) {
                logResult('agentResults', '‚ùå mybonzoButtons not found - initializing...', 'error');
                // Try to initialize
                try {
                    window.mybonzoButtons = new MyBonzoFloatingButtons();
                    logResult('agentResults', '‚úÖ mybonzoButtons initialized manually', 'success');
                } catch (e) {
                    logResult('agentResults', `üí• Failed to initialize: ${e.message}`, 'error');
                    return;
                }
            }
            
            const agents = window.mybonzoButtons.agents;
            logResult('agentResults', `üìä Found ${agents.size} configured agents`, 'info');
            
            let workingAgents = 0;
            ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'].forEach(id => {
                const agent = agents.get(id);
                if (agent) {
                    testResults.agents[`agent${id}`] = true;
                    logResult('agentResults', `‚úÖ Agent ${id}: ${agent.name}`, 'success');
                    workingAgents++;
                } else {
                    testResults.agents[`agent${id}`] = false;
                    logResult('agentResults', `‚ùå Agent ${id}: NOT CONFIGURED`, 'error');
                }
            });
            
            logResult('agentResults', `üìä Agent System Summary: ${workingAgents}/10 agents configured`, workingAgents >= 8 ? 'success' : 'error');
        }

        function testConnections() {
            logResult('connectionResults', 'üîó Testing agent-visualizer connections...', 'info');
            
            const connections = [
                {
                    name: 'Agent 01 (Voice) ‚Üí VOICE_DEBUG',
                    test: () => window.VOICE_DEBUG && window.mybonzoButtons && window.mybonzoButtons.agents.has('1')
                },
                {
                    name: 'Agent 02 (Music) ‚Üí CYBER_MUSIC',
                    test: () => window.CYBER_MUSIC && window.mybonzoButtons && window.mybonzoButtons.agents.has('2')
                },
                {
                    name: 'Agent 02 (Music) ‚Üí CYBER_MUSIC_PL',
                    test: () => window.CYBER_MUSIC_PL && window.mybonzoButtons && window.mybonzoButtons.agents.has('2')
                }
            ];
            
            let workingConnections = 0;
            connections.forEach(conn => {
                const working = conn.test();
                testResults.connections[conn.name] = working;
                
                if (working) {
                    logResult('connectionResults', `‚úÖ ${conn.name}: CONNECTED`, 'success');
                    workingConnections++;
                } else {
                    logResult('connectionResults', `‚ùå ${conn.name}: DISCONNECTED`, 'error');
                }
            });
            
            logResult('connectionResults', `üìä Connection Summary: ${workingConnections}/${connections.length} connections working`, workingConnections >= 2 ? 'success' : 'error');
        }

        function testMusicAgent() {
            logResult('musicResults', 'üéµ Testing music agent functionality...', 'info');
            
            if (!window.mybonzoButtons) {
                logResult('musicResults', '‚ùå mybonzoButtons not available', 'error');
                return;
            }
            
            // Test Agent 02 activation
            try {
                const agent02 = window.mybonzoButtons.agents.get('2');
                if (agent02) {
                    logResult('musicResults', '‚úÖ Agent 02 (Music) found', 'success');
                    logResult('musicResults', `   üéØ Handler: ${typeof agent02.handler === 'function' ? 'AVAILABLE' : 'MISSING'}`, agent02.handler ? 'success' : 'error');
                    
                    // Test activation (but don't actually activate)
                    logResult('musicResults', 'üß™ Testing handler execution...', 'info');
                    // agent02.handler(); // Uncomment to actually test
                    logResult('musicResults', '‚ö†Ô∏è Handler test skipped (would open widget)', 'info');
                } else {
                    logResult('musicResults', '‚ùå Agent 02 not found', 'error');
                }
            } catch (e) {
                logResult('musicResults', `üí• Error testing music agent: ${e.message}`, 'error');
            }
        }

        function testVisualizerIntegration() {
            logResult('musicResults', 'üìä Testing visualizer integration...', 'info');
            
            // Test if connectToVisualizers method exists
            if (window.mybonzoButtons && typeof window.mybonzoButtons.connectToVisualizers === 'function') {
                logResult('musicResults', '‚úÖ connectToVisualizers method found', 'success');
                
                // Create test audio element
                const testAudio = new Audio();
                try {
                    window.mybonzoButtons.connectToVisualizers(testAudio);
                    logResult('musicResults', '‚úÖ Visualizer connection test passed', 'success');
                } catch (e) {
                    logResult('musicResults', `‚ö†Ô∏è Visualizer connection warning: ${e.message}`, 'error');
                }
            } else {
                logResult('musicResults', '‚ùå connectToVisualizers method not found', 'error');
            }
        }

        function testVoiceAgent() {
            logResult('voiceResults', 'üé§ Testing voice agent functionality...', 'info');
            
            if (!window.mybonzoButtons) {
                logResult('voiceResults', '‚ùå mybonzoButtons not available', 'error');
                return;
            }
            
            // Test Agent 01/91 availability
            const agent01 = window.mybonzoButtons.agents.get('1');
            if (agent01) {
                logResult('voiceResults', '‚úÖ Agent 01 (Voice) found', 'success');
                logResult('voiceResults', `   üéØ Handler: ${typeof agent01.handler === 'function' ? 'AVAILABLE' : 'MISSING'}`, agent01.handler ? 'success' : 'error');
            } else {
                logResult('voiceResults', '‚ùå Agent 01 not found', 'error');
            }
            
            // Test Web Speech API
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                logResult('voiceResults', '‚úÖ Web Speech Recognition API available', 'success');
            } else {
                logResult('voiceResults', '‚ö†Ô∏è Web Speech Recognition API not supported', 'error');
            }
            
            if ('speechSynthesis' in window) {
                logResult('voiceResults', '‚úÖ Speech Synthesis API available', 'success');
            } else {
                logResult('voiceResults', '‚ö†Ô∏è Speech Synthesis API not supported', 'error');
            }
        }

        // Auto-initialize on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                logResult('summaryResults', 'üöÄ Starting automated tests...', 'info');
                testAPIs();
                setTimeout(() => testAgentSystem(), 1000);
                setTimeout(() => testConnections(), 2000);
                setTimeout(() => {
                    const apiScore = Object.values(testResults.apis).filter(Boolean).length;
                    const agentScore = Object.values(testResults.agents).filter(Boolean).length;
                    const connScore = Object.values(testResults.connections).filter(Boolean).length;
                    const total = apiScore + agentScore + connScore;
                    const max = Object.keys(testResults.apis).length + Object.keys(testResults.agents).length + Object.keys(testResults.connections).length;
                    
                    logResult('summaryResults', `üèÜ FINAL SCORE: ${total}/${max} (${Math.round(total/max*100)}%)`, total >= max*0.8 ? 'success' : 'error');
                    
                    if (total >= max * 0.8) {
                        logResult('summaryResults', 'üéâ SYSTEM STATUS: OPERATIONAL', 'success');
                    } else {
                        logResult('summaryResults', '‚ö†Ô∏è SYSTEM STATUS: NEEDS ATTENTION', 'error');
                    }
                }, 3000);
            }, 500);
        });
    </script>
</body>
</html>