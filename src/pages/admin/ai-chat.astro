---
import UniversalPageLayout from "../../layouts/UniversalPageLayout.astro";
import GlassPanel from "../../layouts/components/GlassPanel.astro";
import CyberpunkButton from "../../layouts/components/CyberpunkButton.astro";

const pageTitle = "Admin AI Assistant";
const pageDescription = "Inteligentny asystent AI dla administrator√≥w systemu MyBonzo";
const pageQuote = "Technologia wspiera ludzi, a nie na odwr√≥t.";
const pageAuthor = "MyBonzo Admin AI";
---

<UniversalPageLayout 
  pageTitle={pageTitle}
  pageDescription={pageDescription}
  pageQuote={pageQuote}
  pageAuthor={pageAuthor}
  showRandomQuote={false}
>
    <!-- Admin AI Chat Interface -->
    <GlassPanel title="ü§ñ Admin AI Assistant" variant="highlight" padding="xl">
        <div id="admin-ai-chat" style="height: 600px; display: flex; flex-direction: column;">
            
            <!-- Chat Controls -->
            <div style="display: flex; gap: 15px; margin-bottom: 20px; padding: 15px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,217,255,0.3); border-radius: 8px;">
                <div style="flex: 1;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 5px; display: block;">Model AI:</label>
                    <select id="ai-model" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.6); border: 1px solid rgba(0,217,255,0.5); border-radius: 4px; color: #00d9ff; font-family: 'Courier New', monospace;">
                        <option value="@cf/meta/llama-3.1-8b-instruct">Llama 3.1 8B (Zalecany)</option>
                        <option value="@cf/mistral/mistral-7b-instruct-v0.1">Mistral 7B</option>
                        <option value="@cf/qwen/qwen1.5-7b-chat-awq">Qwen 1.5 7B</option>
                        <option value="@cf/huggingface/bielik-7b-instruct-v0.1">Bielik 7B (Polski)</option>
                    </select>
                </div>
                <div style="flex: 1;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 5px; display: block;">Tryb administratora:</label>
                    <select id="admin-mode" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.6); border: 1px solid rgba(0,217,255,0.5); border-radius: 4px; color: #00d9ff; font-family: 'Courier New', monospace;">
                        <option value="general">Og√≥lny Administrator</option>
                        <option value="technical">Wsparcie Techniczne</option>
                        <option value="security">Bezpiecze≈Ñstwo</option>
                        <option value="analytics">Analityka</option>
                        <option value="deployment">Deployment</option>
                    </select>
                </div>
                <div style="display: flex; align-items: end;">
                    <CyberpunkButton 
                        text="üîÑ Reset" 
                        variant="outline" 
                        size="sm"
                        onclick="clearChat()"
                    />
                </div>
            </div>

            <!-- Messages Container -->
            <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 20px; background: rgba(0,0,0,0.2); border: 1px solid rgba(0,217,255,0.2); border-radius: 8px; margin-bottom: 15px;">
                <div class="welcome-message" style="background: rgba(0,217,255,0.1); border-left: 4px solid #00d9ff; padding: 15px; margin-bottom: 15px; border-radius: 4px;">
                    <div style="color: #00d9ff; font-weight: bold; margin-bottom: 8px;">ü§ñ Admin AI Assistant</div>
                    <div style="color: rgba(255,255,255,0.9);">
                        Witaj w panelu Admin AI Assistant! Jestem tutaj, aby pom√≥c Ci w zadaniach administracyjnych:
                        <ul style="margin: 10px 0; padding-left: 20px; color: rgba(255,255,255,0.8);">
                            <li>Monitorowanie systemu i diagnostyka</li>
                            <li>Analiza log√≥w i problem√≥w</li>
                            <li>Konfiguracja i deployment</li>
                            <li>ZarzƒÖdzanie u≈ºytkownikami i zabezpieczeniami</li>
                            <li>Optymalizacja wydajno≈õci</li>
                        </ul>
                        Zadaj pytanie lub opisz problem, z kt√≥rym potrzebujesz pomocy.
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div style="display: flex; gap: 10px; align-items: end;">
                <div style="flex: 1;">
                    <textarea 
                        id="chat-input" 
                        placeholder="Zadaj pytanie administracyjne..." 
                        style="width: 100%; padding: 12px; background: rgba(0,0,0,0.6); border: 1px solid rgba(0,217,255,0.5); border-radius: 4px; color: white; resize: vertical; min-height: 50px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;"
                        onkeypress="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage();}"
                    ></textarea>
                </div>
                <div>
                    <CyberpunkButton 
                        text="Wy≈õlij" 
                        variant="primary" 
                        size="md"
                        onclick="sendMessage()"
                        id="send-button"
                    />
                </div>
            </div>
        </div>
    </GlassPanel>

    <!-- Quick Admin Actions -->
    <GlassPanel title="‚ö° Szybkie akcje administracyjne" variant="default" padding="lg">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
            
            <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(0,217,255,0.3); border-radius: 8px; padding: 15px;">
                <h4 style="color: #00d9ff; margin-bottom: 10px;">üîç Diagnostyka systemu</h4>
                <CyberpunkButton 
                    text="Sprawd≈∫ status systemu" 
                    variant="outline" 
                    size="sm"
                    onclick="askAI('Sprawd≈∫ aktualny status wszystkich komponent√≥w systemu MyBonzo. Czy wszystkie workery dzia≈ÇajƒÖ prawid≈Çowo?')"
                />
            </div>

            <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(0,217,255,0.3); border-radius: 8px; padding: 15px;">
                <h4 style="color: #00d9ff; margin-bottom: 10px;">üìä Analiza wydajno≈õci</h4>
                <CyberpunkButton 
                    text="Analizuj wydajno≈õƒá" 
                    variant="outline" 
                    size="sm"
                    onclick="askAI('Przeanalizuj wydajno≈õƒá aplikacji. Jakie sƒÖ g≈Ç√≥wne bottlenecki i jak mo≈ºna je zoptymalizowaƒá?')"
                />
            </div>

            <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(0,217,255,0.3); border-radius: 8px; padding: 15px;">
                <h4 style="color: #00d9ff; margin-bottom: 10px;">üõ°Ô∏è Bezpiecze≈Ñstwo</h4>
                <CyberpunkButton 
                    text="Sprawd≈∫ zabezpieczenia" 
                    variant="warning" 
                    size="sm"
                    onclick="askAI('Przeanalizuj zabezpieczenia systemu. Czy sƒÖ jakie≈õ potencjalne luki w bezpiecze≈Ñstwie?')"
                />
            </div>

            <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(0,217,255,0.3); border-radius: 8px; padding: 15px;">
                <h4 style="color: #00d9ff; margin-bottom: 10px;">üöÄ Deployment</h4>
                <CyberpunkButton 
                    text="Pomocy z deployment" 
                    variant="outline" 
                    size="sm"
                    onclick="askAI('Potrzebujƒô pomocy z deployment. Jakie sƒÖ najlepsze praktyki dla bezpiecznego wdro≈ºenia?')"
                />
            </div>

            <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(0,217,255,0.3); border-radius: 8px; padding: 15px;">
                <h4 style="color: #00d9ff; margin-bottom: 10px;">üë• ZarzƒÖdzanie u≈ºytkownikami</h4>
                <CyberpunkButton 
                    text="Pomocy z u≈ºytkownikami" 
                    variant="outline" 
                    size="sm"
                    onclick="askAI('Jak mogƒô efektywnie zarzƒÖdzaƒá u≈ºytkownikami systemu? Jakie sƒÖ najlepsze praktyki?')"
                />
            </div>

            <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(0,217,255,0.3); border-radius: 8px; padding: 15px;">
                <h4 style="color: #00d9ff; margin-bottom: 10px;">üìù Logi i debugging</h4>
                <CyberpunkButton 
                    text="Analizuj logi" 
                    variant="outline" 
                    size="sm"
                    onclick="askAI('Pom√≥≈º mi przeanalizowaƒá logi systemu. Jak zidentyfikowaƒá i rozwiƒÖzaƒá problemy?')"
                />
            </div>
        </div>
    </GlassPanel>

    <script>
        let isLoading = false;
        let messageHistory = [];

        // Admin mode configurations
        const adminModes = {
            general: {
                name: "Og√≥lny Administrator",
                icon: "üë§",
                color: "#00d9ff"
            },
            technical: {
                name: "Wsparcie Techniczne", 
                icon: "üîß",
                color: "#fbbf24"
            },
            security: {
                name: "Bezpiecze≈Ñstwo",
                icon: "üõ°Ô∏è", 
                color: "#ef4444"
            },
            analytics: {
                name: "Analityka",
                icon: "üìä",
                color: "#10b981"
            },
            deployment: {
                name: "Deployment",
                icon: "üöÄ",
                color: "#8b5cf6"
            }
        };

        function getAdminModeConfig() {
            const mode = document.getElementById('admin-mode').value;
            return adminModes[mode] || adminModes.general;
        }

        function addMessage(content, isUser = false, isError = false) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            const modeConfig = getAdminModeConfig();
            
            messageDiv.style.cssText = `
                margin-bottom: 15px;
                padding: 15px;
                border-radius: 8px;
                ${isUser 
                    ? `background: rgba(0,217,255,0.1); border-left: 4px solid #00d9ff; margin-left: 20px;`
                    : isError
                        ? `background: rgba(239,68,68,0.1); border-left: 4px solid #ef4444;`
                        : `background: rgba(0,0,0,0.4); border-left: 4px solid ${modeConfig.color};`
                }
            `;

            const header = isUser 
                ? `<div style="color: #00d9ff; font-weight: bold; margin-bottom: 8px;">üë§ Administrator</div>`
                : isError
                    ? `<div style="color: #ef4444; font-weight: bold; margin-bottom: 8px;">‚ùå B≈ÇƒÖd</div>`
                    : `<div style="color: ${modeConfig.color}; font-weight: bold; margin-bottom: 8px;">${modeConfig.icon} ${modeConfig.name}</div>`;

            messageDiv.innerHTML = `
                ${header}
                <div style="color: rgba(255,255,255,0.9); line-height: 1.6; white-space: pre-wrap;">${content}</div>
            `;

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');
            const message = input.value.trim();

            if (!message || isLoading) return;

            // Add user message
            addMessage(message, true);
            messageHistory.push({ role: 'user', content: message });

            // Clear input and set loading state
            input.value = '';
            isLoading = true;
            sendButton.textContent = 'My≈õlƒô...';
            sendButton.style.opacity = '0.6';

            try {
                const response = await fetch('/api/admin/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        model: document.getElementById('ai-model').value,
                        mode: document.getElementById('admin-mode').value,
                        history: messageHistory.slice(-10) // Last 10 messages for context
                    })
                });

                const data = await response.json();

                if (data.success) {
                    addMessage(data.response);
                    messageHistory.push({ role: 'assistant', content: data.response });
                } else {
                    addMessage(`B≈ÇƒÖd: ${data.error}`, false, true);
                }

            } catch (error) {
                console.error('Chat error:', error);
                addMessage(`B≈ÇƒÖd po≈ÇƒÖczenia: ${error.message}`, false, true);
            } finally {
                isLoading = false;
                sendButton.textContent = 'Wy≈õlij';
                sendButton.style.opacity = '1';
            }
        }

        function askAI(predefinedQuestion) {
            document.getElementById('chat-input').value = predefinedQuestion;
            sendMessage();
        }

        function clearChat() {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = `
                <div class="welcome-message" style="background: rgba(0,217,255,0.1); border-left: 4px solid #00d9ff; padding: 15px; margin-bottom: 15px; border-radius: 4px;">
                    <div style="color: #00d9ff; font-weight: bold; margin-bottom: 8px;">ü§ñ Admin AI Assistant</div>
                    <div style="color: rgba(255,255,255,0.9);">
                        Chat zosta≈Ç wyczyszczony. Jak mogƒô Ci pom√≥c w zadaniach administracyjnych?
                    </div>
                </div>
            `;
            messageHistory = [];
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on input
            document.getElementById('chat-input').focus();
            
            // Add mode change listener
            document.getElementById('admin-mode').addEventListener('change', function() {
                const modeConfig = getAdminModeConfig();
                const welcomeMsg = document.querySelector('.welcome-message');
                if (welcomeMsg) {
                    welcomeMsg.style.borderLeftColor = modeConfig.color;
                    welcomeMsg.querySelector('div').innerHTML = `${modeConfig.icon} Admin AI Assistant - ${modeConfig.name}`;
                }
            });
        });
    </script>
</UniversalPageLayout>