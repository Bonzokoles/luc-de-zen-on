---
import UniversalPageLayout from "../layouts/UniversalPageLayout.astro";
import GlassPanel from "../layouts/components/GlassPanel.astro";
import CyberpunkButton from "../layouts/components/CyberpunkButton.astro";

const pageTitle = "Quiz AI";
const pageDescription = "Testuj swojÄ… wiedzÄ™ z interaktywnym quizem AI";
const pageQuote = "Ucz siÄ™ z kaĹĽdym pytaniem.";
const pageAuthor = "AI Assistant";
---

<UniversalPageLayout 
  pageTitle={pageTitle}
  pageDescription={pageDescription}
  pageQuote={pageQuote}
  pageAuthor={pageAuthor}
  showRandomQuote={false}
>
    <GlassPanel title="Quiz AI - Interaktywny Test Wiedzy" variant="highlight" padding="lg">
        <div style="margin-bottom: 20px;">
            <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem; line-height: 1.6;">
                SprawdĹş swojÄ… wiedzÄ™ z rĂłĹĽnych dziedzin w naszym interaktywnym quizie napÄ™dzanym sztucznÄ… inteligencjÄ….
                Pytania dostosowujÄ… siÄ™ do Twojego poziomu!
            </p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
            <div style="background: rgba(0,217,255,0.1); padding: 15px; border: 1px solid rgba(0,217,255,0.3); border-radius: 8px;">
                <div style="color: #00d9ff; font-weight: 600; margin-bottom: 5px;">đź§  Adaptacyjny poziom</div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Pytania dostosowane do Ciebie</div>
            </div>
            <div style="background: rgba(0,217,255,0.1); padding: 15px; border: 1px solid rgba(0,217,255,0.3); border-radius: 8px;">
                <div style="color: #00d9ff; font-weight: 600; margin-bottom: 5px;">đź“Š Statystyki na ĹĽywo</div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Ĺšledzenie postÄ™pĂłw</div>
            </div>
            <div style="background: rgba(0,217,255,0.1); padding: 15px; border: 1px solid rgba(0,217,255,0.3); border-radius: 8px;">
                <div style="color: #00d9ff; font-weight: 600; margin-bottom: 5px;">đźŽŻ RĂłĹĽne kategorie</div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Nauka, technologia, kultura</div>
            </div>
        </div>

        <!-- Quiz Interface -->
        <div style="background: rgba(0,0,0,0.4); border: 1px solid rgba(0,217,255,0.3); border-radius: 12px; padding: 24px; margin-bottom: 30px;">
            
            <!-- Quiz Settings -->
            <div id="quizSettings" style="text-align: center;">
                <h3 style="color: #00d9ff; margin-bottom: 20px;">Wybierz kategoriÄ™ i poziom trudnoĹ›ci</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; color: #00d9ff; font-weight: 600; margin-bottom: 8px;">Kategoria</label>
                        <select id="quizCategory" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.6); border: 1px solid rgba(0,217,255,0.3); border-radius: 6px; color: white;">
                            <option value="general">Wiedza ogĂłlna</option>
                            <option value="science">Nauka i technologia</option>
                            <option value="history">Historia</option>
                            <option value="culture">Kultura i sztuka</option>
                            <option value="programming">Programowanie</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #00d9ff; font-weight: 600; margin-bottom: 8px;">Poziom</label>
                        <select id="quizDifficulty" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.6); border: 1px solid rgba(0,217,255,0.3); border-radius: 6px; color: white;">
                            <option value="beginner">PoczÄ…tkujÄ…cy</option>
                            <option value="intermediate">Ĺšredniozaawansowany</option>
                            <option value="advanced">Zaawansowany</option>
                            <option value="expert">Ekspert</option>
                        </select>
                    </div>
                </div>

                <button 
                    onclick="startQuiz()"
                    style="background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%); border: none; border-radius: 8px; padding: 12px 30px; color: black; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: all 0.3s ease;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0,217,255,0.4)'"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                >
                    đźš€ Rozpocznij Quiz
                </button>
            </div>

            <!-- Quiz Game -->
            <div id="quizGame" style="display: none;">
                <!-- Progress Bar -->
                <div style="background: rgba(0,0,0,0.4); border-radius: 10px; padding: 4px; margin-bottom: 20px;">
                    <div id="progressBar" style="background: linear-gradient(90deg, #00d9ff, #0099cc); height: 8px; border-radius: 6px; width: 0%; transition: width 0.3s ease;"></div>
                </div>

                <!-- Question Counter -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="color: #00d9ff; font-weight: 600;">Pytanie </span>
                    <span id="questionNumber" style="color: white;">1</span>
                    <span style="color: #00d9ff;"> z </span>
                    <span id="totalQuestions" style="color: white;">10</span>
                </div>

                <!-- Question -->
                <div style="background: rgba(0,217,255,0.1); border: 1px solid rgba(0,217,255,0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center;">
                    <h3 id="questionText" style="color: white; margin: 0; font-size: 1.2rem; line-height: 1.4;"></h3>
                </div>

                <!-- Answers -->
                <div id="answersContainer" style="display: grid; gap: 12px; margin-bottom: 30px;">
                    <!-- Answers will be populated by JavaScript -->
                </div>

                <!-- Quiz Controls -->
                <div style="text-align: center;">
                    <button 
                        id="nextButton"
                        onclick="nextQuestion()"
                        style="background: rgba(0,217,255,0.2); border: 1px solid #00d9ff; border-radius: 6px; padding: 10px 20px; color: #00d9ff; cursor: pointer; transition: all 0.3s ease; display: none;"
                        onmouseover="this.style.background='rgba(0,217,255,0.3)'"
                        onmouseout="this.style.background='rgba(0,217,255,0.2)'"
                    >
                        NastÄ™pne pytanie â†’
                    </button>
                </div>
            </div>

            <!-- Quiz Results -->
            <div id="quizResults" style="display: none; text-align: center;">
                <h3 style="color: #00d9ff; margin-bottom: 20px;">Wyniki Quizu</h3>
                
                <div style="background: rgba(0,217,255,0.1); border: 1px solid rgba(0,217,255,0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="font-size: 2rem; color: #00d9ff; font-weight: 700; margin-bottom: 10px;" id="finalScore">85%</div>
                    <div style="color: rgba(255,255,255,0.8);" id="scoreMessage">Ĺšwietny wynik!</div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 8px;">
                        <div style="color: #00d9ff; font-weight: 600;">Poprawne</div>
                        <div style="color: white; font-size: 1.5rem;" id="correctAnswers">8</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 8px;">
                        <div style="color: #00d9ff; font-weight: 600;">BĹ‚Ä™dne</div>
                        <div style="color: white; font-size: 1.5rem;" id="incorrectAnswers">2</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 8px;">
                        <div style="color: #00d9ff; font-weight: 600;">Czas</div>
                        <div style="color: white; font-size: 1.5rem;" id="totalTime">2:30</div>
                    </div>
                </div>

                <button 
                    onclick="resetQuiz()"
                    style="background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%); border: none; border-radius: 8px; padding: 12px 30px; color: black; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: all 0.3s ease; margin-right: 10px;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0,217,255,0.4)'"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                >
                    đź”„ SprĂłbuj ponownie
                </button>
            </div>

            <!-- Loading -->
            <div id="quizLoading" style="display: none; text-align: center; color: #00d9ff; margin: 40px 0;">
                <div style="display: inline-block; border: 3px solid rgba(0,217,255,0.3); border-top: 3px solid #00d9ff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
                <p style="margin-top: 10px;">Generowanie pytaĹ„...</p>
            </div>
        </div>

        <div style="text-align: center;">
            <CyberpunkButton text="PowrĂłt do gĹ‚Ăłwnej" href="/" variant="outline" size="md" />
        </div>
    </GlassPanel>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .answer-button {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(0,217,255,0.3);
            border-radius: 8px;
            padding: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            width: 100%;
        }

        .answer-button:hover {
            background: rgba(0,217,255,0.1);
            border-color: rgba(0,217,255,0.6);
        }

        .answer-button.selected {
            background: rgba(0,217,255,0.2);
            border-color: #00d9ff;
        }

        .answer-button.correct {
            background: rgba(34,197,94,0.2);
            border-color: #22c55e;
        }

        .answer-button.incorrect {
            background: rgba(220,38,38,0.2);
            border-color: #dc2626;
        }
    </style>

    <script>
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let startTime = null;

        function startQuiz() {
            const category = document.getElementById('quizCategory').value;
            const difficulty = document.getElementById('quizDifficulty').value;
            
            showLoading();
            hideAllSections();
            
            // Simulate quiz generation
            setTimeout(() => {
                generateQuiz(category, difficulty);
                hideLoading();
                showGameSection();
                startTime = Date.now();
            }, 1500);
        }

        function generateQuiz(category, difficulty) {
            // Mock quiz data - in real app this would come from AI API
            const questions = [
                {
                    question: "KtĂłra planeta jest najbliĹĽsza SĹ‚oĹ„cu?",
                    answers: ["Merkury", "Wenus", "Ziemia", "Mars"],
                    correct: 0
                },
                {
                    question: "Kto napisaĹ‚ 'Romeo i JuliÄ™'?",
                    answers: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"],
                    correct: 1
                },
                // Add more questions...
            ];

            currentQuiz = {
                questions: questions,
                category: category,
                difficulty: difficulty
            };
            
            currentQuestionIndex = 0;
            userAnswers = [];
            showQuestion();
        }

        function showQuestion() {
            const question = currentQuiz.questions[currentQuestionIndex];
            
            document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = currentQuiz.questions.length;
            document.getElementById('questionText').textContent = question.question;
            
            const progress = ((currentQuestionIndex + 1) / currentQuiz.questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Create answer buttons
            const container = document.getElementById('answersContainer');
            container.innerHTML = '';
            
            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-button';
                button.textContent = `${String.fromCharCode(65 + index)}. ${answer}`;
                button.onclick = () => selectAnswer(index);
                container.appendChild(button);
            });
            
            document.getElementById('nextButton').style.display = 'none';
        }

        function selectAnswer(answerIndex) {
            userAnswers[currentQuestionIndex] = answerIndex;
            
            const buttons = document.querySelectorAll('.answer-button');
            const correctIndex = currentQuiz.questions[currentQuestionIndex].correct;
            
            buttons.forEach((btn, index) => {
                btn.onclick = null; // Disable clicking
                if (index === correctIndex) {
                    btn.classList.add('correct');
                } else if (index === answerIndex && index !== correctIndex) {
                    btn.classList.add('incorrect');
                }
            });
            
            document.getElementById('nextButton').style.display = 'inline-block';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= currentQuiz.questions.length) {
                showResults();
            } else {
                showQuestion();
            }
        }

        function showResults() {
            const correct = userAnswers.filter((answer, index) => 
                answer === currentQuiz.questions[index].correct).length;
            const total = currentQuiz.questions.length;
            const percentage = Math.round((correct / total) * 100);
            const duration = Math.round((Date.now() - startTime) / 1000);
            
            document.getElementById('finalScore').textContent = percentage + '%';
            document.getElementById('correctAnswers').textContent = correct;
            document.getElementById('incorrectAnswers').textContent = total - correct;
            document.getElementById('totalTime').textContent = formatTime(duration);
            
            let message = '';
            if (percentage >= 90) message = 'DoskonaĹ‚y wynik! đźŹ†';
            else if (percentage >= 70) message = 'Ĺšwietny wynik! đźŽ‰';
            else if (percentage >= 50) message = 'Dobry wynik! đź‘Ť';
            else message = 'SprĂłbuj ponownie! đź’Ş';
            
            document.getElementById('scoreMessage').textContent = message;
            
            hideAllSections();
            document.getElementById('quizResults').style.display = 'block';
        }

        function resetQuiz() {
            hideAllSections();
            document.getElementById('quizSettings').style.display = 'block';
            currentQuiz = null;
            currentQuestionIndex = 0;
            userAnswers = [];
        }

        function hideAllSections() {
            document.getElementById('quizSettings').style.display = 'none';
            document.getElementById('quizGame').style.display = 'none';
            document.getElementById('quizResults').style.display = 'none';
        }

        function showGameSection() {
            document.getElementById('quizGame').style.display = 'block';
        }

        function showLoading() {
            document.getElementById('quizLoading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('quizLoading').style.display = 'none';
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
    </script>
</UniversalPageLayout>
