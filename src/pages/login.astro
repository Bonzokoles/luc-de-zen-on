---
import MyBonzoLayout from "../layouts/MyBonzoLayout.astro";
---

<MyBonzoLayout title="Logowanie - MyBonzo AI">
  <main class="min-h-svh">
    <!-- Header Section -->
    <section class="border border-edge">
      <div class="max-w-6xl mx-auto border-x border-edge">
        <div class="flex justify-between max-h-72 min-h-64">
          <div class="mt-auto">
            <span
              style="writing-mode: vertical-lr;"
              class="text-edge block px-2 text-xl font-semibold tracking-[0.3em]"
            >
              LOGIN_SYS
            </span>
          </div>
          <span class="mt-auto">
            <span
              style=""
              class="text-edge block px-2 text-xl font-semibold tracking-[0.3em]"
            >
              AUTH_SYSTEM
            </span>
          </span>
        </div>
      </div>
    </section>

    <!-- Navigation Section -->
    <section class="border border-edge">
      <div class="max-w-6xl mx-auto border-x border-edge">
        <div class="flex flex-row p-2">
          <a class="hover:brightness-125" href="/">
            <h1 class="text-4xl sm:text-5xl">MYBONZO AI</h1>
            <h2 class="text-2xl sm:text-3xl">System ZarzƒÖdzania Agentami</h2>
          </a>

          <div class="hidden ml-auto gap-4 md:gap-0 md:flex md:flex-col">
            <a class="ml-auto hover:brightness-125 duration-200" href="/">
              ‚Üê Powr√≥t do strony g≈Ç√≥wnej
              <svg
                style="--rotation: -45deg"
                class="stroke-primary-foreground inline aspect-square w-3 h-auto fill-transparent rotate-[var(--rotation)]"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3 12L21 12M21 12L12.5 3.5M21 12L12.5 20.5"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content Section -->
    <section
      class="ai-workers-section flex items-center justify-center py-16"
      style="background: rgba(0, 0, 0, 0.5);"
    >
      <div class="section-container max-w-5xl mx-auto">
        <h2 class="section-title">SYSTEM LOGOWANIA</h2>
        <p class="section-description">
          Integracja dostƒôpu do systemu zarzƒÖdzania agentami AI
        </p>

        <!-- Login Container - Powiƒôkszony o 30% -->
        <div
          class="login-container border border-edge rounded-lg overflow-hidden mt-8 transform scale-110"
          style="background: rgba(0, 0, 0, 0.7); max-width: 650px; margin: 2rem auto;"
        >
          <!-- Login Header -->
          <div
            class="login-header border-b border-edge p-6 flex items-center justify-between"
            style="background: rgba(0, 0, 0, 0.8);"
          >
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 bg-blue-400 rounded-full"></div>
              <span class="text-primary-foreground font-semibold">
                Authentication System
              </span>
            </div>
            <div class="flex items-center space-x-2">
              <div class="text-edge text-sm">MyBonzo AI v2.3</div>
            </div>
          </div>

          <!-- Login Form Content -->
          <div class="login-content p-10">
            <div class="max-w-lg mx-auto">
              <form id="loginForm" class="space-y-8">
                <div>
                  <label
                    for="userType"
                    class="block text-lg font-medium text-primary-foreground mb-3"
                  >
                    Typ u≈ºytkownika
                  </label>
                  <select
                    id="userType"
                    class="w-full px-6 py-4 bg-secondary border border-edge rounded-lg text-primary-foreground focus:ring-2 focus:ring-accent focus:border-transparent text-lg"
                  >
                    <option value="admin">Administrator</option>
                    <option value="client">Klient</option>
                    <option value="demo">Demo</option>
                  </select>
                </div>

                <div>
                  <label
                    for="password"
                    class="block text-lg font-medium text-primary-foreground mb-3"
                  >
                    Has≈Ço
                  </label>
                  <input
                    type="password"
                    id="password"
                    placeholder="Wprowad≈∫ has≈Ço"
                    class="w-full px-6 py-4 bg-secondary border border-edge rounded-lg text-primary-foreground placeholder-gray-400 focus:ring-2 focus:ring-accent focus:border-transparent text-lg"
                    required
                  />
                </div>

                <button
                  type="submit"
                  class="w-full py-4 px-6 bg-gradient-to-r from-blue-500 to-cyan-500 text-black font-semibold rounded-lg hover:brightness-110 text-lg"
                >
                  ZALOGUJ SIƒò
                </button>
              </form>

              <!-- Error message -->
              <div
                id="errorMessage"
                class="hidden mt-6 p-4 bg-red-900/50 border border-red-500 rounded-lg text-red-300 text-lg"
              >
              </div>
            </div>
          </div>

          <!-- Quick Access Buttons -->
          <div class="border-t border-edge p-6">
            <div class="grid grid-cols-3 gap-4 max-w-lg mx-auto">
              <button
                class="access-btn"
                data-type="admin"
                data-password="HAOS77"
              >
                <div class="text-purple-400 mb-3 text-center text-2xl">üë§</div>
                <div
                  class="text-lg font-medium text-primary-foreground text-center"
                >
                  Administrator
                </div>
                <div class="text-sm text-edge text-center mt-2">
                  Pe≈Çny dostƒôp do zarzƒÖdzania
                </div>
              </button>

              <button
                class="access-btn"
                data-type="client"
                data-password="CLIENT123"
              >
                <div class="text-cyan-400 mb-3 text-center text-2xl">üéØ</div>
                <div
                  class="text-lg font-medium text-primary-foreground text-center"
                >
                  Klient
                </div>
                <div class="text-sm text-edge text-center mt-2">
                  Dostƒôp do funkcji podstawowych
                </div>
              </button>

              <button
                class="access-btn"
                data-type="demo"
                data-password="DEMO2025"
              >
                <div class="text-green-400 mb-3 text-center text-2xl">üöÄ</div>
                <div
                  class="text-lg font-medium text-primary-foreground text-center"
                >
                  Demo
                </div>
                <div class="text-sm text-edge text-center mt-2">
                  Wersja demonstracyjna systemu
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</MyBonzoLayout>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const loginForm = document.getElementById("loginForm");
    const errorMessage = document.getElementById("errorMessage");
    const accessButtons = document.querySelectorAll(".access-btn");

    // Defined passwords
    const passwords = {
      admin: "HAOS77",
      client: "CLIENT123",
      demo: "DEMO2025",
    };

    // Quick access buttons functionality
    accessButtons.forEach((button) => {
      button.addEventListener("click", function () {
        const userType = this.getAttribute("data-type");
        const password = this.getAttribute("data-password");

        // Update form fields
        document.getElementById("userType").value = userType;
        document.getElementById("password").value = password;

        // Auto login
        performLogin(userType, password);
      });
    });

    loginForm?.addEventListener("submit", function (e) {
      e.preventDefault();

      const userTypeElement = document.getElementById(
        "userType"
      ) as HTMLSelectElement;
      const passwordElement = document.getElementById(
        "password"
      ) as HTMLInputElement;

      const userType = userTypeElement?.value;
      const password = passwordElement?.value;

      performLogin(userType, password);
    });

    function performLogin(userType: string, password: string) {
      console.log("Login attempt:", { userType, password });

      // Clear previous error
      errorMessage?.classList.add("hidden");

      // Validate password
      if (password === passwords[userType as keyof typeof passwords]) {
        console.log("Password valid, setting session...");

        // Set session data
        sessionStorage.setItem(
          "mybonzo_auth",
          JSON.stringify({
            userType: userType,
            loginTime: new Date().toISOString(),
            authenticated: true,
          })
        );

        console.log("Session set, showing success...");

        // Show success and redirect
        showSuccess("Logowanie pomy≈õlne! Przekierowywanie...");

        setTimeout(() => {
          console.log("Redirecting to main page for user type:", userType);
          // Wszystkich u≈ºytkownik√≥w przekieruj na stronƒô g≈Ç√≥wnƒÖ
          window.location.replace("/");
        }, 1500);
      } else {
        console.log("Invalid password");
        showError("Nieprawid≈Çowe has≈Ço dla wybranego typu u≈ºytkownika.");
      }
    }

    function showError(message: string) {
      if (errorMessage) {
        errorMessage.textContent = message;
        errorMessage.classList.remove("hidden");
      }
    }

    function showSuccess(message: string) {
      const successDiv = document.createElement("div");
      successDiv.className =
        "mt-6 p-4 bg-green-900/50 border border-green-500 rounded-lg text-green-300 text-lg";
      successDiv.textContent = message;
      loginForm?.appendChild(successDiv);
    }

    // Check if already logged in
    setTimeout(() => {
      const authData = sessionStorage.getItem("mybonzo_auth");
      if (authData) {
        try {
          const parsed = JSON.parse(authData);
          if (parsed.authenticated) {
            console.log("User already logged in, redirecting to main page...");
            // Already logged in, redirect to main page
            window.location.replace("/");
          }
        } catch (e) {
          console.error("Error parsing auth data:", e);
          sessionStorage.removeItem("mybonzo_auth");
        }
      }
    }, 100);
  });
</script>

<style>
  .animation-delay-200 {
    animation-delay: 200ms;
  }

  .animation-delay-400 {
    animation-delay: 400ms;
  }

  /* Access buttons styling */
  .access-btn {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.75rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
    width: 100%;
    text-align: center;
  }

  .access-btn:hover {
    background: rgba(0, 0, 0, 0.6);
    border-color: rgba(0, 217, 255, 0.5);
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  }

  .access-btn:active {
    transform: translateY(-2px);
  }

  /* Login container scaling */
  .login-container {
    transition: all 0.3s ease;
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #1f2937;
  }

  ::-webkit-scrollbar-thumb {
    background: #4b5563;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
  }
</style>
