---
import Layout from "../../layouts/Layout.astro";
import Section from "../../components/Section.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({ params: { slug: post.id } }));
}

// Resolve post by slug at render time using Astro.params
const allPosts = await getCollection("posts");
const post = allPosts.find((p) => p.id === Astro.params.slug);
if (!post) {
  throw new Error(`Post not found for slug: ${Astro.params.slug}`);
}

const { Content } = await render(post);
---

<Layout
  siteTitle={post.data.title}
  siteDescription={post.data.description}
  headerCosmeticText="POST"
>
  <Section class="prose-lg p-8">
    <Content />
  </Section>
</Layout>
