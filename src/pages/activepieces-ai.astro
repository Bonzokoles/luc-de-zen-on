
---
import BackroomInterface from '@/layouts/BackroomInterface.astro';
import AiHelpAssistant from '@/components/AiHelpAssistant.svelte';
---

<BackroomInterface siteTitle="Activepieces AI | AI Workers">
  <div class="fixed inset-0 bg-[#0f1419]">
    <div class="absolute inset-0 bg-gradient-to-br from-cyan-900/15 via-[#0f1419] to-[#0f1419]"></div>
  </div>

  <section class="backroom-header">
    <div class="backroom-container">
      <h1 class="backroom-title">Activepieces AI</h1>
      <p class="backroom-description">Platforma do automatyzacji i tworzenia workflow</p>
    </div>
  </section>

  <section class="backroom-section">
    <div class="backroom-container">
      <div class="function-container">
        <h2 class="text-2xl font-semibold text-primary mb-5">Activepieces AI Interface</h2>
        <div class="activepieces-ui">
          <div class="mb-6">
            <label for="workflow-select" class="block text-lg font-semibold mb-2 text-primary-foreground">Wybierz Workflow</label>
            <select id="workflow-select" class="w-full p-2 bg-surface border border-edge rounded-lg">
              <option value="activepieces_reminders_workflow">Reminders Workflow</option>
              <option value="activepieces_ticket_assignment_workflow">Ticket Assignment Workflow</option>
            </select>
          </div>
          <div class="mb-6">
            <label for="activepieces-input" class="block text-lg font-semibold mb-2 text-primary-foreground">WprowadÅº dane (JSON)</label>
            <textarea id="activepieces-input" class="w-full h-40 p-2 rounded bg-surface border border-edge" placeholder="Wpisz swoje dane w formacie JSON..."></textarea>
          </div>
          <button id="run-workflow-btn" class="action-btn">Uruchom Workflow</button>
          <div id="activepieces-output" class="mt-6"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- POLACZEK_T Floating Assistant -->
  <div class="fixed bottom-5 right-5 z-50">
    <button id="polaczekBtn" class="action-btn">ðŸ¤– POLACZEK_T</button>
    <div id="polaczekWidget" class="hidden absolute bottom-16 right-0 w-96 bg-surface border border-edge rounded-lg shadow-lg">
      <AiHelpAssistant client:load pageTitle="Activepieces AI | AI Workers" />
    </div>
  </div>

  <script>
    const runWorkflowBtn = document.getElementById('run-workflow-btn');
    const workflowSelect = document.getElementById('workflow-select');
    const activepiecesInput = document.getElementById('activepieces-input');
    const activepiecesOutput = document.getElementById('activepieces-output');

    runWorkflowBtn.addEventListener('click', async () => {
      const workflowId = workflowSelect.value;
      const inputData = activepiecesInput.value;

      if (!inputData) {
        alert('WprowadÅº dane do przetworzenia.');
        return;
      }

      let parsedInput;
      try {
        parsedInput = JSON.parse(inputData);
      } catch (error) {
        alert('NieprawidÅ‚owy format JSON.');
        return;
      }

      activepiecesOutput.innerHTML = '<p>Przetwarzanie...</p>';

      try {
        const response = await fetch('/api/activepieces', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            workflowId: workflowId,
            input: parsedInput,
          }),
        });

        const data = await response.json();

        if (data.success) {
          activepiecesOutput.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        } else {
          activepiecesOutput.innerHTML = `<p class="text-red-500">BÅ‚Ä…d: ${data.error}</p>`;
        }
      } catch (error) {
        activepiecesOutput.innerHTML = `<p class="text-red-500">BÅ‚Ä…d: ${error.message}</p>`;
      }
    });
  </script>
</BackroomInterface>
