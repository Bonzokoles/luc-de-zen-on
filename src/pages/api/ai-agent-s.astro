---
export async function POST({ request, locals }) {
  try {
    const body = await request.json();
    const { prompt, context } = body;

    // Use Cloudflare AI if available in locals.runtime.env
    if (locals?.runtime?.env?.AI) {
      const response = await locals.runtime.env.AI.run(
        "@hf/speakleash/bielik-7b-instruct-v0.1",
        {
          messages: [
            {
              role: "system",
              content: `Jesteś AI_AGENT_S - zaawansowanym polskim systemem AI opartym na modelu Bielik, zaprojektowanym do złożonego rozumowania i rozwiązywania problemów wieloetapowych. 
            
Kluczowe możliwości:
- Głębokie myślenie analityczne
- Dekompozycja problemów wieloetapowych  
- Synteza wiedzy międzydyscyplinarnej
- Zaawansowane rozumowanie i wnioskowanie
- Kreatywne generowanie rozwiązań
- Specjalistyczna wiedza w wielu dziedzinach

Zawsze udzielaj dogłębnych, dobrze uzasadnionych odpowiedzi z jasnym, krok po kroku myśleniem. Odpowiadaj po polsku.`,
            },
            {
              role: "user",
              content: prompt,
            },
          ],
        }
      );

      return new Response(
        JSON.stringify({
          success: true,
          response: response.response,
          agent: "AI_AGENT_S",
          capabilities: [
            "complex_reasoning",
            "multi_step_analysis",
            "cross_domain_synthesis",
            "technical_expertise",
            "creative_problem_solving",
          ],
        }),
        {
          headers: { "Content-Type": "application/json" },
        }
      );
    }

    // Fallback response
    return new Response(
      JSON.stringify({
        success: true,
        response: `AI_AGENT_S analyzing: "${prompt}"\n\nAs an advanced AI system, I would approach this through:\n1. Problem decomposition and analysis\n2. Multi-perspective evaluation\n3. Solution synthesis and optimization\n4. Implementation strategy development\n\n[This is a demo response - full AI capabilities require Cloudflare AI binding]`,
        agent: "AI_AGENT_S",
        status: "demo_mode",
      }),
      {
        headers: { "Content-Type": "application/json" },
      }
    );
  } catch (error) {
    return new Response(
      JSON.stringify({
        success: false,
        error: "Failed to process request",
      }),
      {
        status: 500,
        headers: { "Content-Type": "application/json" },
      }
    );
  }
}

export async function GET() {
  return new Response(
    JSON.stringify({
      agent: "AI_AGENT_S",
      status: "active",
      model: "@hf/speakleash/bielik-7b-instruct-v0.1",
      capabilities: [
        "complex_reasoning",
        "multi_step_analysis",
        "cross_domain_synthesis",
        "technical_expertise",
        "creative_problem_solving",
      ],
      description:
        "Advanced AI system for sophisticated reasoning and complex problem solving",
    }),
    {
      headers: { "Content-Type": "application/json" },
    }
  );
}
---
