---
// Dashboard Workers - Cloudflare Workers Management
import Layout from '@/layouts/Layout.astro';

// Lista dostÄ™pnych workers z folderu dodatki
const availableWorkers = [
  {
    id: 'ai-chatbot',
    name: 'AI Chatbot Worker',
    description: 'Inteligentny chatbot z obsÅ‚ugÄ… OpenAI API',
    status: 'active',
    type: 'ai',
    memory: '128MB',
    requests: '1.2M/month',
    color: '#ff6b9d'
  },
  {
    id: 'image-generator', 
    name: 'Image Generator Worker',
    description: 'Generator obrazÃ³w AI z Flux-1 Schnell',
    status: 'active',
    type: 'ai',
    memory: '256MB',
    requests: '850K/month',
    color: '#9333ea'
  },
  {
    id: 'voice-ai-assistant',
    name: 'Voice AI Assistant Worker',
    description: 'Asystent gÅ‚osowy z obsÅ‚ugÄ… polskiego jÄ™zyka',
    status: 'development',
    type: 'voice',
    memory: '192MB',
    requests: '320K/month',
    color: '#ef4444'
  },
  {
    id: 'flowise',
    name: 'Flowise AI Flow Worker',
    description: 'Visual AI Flow Builder i orchestration',
    status: 'development',
    type: 'workflow',
    memory: '512MB',
    requests: '180K/month',
    color: '#ffc107'
  },
  {
    id: 'langflow',
    name: 'Langflow Visual Builder',
    description: 'Langflow Visual AI Builder z templates',
    status: 'active',
    type: 'workflow',
    memory: '384MB',
    requests: '290K/month',
    color: '#00ff88'
  },
  {
    id: 'bigquery-analytics',
    name: 'BigQuery Analytics Worker',
    description: 'Analytics i BigQuery data processing',
    status: 'development',
    type: 'data',
    memory: '256MB',
    requests: '450K/month',
    color: '#1be1ff'
  },
  {
    id: 'kaggle-datasets',
    name: 'Kaggle Datasets Worker',
    description: 'Integracja z Kaggle API i dataset management',
    status: 'development',
    type: 'data',
    memory: '128MB',
    requests: '150K/month',
    color: '#ff9500'
  },
  {
    id: 'tavily-ai-search',
    name: 'Tavily AI Search Worker',
    description: 'AI-powered search z Tavily API',
    status: 'development',
    type: 'search',
    memory: '128MB',
    requests: '220K/month',
    color: '#ff5722'
  },
  {
    id: 'mcp-servers',
    name: 'MCP Servers Manager',
    description: 'Model Context Protocol servers management',
    status: 'active',
    type: 'infrastructure',
    memory: '192MB',
    requests: '680K/month',
    color: '#9c27b0'
  },
  {
    id: 'business-intel',
    name: 'Business Intelligence Worker',
    description: 'Business intelligence i reporting',
    status: 'development',
    type: 'business',
    memory: '256MB',
    requests: '340K/month',
    color: '#607d8b'
  },
  {
    id: 'webmaster',
    name: 'Webmaster Automation Worker',
    description: 'Automatyzacja zadaÅ„ webmaster i SEO',
    status: 'development',
    type: 'automation',
    memory: '128MB',
    requests: '190K/month',
    color: '#4caf50'
  },
  {
    id: 'nodered',
    name: 'Node-RED Flow Worker',
    description: 'Node-RED automation flows',
    status: 'development',
    type: 'automation',
    memory: '384MB',
    requests: '110K/month',
    color: '#795548'
  }
];

// Grupowanie wedÅ‚ug typu
const workersByType = availableWorkers.reduce((acc, worker) => {
  if (!acc[worker.type]) acc[worker.type] = [];
  acc[worker.type].push(worker);
  return acc;
}, {});

const typeColors = {
  ai: '#ff6b9d',
  voice: '#ef4444', 
  workflow: '#ffc107',
  data: '#1be1ff',
  search: '#ff5722',
  infrastructure: '#9c27b0',
  business: '#607d8b',
  automation: '#4caf50'
};
---

<Layout title="Workers MyBonzo - Cloudflare Workers Management">
  <main class="min-h-svh relative z-10">
    <!-- Background -->
    <div class="fixed inset-0 bg-[#0a0f14]">
      <div class="absolute inset-0 bg-gradient-to-br from-cyan-900/20 via-[#0a0f14] to-[#0a0f14]"></div>
    </div>

    <!-- Header -->
    <section class="relative z-20 border-b border-[#263238] pt-20">
      <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex items-center justify-between mb-8">
          <div>
            <h1 class="text-4xl md:text-5xl font-bold text-[#1be1ff] mb-2 uppercase tracking-wider font-['Rajdhani']">
              âš¡ CLOUDFLARE WORKERS
            </h1>
            <p class="text-[#e1f5fe] text-lg">
              ZarzÄ…dzanie workerami i mikrousÅ‚ugami
            </p>
          </div>
          <div class="text-right text-sm text-[#b0bec5] font-mono">
            <div class="mb-1">
              AKTYWNE: <span class="text-[#00ff88]">{availableWorkers.filter(w => w.status === 'active').length}</span>
            </div>
            <div>
              ÅÄ„CZNE: <span class="text-[#00e5ff]">{availableWorkers.length}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Stats Overview -->
    <section class="relative z-20 py-8 border-b border-[#263238]">
      <div class="max-w-6xl mx-auto px-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-[#0f3846]/40 border border-[#1be1ff]/10 rounded-lg p-4 text-center">
            <div class="text-2xl font-bold text-[#00ff88]">{availableWorkers.filter(w => w.status === 'active').length}</div>
            <div class="text-sm text-[#b0bec5]">Aktywne Workers</div>
          </div>
          <div class="bg-[#0f3846]/40 border border-[#1be1ff]/10 rounded-lg p-4 text-center">
            <div class="text-2xl font-bold text-[#ffc107]">{availableWorkers.filter(w => w.status === 'development').length}</div>
            <div class="text-sm text-[#b0bec5]">W Rozwoju</div>
          </div>
          <div class="bg-[#0f3846]/40 border border-[#1be1ff]/10 rounded-lg p-4 text-center">
            <div class="text-2xl font-bold text-[#ff6b9d]">
              {Math.round(availableWorkers.reduce((sum, w) => sum + parseFloat(w.requests.replace(/[KM]/g, match => match === 'K' ? '000' : '000000').replace('/month', '')), 0) / 1000000 * 10) / 10}M
            </div>
            <div class="text-sm text-[#b0bec5]">Requests/miesiÄ…c</div>
          </div>
          <div class="bg-[#0f3846]/40 border border-[#1be1ff]/10 rounded-lg p-4 text-center">
            <div class="text-2xl font-bold text-[#1be1ff]">
              {availableWorkers.reduce((sum, w) => sum + parseInt(w.memory.replace('MB', '')), 0)}MB
            </div>
            <div class="text-sm text-[#b0bec5]">ÅÄ…czna PamiÄ™Ä‡</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Workers by Type -->
    <section class="relative z-20 py-12">
      <div class="max-w-6xl mx-auto px-4">
        {Object.entries(workersByType).map(([type, workers]) => (
          <div class="mb-12">
            <!-- Type Header -->
            <div class="flex items-center mb-6">
              <div class={`w-8 h-8 rounded-lg flex items-center justify-center mr-4`} 
                   style={`background: ${typeColors[type]}20; border: 1px solid ${typeColors[type]}50;`}>
                {type === 'ai' ? 'ğŸ¤–' : 
                 type === 'voice' ? 'ğŸ¤' :
                 type === 'workflow' ? 'ğŸ”„' :
                 type === 'data' ? 'ğŸ“Š' :
                 type === 'search' ? 'ğŸ”' :
                 type === 'infrastructure' ? 'ğŸ—ï¸' :
                 type === 'business' ? 'ğŸ’¼' : 'âš™ï¸'}
              </div>
              <h2 class="text-2xl font-bold font-['Rajdhani'] uppercase tracking-wider"
                  style={`color: ${typeColors[type]};`}>
                {type} Workers ({workers.length})
              </h2>
            </div>

            <!-- Workers Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {workers.map(worker => (
                <div class="bg-[#0f3846]/60 border border-[#1be1ff]/20 rounded-lg p-6 hover:bg-[#0f3846]/80 transition-all duration-300">
                  <!-- Worker Header -->
                  <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                      <div class={`w-10 h-10 rounded-lg flex items-center justify-center mr-3`} 
                           style={`background: ${worker.color}20; border: 1px solid ${worker.color}50;`}>
                        âš¡
                      </div>
                      <div>
                        <h3 class="text-lg font-bold font-['Rajdhani']" style={`color: ${worker.color};`}>
                          {worker.name.toUpperCase()}
                        </h3>
                      </div>
                    </div>
                    <div class={`px-2 py-1 rounded text-xs font-mono ${
                      worker.status === 'active' 
                        ? 'bg-[#00ff88]/20 text-[#00ff88] border border-[#00ff88]/30'
                        : 'bg-[#ffc107]/20 text-[#ffc107] border border-[#ffc107]/30'
                    }`}>
                      {worker.status.toUpperCase()}
                    </div>
                  </div>

                  <!-- Description -->
                  <p class="text-[#e1f5fe] mb-4 text-sm leading-relaxed">
                    {worker.description}
                  </p>

                  <!-- Stats -->
                  <div class="mb-4 grid grid-cols-2 gap-2 text-xs">
                    <div class="bg-[#0a0f14]/60 border border-[#263238] rounded p-2">
                      <div class="text-[#b0bec5]">Memory</div>
                      <div class="text-[#00ff88] font-mono">{worker.memory}</div>
                    </div>
                    <div class="bg-[#0a0f14]/60 border border-[#263238] rounded p-2">
                      <div class="text-[#b0bec5]">Requests</div>
                      <div class="text-[#ff6b9d] font-mono">{worker.requests}</div>
                    </div>
                  </div>

                  <!-- Actions -->
                  <div class="flex gap-2">
                    <button 
                      onclick={`window.location.href='/dodatki/workers/${worker.id}'`}
                      class="flex-1 bg-gradient-to-r from-[#1be1ff]/20 to-[#00e5ff]/20 border border-[#1be1ff]/30 text-[#1be1ff] px-3 py-2 rounded text-sm font-medium hover:bg-[#1be1ff]/10 transition-all duration-300"
                    >
                      ZarzÄ…dzaj
                    </button>
                    <button 
                      onclick={`console.log('Logi worker: ${worker.id}')`}
                      class="px-3 py-2 bg-[#0f3846]/60 border border-[#263238] text-[#b0bec5] rounded text-sm hover:text-[#e1f5fe] hover:border-[#1be1ff]/20 transition-all duration-300"
                    >
                      ğŸ“Š
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- Navigation -->
    <section class="relative z-20 py-8 border-t border-[#263238]">
      <div class="max-w-6xl mx-auto px-4">
        <div class="flex justify-between items-center">
          <a href="/dodatki/" class="inline-flex items-center text-[#1be1ff] hover:text-[#00e5ff] font-medium">
            â† PowrÃ³t do DodatkÃ³w
          </a>
          <div class="text-sm text-[#b0bec5] font-mono">
            ÅÄ…cznie workers: {availableWorkers.length}
          </div>
        </div>
      </div>
    </section>

  </main>
</Layout>