---
import MyBonzoLayout from "../../layouts/MyBonzoLayout.astro";

export const prerender = true;

export async function getStaticPaths() {
  return [
    { params: { agentId: "mybonzo" } },
    { params: { agentId: "polaczek" } },
    { params: { agentId: "bielik" } },
    { params: { agentId: "assistant" } },
  ];
}

const { agentId } = Astro.params;

// Konfiguracja agent√≥w
const agentConfig = {
  mybonzo: {
    name: "MyBonzo AI",
    description: "G≈Ç√≥wny agent cyberpunkowy z pe≈ÇnƒÖ funkcjonalno≈õciƒÖ",
    color: "from-cyan-500 to-purple-600",
    capabilities: ["chat", "images", "tasks", "analysis"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  polaczek: {
    name: "Polaczek Agent",
    description: "Lokalny agent wspierajƒÖcy polskie zadania",
    color: "from-red-500 to-white",
    capabilities: ["chat", "translation", "local-tasks"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  bielik: {
    name: "Bielik AI",
    description: "Polski model jƒôzykowy dla zada≈Ñ w jƒôzyku polskim",
    color: "from-blue-500 to-green-600",
    capabilities: ["chat", "polish-tasks", "analysis"],
    model: "@cf/huggingface/bielik-7b-instruct-v0.1",
  },
  assistant: {
    name: "Universal Assistant",
    description: "Uniwersalny asystent do og√≥lnych zada≈Ñ",
    color: "from-gray-500 to-blue-500",
    capabilities: ["chat", "help", "general-tasks"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  // Google ADK Agents
  "gemini-pro": {
    name: "Gemini Pro",
    description: "Zaawansowany model Gemini Pro od Google",
    color: "from-blue-500 to-indigo-600",
    capabilities: ["advanced-chat", "reasoning", "analysis", "coding"],
    model: "gemini-pro",
  },
  "gemini-vision": {
    name: "Gemini Vision",
    description: "Model wizyjny Gemini do analizy obraz√≥w",
    color: "from-purple-500 to-violet-600",
    capabilities: ["image-analysis", "vision", "recognition", "description"],
    model: "gemini-pro-vision",
  },
  "code-bison": {
    name: "Code Bison",
    description: "Specjalizowany model do generowania i analizy kodu",
    color: "from-green-500 to-emerald-600",
    capabilities: ["code-generation", "code-analysis", "debugging", "optimization"],
    model: "code-bison",
  },
  "text-bison": {
    name: "Text Bison",
    description: "Model do przetwarzania i generowania tekstu",
    color: "from-orange-500 to-red-600",
    capabilities: ["text-generation", "summarization", "translation", "editing"],
    model: "text-bison",
  },
  "google-bard": {
    name: "Google Bard",
    description: "Konwersacyjny AI assistant od Google",
    color: "from-cyan-500 to-blue-600",
    capabilities: ["conversation", "research", "creative-writing", "assistance"],
    model: "bard",
  },
  "palm-api": {
    name: "PaLM API",
    description: "Google PaLM API dla zaawansowanych zada≈Ñ jƒôzykowych",
    color: "from-yellow-500 to-orange-600",
    capabilities: ["language-understanding", "generation", "reasoning", "analysis"],
    model: "palm-api",
  },
  "vertex-ai": {
    name: "Vertex AI",
    description: "Platforma Google Vertex AI dla ML i AI",
    color: "from-teal-500 to-cyan-600",
    capabilities: ["ml-training", "ai-deployment", "model-serving", "analytics"],
    model: "vertex-ai",
  },
  "ai-studio": {
    name: "AI Studio",
    description: "Google AI Studio do tworzenia aplikacji AI",
    color: "from-rose-500 to-pink-600",
    capabilities: ["app-development", "ai-prototyping", "model-tuning", "deployment"],
    model: "ai-studio",
  },
  "voice-command": {
    name: "Voice Command",
    description: "System rozpoznawania i przetwarzania polece≈Ñ g≈Çosowych",
    color: "from-indigo-500 to-purple-600",
    capabilities: ["speech-recognition", "voice-commands", "audio-processing", "tts"],
    model: "voice-recognition",
  },
  "music-control": {
    name: "Music Control",
    description: "System kontroli i zarzƒÖdzania muzykƒÖ",
    color: "from-violet-500 to-fuchsia-600",
    capabilities: ["music-control", "playlist-management", "audio-effects", "streaming"],
    model: "audio-processing",
  },
  // Module Agents
  "agent-10-analytics-prophet": {
    name: "Analytics Prophet",
    description: "Zaawansowany system analityki predykcyjnej z ML forecasting",
    color: "from-amber-600 to-orange-500",
    capabilities: ["forecasting", "roi-analysis", "cohort-analysis", "reporting"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  "agent-09-webmaster": {
    name: "Webmaster",
    description: "System SEO i monitoringu stron internetowych",
    color: "from-blue-700 to-indigo-600",
    capabilities: ["seo-audit", "keyword-analysis", "performance-monitoring", "competitor-analysis"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  "agent-08-security-guard": {
    name: "Security Guard",
    description: "System monitorowania i ochrony bezpiecze≈Ñstwa",
    color: "from-red-600 to-rose-500",
    capabilities: ["threat-detection", "security-monitoring", "incident-response", "security-reporting"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  "agent-07-content-creator": {
    name: "Content Creator",
    description: "System tworzenia i zarzƒÖdzania tre≈õciƒÖ",
    color: "from-purple-600 to-violet-500",
    capabilities: ["content-creation", "template-management", "publishing", "performance-analysis"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  "agent-06-web-crawler": {
    name: "Web Crawler",
    description: "System pobierania i analizy danych z internetu",
    color: "from-emerald-600 to-teal-500",
    capabilities: ["web-scraping", "data-extraction", "content-indexing", "reporting"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  "agent-05-email-manager": {
    name: "Email Manager",
    description: "System zarzƒÖdzania i automatyzacji email",
    color: "from-sky-600 to-cyan-500",
    capabilities: ["email-management", "automation", "campaigns", "analytics"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  "agent-04-file-manager": {
    name: "File Manager",
    description: "System zarzƒÖdzania plikami i dokumentami",
    color: "from-yellow-600 to-amber-500",
    capabilities: ["file-management", "document-search", "organization", "disk-analysis"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  "agent-03-database-manager": {
    name: "Database Manager",
    description: "System zarzƒÖdzania bazami danych",
    color: "from-pink-600 to-rose-500",
    capabilities: ["database-management", "query-optimization", "performance-monitoring", "backup-restore"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
  "agent-01-system-monitor": {
    name: "System Monitor",
    description: "System monitorowania wydajno≈õci systemu",
    color: "from-gray-600 to-slate-500",
    capabilities: ["performance-monitoring", "resource-usage", "diagnostics", "status-reporting"],
    model: "@cf/meta/llama-3.1-8b-instruct",
  },
};

const agent =
  agentConfig[agentId as keyof typeof agentConfig] || agentConfig.mybonzo;
---

<MyBonzoLayout title={`${agent.name} | AI Agents`}>
  <main class="min-h-svh bg-black text-white">
    <!-- Agent Header -->
    >>>>>>> Stashed changes
    <section class="border-b border-cyan-500/30">
      <div class="max-w-6xl mx-auto p-6">
        <div class="flex items-center justify-between">
          <div>
            <h1
              class={`text-4xl font-bold bg-gradient-to-r ${agent.color} bg-clip-text text-transparent`}
            >
              {agent.name}
            </h1>
            <p class="text-gray-300 mt-2">{agent.description}</p>
          </div>
          <div class="text-right">
            <div class="text-sm text-cyan-400">Agent ID</div>
            <div class="font-mono text-lg">{agentId}</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Capabilities Grid -->
    <section class="max-w-6xl mx-auto p-6">
      <h2 class="text-2xl font-semibold mb-6 text-cyan-400">Mo≈ºliwo≈õci</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        {
          agent.capabilities.map((cap: string) => (
            <div class="border border-cyan-500/30 rounded-lg p-4 bg-gray-900/50">
              <div class="text-center">
                <div class="text-cyan-400 mb-2">
                  {cap === "chat" && "üí¨"}
                  {cap === "images" && "üñºÔ∏è"}
                  {cap === "tasks" && "‚ö°"}
                  {cap === "analysis" && "üîç"}
                  {cap === "translation" && "üîÑ"}
                  {cap === "local-tasks" && "üè†"}
                  {cap === "polish-tasks" && "üáµüá±"}
                  {cap === "help" && "‚ùì"}
                  {cap === "general-tasks" && "üìã"}
                </div>
                <div class="text-sm capitalize">{cap.replace("-", " ")}</div>
              </div>
            </div>
          ))
        }
      </div>
    </section>

    <!-- Chat Interface -->
    const agent = agentConfig[agentId as keyof typeof agentConfig] || agentConfig.mybonzo;
    ---

    <MyBonzoLayout title={`${agent.name} | AI Agents`}>
      <main class="min-h-svh bg-black text-white">
        <!-- Agent Header -->
        <section class="border-b border-cyan-500/30">
          <div class="max-w-6xl mx-auto p-6">
            <div class="flex items-center justify-between">
              <div>
                <h1
                  class={`text-4xl font-bold bg-gradient-to-r ${agent.color} bg-clip-text text-transparent`}
                >
                  {agent.name}
                </h1>
                <p class="text-gray-300 mt-2">{agent.description}</p>
              </div>
              <div class="text-right">
                <div class="text-sm text-cyan-400">Agent ID</div>
                <div class="font-mono text-lg">{agentId}</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Capabilities Grid -->
        <section class="max-w-6xl mx-auto p-6">
          <h2 class="text-2xl font-semibold mb-6 text-cyan-400">Mo≈ºliwo≈õci</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            {
              agent.capabilities.map((cap: string) => (
                <div class="border border-cyan-500/30 rounded-lg p-4 bg-gray-900/50">
                  <div class="text-center">
                    <div class="text-cyan-400 mb-2">
                      {cap === "chat" && "üí¨"}
                      {cap === "images" && "üñºÔ∏è"}
                      {cap === "tasks" && "‚ö°"}
                      {cap === "analysis" && "üîç"}
                      {cap === "translation" && "üîÑ"}
                      {cap === "local-tasks" && "üè†"}
                      {cap === "polish-tasks" && "üáµüá±"}
                      {cap === "help" && "‚ùì"}
                      {cap === "general-tasks" && "üìã"}
                    </div>
                    <div class="text-sm capitalize">
                      {cap.replace("-", " ")}
                    </div>
                  </div>
                </div>
              ))
            }
          </div>
        </section>

        <!-- Chat Interface -->
        >>>>>>> Stashed changes
        <section class="max-w-6xl mx-auto p-6">
          <div class="border border-cyan-500/30 rounded-lg bg-gray-900/30">
            <div class="border-b border-cyan-500/30 p-4">
              <h3 class="text-xl font-semibold text-cyan-400">
                Chat Interface
              </h3>
            </div>
            <div class="p-6">
              <div
                id="chat-container"
                class="space-y-4 mb-6 h-96 overflow-y-auto"
              >
                <div class="text-gray-400 text-center py-8">
                  Rozpocznij rozmowƒô z {agent.name}...
                </div>
              </div>

              <div class="flex gap-2">
                <input
                  type="text"
                  id="message-input"
                  placeholder="Wpisz wiadomo≈õƒá..."
                  class="flex-1 bg-gray-800 border border-cyan-500/30 rounded px-4 py-2 text-white focus:border-cyan-400 focus:outline-none"
                />
                <button
                  id="send-button"
                  class="bg-gradient-to-r from-cyan-500 to-purple-600 text-white px-6 py-2 rounded hover:opacity-80 transition-opacity"
                >
                  Wy≈õlij
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Quick Actions -->
        <section class="max-w-6xl mx-auto p-6">
          <h3 class="text-xl font-semibold mb-4 text-cyan-400">
            Szybkie Akcje
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <button
              class="border border-cyan-500/30 rounded-lg p-4 hover:bg-cyan-500/10 transition-colors text-left"
              onclick="quickAction('status')"
            >
              <div class="text-lg font-semibold">üìä Status</div>
              <div class="text-sm text-gray-400">Sprawd≈∫ status agenta</div>
            </button>

            {
              agent.capabilities.includes("images") && (
                <button
                  class="border border-cyan-500/30 rounded-lg p-4 hover:bg-cyan-500/10 transition-colors text-left"
                  onclick="quickAction('image')"
                >
                  <div class="text-lg font-semibold">üñºÔ∏è Generuj Obraz</div>
                  <div class="text-sm text-gray-400">Stw√≥rz obraz AI</div>
                </button>
              )
            }

            {
              agent.capabilities.includes("tasks") && (
                <button
                  class="border border-cyan-500/30 rounded-lg p-4 hover:bg-cyan-500/10 transition-colors text-left"
                  onclick="quickAction('task')"
                >
                  <div class="text-lg font-semibold">‚ö° Wykonaj Zadanie</div>
                  <div class="text-sm text-gray-400">Zlec zadanie agentowi</div>
                </button>
              )
            }
          </div>
        </section>
      </main>

      <script define:vars={{ agentId, agent }}>
        const chatContainer = document.getElementById("chat-container");
        const messageInput = document.getElementById(
          "message-input"
        ) as HTMLInputElement;
        const sendButton = document.getElementById("send-button");

        // Funkcja wysy≈Çania wiadomo≈õci
        async function sendMessage() {
          const message = messageInput.value.trim();
          if (!message) return;

          // Dodaj wiadomo≈õƒá u≈ºytkownika
          addMessage(message, "user");
          messageInput.value = "";

          try {
            // Wywo≈Çaj API agenta
            const response = await fetch(`/api/agents/${agentId}/chat`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ message, agentId }),
            });

            const data = await response.json();

            if (data.success) {
              addMessage(data.response, "agent");
            } else {
              addMessage("B≈ÇƒÖd: " + data.error, "error");
            }
          } catch (error: any) {
            addMessage("B≈ÇƒÖd po≈ÇƒÖczenia: " + error.message, "error");
          }
        }

        // Funkcja dodawania wiadomo≈õci do chatu
        function addMessage(text: string, type: "user" | "agent" | "error") {
          const messageDiv = document.createElement("div");
          messageDiv.className = `p-3 rounded-lg ${
            type === "user"
              ? "bg-cyan-500/20 ml-8"
              : type === "agent"
                ? "bg-purple-500/20 mr-8"
                : "bg-red-500/20 text-red-300"
          }`;

          messageDiv.innerHTML = `
        <div class="text-sm text-gray-400 mb-1">
          ${type === "user" ? "Ty" : type === "agent" ? agent.name : "System"}
        </div>
        <div>${text}</div>
      `;

          if (chatContainer) {
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
          }
        }

        // Funkcje szybkich akcji
        (window as any).quickAction = async function (
          action: "status" | "image" | "task"
        ) {
          switch (action) {
            case "status":
              try {
                const response = await fetch(`/api/agents/${agentId}/status`);
                const data = await response.json();
                addMessage(`Status: ${JSON.stringify(data, null, 2)}`, "agent");
              } catch (error) {
                addMessage("B≈ÇƒÖd pobierania statusu", "error");
              }
              break;

            case "image":
              const prompt = window.prompt("Opisz obraz do wygenerowania:");
              if (prompt) {
                try {
                  const response = await fetch(`/api/agents/${agentId}/image`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ prompt, agentId }),
                  });
                  const data = await response.json();
                  if (data.success) {
                    addMessage(
                      `Obraz wygenerowany: <img src="${data.imageUrl}" class="mt-2 max-w-xs rounded">`,
                      "agent"
                    );
                  }
                } catch (error) {
                  addMessage("B≈ÇƒÖd generowania obrazu", "error");
                }
              }
              break;

            case "task":
              const taskDesc = window.prompt("Opisz zadanie do wykonania:");
              if (taskDesc) {
                try {
                  const response = await fetch(`/api/agents/${agentId}/task`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ task: taskDesc, agentId }),
                  });
                  const data = await response.json();
                  if (data.success) {
                    addMessage(`Zadanie wykonane: ${data.result}`, "agent");
                  }
                } catch (error) {
                  addMessage("B≈ÇƒÖd wykonywania zadania", "error");
                }
              }
              break;
          }
        };

        // Event listeners
        if (sendButton) sendButton.addEventListener("click", sendMessage);
        if (messageInput)
          messageInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendMessage();
          });

        // Wiadomo≈õƒá powitalna
        setTimeout(() => {
          addMessage(
            `Cze≈õƒá! Jestem ${agent.name}. Jak mogƒô Ci pom√≥c?`,
            "agent"
          );
        }, 500);
      </script>
      <section class="border-b border-cyan-500/30">
        <div class="max-w-6xl mx-auto p-6">
          <div class="flex items-center justify-between">
            <div>
              <h1
                class={`text-4xl font-bold bg-gradient-to-r ${agent.color} bg-clip-text text-transparent`}
              >
                {agent.name}
              </h1>
              <p class="text-gray-300 mt-2">{agent.description}</p>
            </div>
            <div class="text-right">
              <div class="text-sm text-cyan-400">Agent ID</div>
              <div class="font-mono text-lg">{agentId}</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Capabilities Grid -->
      <section class="max-w-6xl mx-auto p-6">
        <h2 class="text-2xl font-semibold mb-6 text-cyan-400">Mo≈ºliwo≈õci</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          {
            agent.capabilities.map((cap) => (
              <div class="border border-cyan-500/30 rounded-lg p-4 bg-gray-900/50">
                <div class="text-center">
                  <div class="text-cyan-400 mb-2">
                    {cap === "chat" && "üí¨"}
                    {cap === "images" && "üñºÔ∏è"}
                    {cap === "tasks" && "‚ö°"}
                    {cap === "analysis" && "üîç"}
                    {cap === "translation" && "üîÑ"}
                    {cap === "local-tasks" && "üè†"}
                    {cap === "polish-tasks" && "üáµüá±"}
                    {cap === "help" && "‚ùì"}
                    {cap === "general-tasks" && "üìã"}
                  </div>
                  <div class="text-sm capitalize">{cap.replace("-", " ")}</div>
                </div>
              </div>
            ))
          }
        </div>
      </section>

      <!-- Chat Interface -->
      <section class="max-w-6xl mx-auto p-6">
        <div class="border border-cyan-500/30 rounded-lg bg-gray-900/30">
          <div class="border-b border-cyan-500/30 p-4">
            <h3 class="text-xl font-semibold text-cyan-400">Chat Interface</h3>
          </div>
          <div class="p-6">
            <div
              id="chat-container"
              class="space-y-4 mb-6 h-96 overflow-y-auto"
            >
              <div class="text-gray-400 text-center py-8">
                Rozpocznij rozmowƒô z {agent.name}...
              </div>
            </div>

            <div class="flex gap-2">
              <input
                type="text"
                id="message-input"
                placeholder="Wpisz wiadomo≈õƒá..."
                class="flex-1 bg-gray-800 border border-cyan-500/30 rounded px-4 py-2 text-white focus:border-cyan-400 focus:outline-none"
              />
              <button
                id="send-button"
                class="bg-gradient-to-r from-cyan-500 to-purple-600 text-white px-6 py-2 rounded hover:opacity-80 transition-opacity"
              >
                Wy≈õlij
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Quick Actions -->
      <section class="max-w-6xl mx-auto p-6">
        <h3 class="text-xl font-semibold mb-4 text-cyan-400">Szybkie Akcje</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <button
            class="border border-cyan-500/30 rounded-lg p-4 hover:bg-cyan-500/10 transition-colors text-left"
            onclick="quickAction('status')"
          >
            <div class="text-lg font-semibold">üìä Status</div>
            <div class="text-sm text-gray-400">Sprawd≈∫ status agenta</div>
          </button>

          {
            agent.capabilities.includes("images") && (
              <button
                class="border border-cyan-500/30 rounded-lg p-4 hover:bg-cyan-500/10 transition-colors text-left"
                onclick="quickAction('image')"
              >
                <div class="text-lg font-semibold">üñºÔ∏è Generuj Obraz</div>
                <div class="text-sm text-gray-400">Stw√≥rz obraz AI</div>
              </button>
            )
          }

          {
            agent.capabilities.includes("tasks") && (
              <button
                class="border border-cyan-500/30 rounded-lg p-4 hover:bg-cyan-500/10 transition-colors text-left"
                onclick="quickAction('task')"
              >
                <div class="text-lg font-semibold">‚ö° Wykonaj Zadanie</div>
                <div class="text-sm text-gray-400">Zlec zadanie agentowi</div>
              </button>
            )
          }
        </div>
      </section>
    </MyBonzoLayout>

    <script define:vars={{ agentId, agent }}>
      const chatContainer = document.getElementById("chat-container");
      const messageInput = document.getElementById("message-input");
      const sendButton = document.getElementById("send-button");

      // Funkcja wysy≈Çania wiadomo≈õci
      async function sendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;

        // Dodaj wiadomo≈õƒá u≈ºytkownika
        addMessage(message, "user");
        messageInput.value = "";

        try {
          // Wywo≈Çaj API agenta
          const response = await fetch(`/api/agents/${agentId}/chat`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message, agentId }),
          });

          const data = await response.json();

          if (data.success) {
            addMessage(data.response, "agent");
          } else {
            addMessage("B≈ÇƒÖd: " + data.error, "error");
          }
        } catch (error) {
          addMessage("B≈ÇƒÖd po≈ÇƒÖczenia: " + error.message, "error");
        }
      }

      // Funkcja dodawania wiadomo≈õci do chatu
      function addMessage(text, type) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `p-3 rounded-lg ${
          type === "user"
            ? "bg-cyan-500/20 ml-8"
            : type === "agent"
              ? "bg-purple-500/20 mr-8"
              : "bg-red-500/20 text-red-300"
        }`;

        messageDiv.innerHTML = `
        <div class="text-sm text-gray-400 mb-1">
          ${type === "user" ? "Ty" : type === "agent" ? agent.name : "System"}
        </div>
        <div>${text}</div>
      `;

        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      // Funkcje szybkich akcji
      window.quickAction = async function (action) {
        switch (action) {
          case "status":
            try {
              const response = await fetch(`/api/agents/${agentId}/status`);
              const data = await response.json();
              addMessage(`Status: ${JSON.stringify(data, null, 2)}`, "agent");
            } catch (error) {
              addMessage("B≈ÇƒÖd pobierania statusu", "error");
            }
            break;

          case "image":
            const prompt = prompt("Opisz obraz do wygenerowania:");
            if (prompt) {
              try {
                const response = await fetch(`/api/agents/${agentId}/image`, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ prompt, agentId }),
                });
                const data = await response.json();
                if (data.success) {
                  addMessage(
                    `Obraz wygenerowany: <img src="${data.imageUrl}" class="mt-2 max-w-xs rounded">`,
                    "agent"
                  );
                }
              } catch (error) {
                addMessage("B≈ÇƒÖd generowania obrazu", "error");
              }
            }
            break;

          case "task":
            const taskDesc = prompt("Opisz zadanie do wykonania:");
            if (taskDesc) {
              try {
                const response = await fetch(`/api/agents/${agentId}/task`, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ task: taskDesc, agentId }),
                });
                const data = await response.json();
                if (data.success) {
                  addMessage(`Zadanie wykonane: ${data.result}`, "agent");
                }
              } catch (error) {
                addMessage("B≈ÇƒÖd wykonywania zadania", "error");
              }
            }
            break;
        }
      };

      // Event listeners
      sendButton.addEventListener("click", sendMessage);
      messageInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
      });

      // Wiadomo≈õƒá powitalna
      setTimeout(() => {
        addMessage(`Cze≈õƒá! Jestem ${agent.name}. Jak mogƒô Ci pom√≥c?`, "agent");
      }, 500);
    </script>
  </main>
</MyBonzoLayout>
