---
import MyBonzoLayout from "../layouts/MyBonzoLayout.astro";
import AiHelpAssistant from "../components/AiHelpAssistant.svelte";
---

<MyBonzoLayout title="AI Workers Platform | KAROL LISSON">
  <main class="min-h-svh">
    <!-- Header Section -->
    <section class="border border-edge">
      <div class="max-w-6xl mx-auto border-x border-edge">
        <div class="flex justify-between max-h-72 min-h-64">
          <div class="mt-auto">
            <span
              style="writing-mode: vertical-lr;"
              class="text-edge block px-2 text-xl font-semibold tracking-[0.3em]"
            >
            </span>
          </div>
          <span class="mt-auto">
            <span
              style=""
              class="text-edge block px-2 text-xl font-semibold tracking-[0.3em]"
            >
              AUG 2025
            </span>
          </span>
        </div>
      </div>
    </section>

    <!-- Navigation Section -->
    <section class="border border-edge">
      <div class="max-w-6xl mx-auto border-x border-edge">
        <div class="flex flex-row p-2">
          <a class="hover:brightness-125" href="/">
            <h1 class="text-4xl sm:text-5xl">KAROL LISSON</h1>
            <h2 class="text-2xl sm:text-3xl">Za≈º√≥≈Çƒá gƒô≈õlƒÖ ja≈∫≈Ñ</h2>
          </a>

          <div class="hidden ml-auto gap-4 md:gap-0 md:flex md:flex-col">
            <a
              class="ml-auto hover:brightness-125 duration-200"
              href="mailto:LissonKarol.msa@gmail.com"
            >
              LissonKarol.msa@gmail.com
              <svg
                style="--rotation: -45deg"
                class="stroke-primary-foreground inline aspect-square w-3 h-auto fill-transparent rotate-[var(--rotation)]"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3 12L21 12M21 12L12.5 3.5M21 12L12.5 20.5"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path>
              </svg>
            </a>
            <div class="flex flex-row-reverse flex-wrap gap-4">
              <a
                class="hover:brightness-125 duration-200"
                href="https://www.linkedin.com/in/linkedinHandle"
              >
                LinkedIn
                <svg
                  style="--rotation: -45deg"
                  class="stroke-primary-foreground inline aspect-square w-3 h-auto fill-transparent rotate-[var(--rotation)]"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M3 12L21 12M21 12L12.5 3.5M21 12L12.5 20.5"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"></path>
                </svg>
              </a>
              <a
                class="hover:brightness-125 duration-200"
                href="https://www.github.com/githubUsername"
              >
                GitHub
                <svg
                  style="--rotation: -45deg"
                  class="stroke-primary-foreground inline aspect-square w-3 h-auto fill-transparent rotate-[var(--rotation)]"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M3 12L21 12M21 12L12.5 3.5M21 12L12.5 20.5"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"></path>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- AI Workers Section - Centered -->
    <section
      class="ai-workers-section flex items-center justify-center py-16"
      id="ai-workers"
      data-astro-cid-my52qgmw
    >
      <div class="section-container" data-astro-cid-my52qgmw>
        <h2 class="section-title" data-astro-cid-my52qgmw>AI WORKERS</h2>
        <p class="section-description" data-astro-cid-my52qgmw>
          Zaawansowane narzƒôdzia AI dostƒôpne na platformie
        </p>

        <!-- Small Tags Section -->
        <div class="tags-section" data-astro-cid-my52qgmw>
          <a
            href="/agents"
            class="tag-btn bg-cyan-600 hover:bg-cyan-700 text-white transition-colors"
            data-astro-cid-my52qgmw>ü§ñ AGENTS_SYSTEM</a
          >
          <button
            class="tag-btn"
            onclick="document.getElementById('agents-management').scrollIntoView({behavior: 'smooth'})"
            data-astro-cid-my52qgmw>AGENTS_MANAGER</button
          >
          <button
            class="tag-btn multiline"
            onclick="window.open('/hub/agent-builder', '_blank')"
            data-astro-cid-my52qgmw
            ><span>POLACZEK</span><br /><span>AGENT_SYS_23</span></button
          >
          <button
            class="tag-btn"
            onclick="window.open('/hub/ai-agent-s', '_blank')"
            data-astro-cid-my52qgmw>BIELIK</button
          >
          <button
            class="tag-btn"
            onclick="window.open('/workers', '_blank')"
            data-astro-cid-my52qgmw>ZENON</button
          >
          <button
            class="tag-btn"
            onclick="window.open('/dashboard', '_blank')"
            data-astro-cid-my52qgmw>KLF_SHEED_SHOOP</button
          >
        </div>

        <div class="workers-grid" data-astro-cid-my52qgmw>
          <!-- Image Generator -->
          <div class="worker-card" data-worker="image" data-astro-cid-my52qgmw>
            <h3 class="worker-title" data-astro-cid-my52qgmw>
              Generator Obraz√≥w
            </h3>
            <p class="worker-description" data-astro-cid-my52qgmw>
              Tw√≥rz niesamowite obrazy z tekstu u≈ºywajƒÖc Flux-1 Schnell
            </p>
            <div class="worker-features" data-astro-cid-my52qgmw>
              <span class="feature-tag" data-astro-cid-my52qgmw>Flux AI</span>
              <span class="feature-tag" data-astro-cid-my52qgmw>512-1024px</span
              >
              <span class="feature-tag" data-astro-cid-my52qgmw
                >T≈Çumaczenie PL</span
              >
            </div>
            <div class="worker-actions" data-astro-cid-my52qgmw>
              <input
                type="text"
                placeholder="Opisz obraz..."
                class="quick-prompt"
                id="imagePrompt"
                data-astro-cid-my52qgmw
              />
              <button
                class="action-btn primary"
                onclick="openImageGenerator()"
                data-astro-cid-my52qgmw>Generuj</button
              >
              <button
                class="action-btn secondary"
                onclick="window.open('/image-generator', '_blank')"
                data-astro-cid-my52qgmw>Otw√≥rz</button
              >
            </div>
          </div>

          <!-- AI Chatbot -->
          <div class="worker-card" data-worker="chat" data-astro-cid-my52qgmw>
            <h3 class="worker-title" data-astro-cid-my52qgmw>AI Chatbot</h3>
            <p class="worker-description" data-astro-cid-my52qgmw>
              Inteligentny asystent do rozm√≥w i odpowiadania na pytania
            </p>
            <div class="worker-features" data-astro-cid-my52qgmw>
              <span class="feature-tag" data-astro-cid-my52qgmw>OpenAI GPT</span
              >
              <span class="feature-tag" data-astro-cid-my52qgmw
                >Jƒôzyk polski</span
              >
              <span class="feature-tag" data-astro-cid-my52qgmw>Kontekst</span>
            </div>
            <div class="worker-actions" data-astro-cid-my52qgmw>
              <input
                type="text"
                placeholder="Zadaj pytanie..."
                class="quick-prompt"
                id="chatPrompt"
                data-astro-cid-my52qgmw
              />
              <button
                class="action-btn primary"
                onclick="openChatbot()"
                data-astro-cid-my52qgmw>Chat</button
              >
              <button
                class="action-btn secondary"
                onclick="window.open('/chatbot', '_blank')"
                data-astro-cid-my52qgmw>Otw√≥rz</button
              >
            </div>
          </div>

          <!-- BigQuery Analytics -->
          <div
            class="worker-card"
            data-worker="bigquery"
            data-astro-cid-my52qgmw
          >
            <h3 class="worker-title" data-astro-cid-my52qgmw>
              BigQuery Analytics
            </h3>
            <p class="worker-description" data-astro-cid-my52qgmw>
              Analizuj dane z Google BigQuery, wykonuj zapytania SQL
            </p>
            <div class="worker-features" data-astro-cid-my52qgmw>
              <span class="feature-tag" data-astro-cid-my52qgmw
                >Google Cloud</span
              >
              <span class="feature-tag" data-astro-cid-my52qgmw>SQL Query</span>
              <span class="feature-tag" data-astro-cid-my52qgmw>Analytics</span>
            </div>
            <div class="worker-actions" data-astro-cid-my52qgmw>
              <input
                type="text"
                placeholder="SELECT * FROM..."
                class="quick-prompt"
                id="bigqueryPrompt"
                data-astro-cid-my52qgmw
              />
              <button
                class="action-btn primary"
                onclick="openBigQuery()"
                data-astro-cid-my52qgmw>Analizuj</button
              >
              <button
                class="action-btn secondary"
                onclick="window.open('/bigquery-analytics', '_blank')"
                data-astro-cid-my52qgmw>Otw√≥rz</button
              >
            </div>
          </div>

          <!-- Kaggle Datasets -->
          <div class="worker-card" data-worker="kaggle" data-astro-cid-my52qgmw>
            <h3 class="worker-title" data-astro-cid-my52qgmw>
              Kaggle Datasets
            </h3>
            <p class="worker-description" data-astro-cid-my52qgmw>
              Przeszukuj zbiory danych, konkursy i profile Kaggle
            </p>
            <div class="worker-features" data-astro-cid-my52qgmw>
              <span class="feature-tag" data-astro-cid-my52qgmw
                >Machine Learning</span
              >
              <span class="feature-tag" data-astro-cid-my52qgmw>Datasets</span>
              <span class="feature-tag" data-astro-cid-my52qgmw
                >Competitions</span
              >
            </div>
            <div class="worker-actions" data-astro-cid-my52qgmw>
              <input
                type="text"
                placeholder="machine learning..."
                class="quick-prompt"
                id="kagglePrompt"
                data-astro-cid-my52qgmw
              />
              <button
                class="action-btn primary"
                onclick="openKaggle()"
                data-astro-cid-my52qgmw>Wyszukaj</button
              >
              <button
                class="action-btn secondary"
                onclick="window.open('/kaggle-datasets', '_blank')"
                data-astro-cid-my52qgmw>Otw√≥rz</button
              >
            </div>
          </div>

          <!-- Tavily Search -->
          <div class="worker-card" data-worker="tavily" data-astro-cid-my52qgmw>
            <h3 class="worker-title" data-astro-cid-my52qgmw>
              Tavily AI Search
            </h3>
            <p class="worker-description" data-astro-cid-my52qgmw>
              Zaawansowane wyszukiwanie internetowe powered by AI
            </p>
            <div class="worker-features" data-astro-cid-my52qgmw>
              <span class="feature-tag" data-astro-cid-my52qgmw>AI Search</span>
              <span class="feature-tag" data-astro-cid-my52qgmw>Real-time</span>
              <span class="feature-tag" data-astro-cid-my52qgmw
                >Deep Analysis</span
              >
            </div>
            <div class="worker-actions" data-astro-cid-my52qgmw>
              <input
                type="text"
                placeholder="wyszukaj w sieci..."
                class="quick-prompt"
                id="tavilyPrompt"
                data-astro-cid-my52qgmw
              />
              <button
                class="action-btn primary"
                onclick="openTavily()"
                data-astro-cid-my52qgmw>Szukaj</button
              >
              <button
                class="action-btn secondary"
                onclick="window.open('/tavily-search', '_blank')"
                data-astro-cid-my52qgmw>Otw√≥rz</button
              >
            </div>
          </div>

          <!-- Status Monitor - Quick Access Only -->
          <div class="worker-card" data-worker="status" data-astro-cid-my52qgmw>
            <h3 class="worker-title" data-astro-cid-my52qgmw>
              AI Workers Status & Store
            </h3>
            <p class="worker-description" data-astro-cid-my52qgmw>
              ZarzƒÖdzanie statusem worker√≥w AI oraz zakup token√≥w do
              poszczeg√≥lnych us≈Çug
            </p>

            <div class="quick-stats" data-astro-cid-my52qgmw>
              <div class="stat-item" data-astro-cid-my52qgmw>
                <span class="stat-number" data-astro-cid-my52qgmw>5</span>
                <span class="stat-label" data-astro-cid-my52qgmw
                  >Aktywnych Workers</span
                >
              </div>
              <div class="stat-item" data-astro-cid-my52qgmw>
                <span class="stat-number" data-astro-cid-my52qgmw>323</span>
                <span class="stat-label" data-astro-cid-my52qgmw
                  >≈ÅƒÖczne Tokeny</span
                >
              </div>
              <div class="stat-item" data-astro-cid-my52qgmw>
                <span class="stat-number success" data-astro-cid-my52qgmw
                  >98.2%</span
                >
                <span class="stat-label" data-astro-cid-my52qgmw>Uptime</span>
              </div>
            </div>

            <div class="worker-actions" data-astro-cid-my52qgmw>
              <button
                class="action-btn primary"
                onclick="window.open('/workers-status', '_blank')"
                data-astro-cid-my52qgmw>ZarzƒÖdzaj Workerami</button
              >
            </div>
          </div>
        </div>

        <!-- Additional Functions Grid -->
        <div class="additional-functions-section" data-astro-cid-my52qgmw>
          <h3 class="additional-title" data-astro-cid-my52qgmw>
            SYSTEM MANAGEMENT
          </h3>
          <div class="additional-grid" data-astro-cid-my52qgmw>
            <!-- Row 1 -->
            <button
              class="additional-btn"
              onclick="window.open('/dashboard', '_blank')"
              data-function="dashboard"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>ÔøΩ</div>
              <h4 data-astro-cid-my52qgmw>DASHBOARD</h4>
              <p data-astro-cid-my52qgmw>Panel administracyjny i monitoring</p>
            </button>
            <button
              class="additional-btn"
              onclick="window.open('/workers', '_blank')"
              data-function="workers"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>‚öôÔ∏è</div>
              <h4 data-astro-cid-my52qgmw>WORKERS CENTER</h4>
              <p data-astro-cid-my52qgmw>Centrum automatyzacji AI</p>
            </button>
            <button
              class="additional-btn"
              onclick="window.open('/hub/agent-builder', '_blank')"
              data-function="agent-builder"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>üõ†Ô∏è</div>
              <h4 data-astro-cid-my52qgmw>AGENT BUILDER</h4>
              <p data-astro-cid-my52qgmw>Kreator agent√≥w AI</p>
            </button>

            <!-- Row 2 -->
            <button
              class="additional-btn"
              onclick="window.open('/analytics', '_blank')"
              data-function="analytics"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>ÔøΩ</div>
              <h4 data-astro-cid-my52qgmw>ANALYTICS</h4>
              <p data-astro-cid-my52qgmw>Analityka i raporty</p>
            </button>
            <button
              class="additional-btn"
              onclick="window.open('/hub', '_blank')"
              data-function="hub"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>üåê</div>
              <h4 data-astro-cid-my52qgmw>AI HUB</h4>
              <p data-astro-cid-my52qgmw>Centrum AI Services</p>
            </button>
            <button
              class="additional-btn"
              onclick="window.open('/settings', '_blank')"
              data-function="settings"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>‚öôÔ∏è</div>
              <h4 data-astro-cid-my52qgmw>SETTINGS</h4>
              <p data-astro-cid-my52qgmw>Konfiguracja systemu</p>
            </button>

            <!-- Row 3 -->
            <button
              class="additional-btn"
              onclick="window.open('/reports', '_blank')"
              data-function="reports"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>ÔøΩ</div>
              <h4 data-astro-cid-my52qgmw>REPORTS</h4>
              <p data-astro-cid-my52qgmw>Raporty systemowe</p>
            </button>
            <button
              class="additional-btn"
              onclick="window.open('/hub/ai-agent-s', '_blank')"
              data-function="ai-agents"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>ü§ñ</div>
              <h4 data-astro-cid-my52qgmw>AI AGENTS</h4>
              <p data-astro-cid-my52qgmw>ZarzƒÖdzanie agentami</p>
            </button>
            <button
              class="additional-btn"
              onclick="openCloudflareWorkers()"
              data-function="cloudflare"
              data-astro-cid-my52qgmw
            >
              <div class="additional-icon" data-astro-cid-my52qgmw>‚òÅÔ∏è</div>
              <h4 data-astro-cid-my52qgmw>CLOUDFLARE</h4>
              <p data-astro-cid-my52qgmw>Workers deployment</p>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer Section -->
    <section class="border border-edge">
      <div class="max-w-6xl mx-auto border-x border-edge">
        <div
          class="flex flex-row justify-center gap-8 m-auto py-16 text-center"
        >
          <a
            class="hover:brightness-125 duration-200"
            target="_blank"
            rel="noopener noreferrer"
            href="/workers"
          >
            SYSTEM AGENTS
            <svg
              style="--rotation: -45deg"
              class="stroke-primary-foreground inline aspect-square w-3 h-auto fill-transparent rotate-[var(--rotation)]"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M3 12L21 12M21 12L12.5 3.5M21 12L12.5 20.5"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            </svg>
          </a>
          <div
            class="group w-24 p-1 border border-primary-foreground rounded-interactive text-primary-foreground text-xs font-black text-nowrap opacity-60"
          >
            <span class="group-hover:hidden">100% HANDMADE</span>
            <span class="hidden group-hover:inline">0% AI</span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- AI Help Assistant Integration -->
  <AiHelpAssistant client:load />
</MyBonzoLayout>

<!-- JavaScript Functions -->
<script>
  // Worker Functions with API Integration
  function openImageGenerator() {
    const prompt = document.getElementById("imagePrompt")?.value.trim();
    if (prompt) {
      localStorage.setItem("quickPrompt", prompt);
      // Call Image Generation API
      generateImageAPI(prompt);
    } else {
      window.open("/image-generator", "_blank");
    }
  }

  function openChatbot() {
    const prompt = document.getElementById("chatPrompt")?.value.trim();
    if (prompt) {
      localStorage.setItem("quickChatPrompt", prompt);
      // Call Chat API
      callChatAPI(prompt);
    } else {
      window.open("/chatbot", "_blank");
    }
  }

  function openBigQuery() {
    const prompt = document.getElementById("bigqueryPrompt")?.value.trim();
    if (prompt) {
      localStorage.setItem("quickSQLQuery", prompt);
      // Call BigQuery API
      executeBigQueryAPI(prompt);
    } else {
      window.open("/bigquery-analytics", "_blank");
    }
  }

  function openKaggle() {
    const prompt = document.getElementById("kagglePrompt")?.value.trim();
    if (prompt) {
      localStorage.setItem("quickKaggleSearch", prompt);
      // Call Kaggle API
      searchKaggleAPI(prompt);
    } else {
      window.open("/kaggle-datasets", "_blank");
    }
  }

  function openTavily() {
    const prompt = document.getElementById("tavilyPrompt")?.value.trim();
    if (prompt) {
      localStorage.setItem("quickTavilySearch", prompt);
      // Call Tavily API
      searchTavilyAPI(prompt);
    } else {
      window.open("/tavily-search", "_blank");
    }
  }

  // API Functions
  async function generateImageAPI(prompt) {
    try {
      const response = await fetch("/api/generate-image", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt }),
      });
      const data = await response.json();
      showAPIResult("Image Generation", data);
    } catch (error) {
      showAPIError("Image Generation", error.message);
    }
  }

  async function callChatAPI(prompt) {
    try {
      const response = await fetch("/api/ai-bot-worker", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt }),
      });
      const data = await response.json();
      showAPIResult("AI Chat", data);
    } catch (error) {
      showAPIError("AI Chat", error.message);
    }
  }

  async function executeBigQueryAPI(query) {
    try {
      const response = await fetch("/api/bigquery", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query }),
      });
      const data = await response.json();
      showAPIResult("BigQuery Analytics", data);
    } catch (error) {
      showAPIError("BigQuery Analytics", error.message);
    }
  }

  async function searchKaggleAPI(query) {
    try {
      const response = await fetch("/api/kaggle", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query, type: "datasets" }),
      });
      const data = await response.json();
      showAPIResult("Kaggle Search", data);
    } catch (error) {
      showAPIError("Kaggle Search", error.message);
    }
  }

  async function searchTavilyAPI(query) {
    try {
      const response = await fetch("/api/tavily", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query, searchType: "web", language: "pl" }),
      });
      const data = await response.json();
      showAPIResult("Tavily Search", data);
    } catch (error) {
      showAPIError("Tavily Search", error.message);
    }
  }

  // UI Helper Functions
  function showAPIResult(title, data) {
    const resultModal = createResultModal(title, data);
    document.body.appendChild(resultModal);
  }

  function showAPIError(title, error) {
    const errorModal = createErrorModal(title, error);
    document.body.appendChild(errorModal);
  }

  function createResultModal(title, data) {
    const modal = document.createElement("div");
    modal.className =
      "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";
    modal.innerHTML = `
      <div class="bg-gray-800 p-6 rounded-lg max-w-2xl max-h-96 overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-cyan-400">${title} - Wynik</h3>
          <button onclick="this.closest('.fixed').remove()" class="text-white hover:text-cyan-400">‚úï</button>
        </div>
        <pre class="text-sm text-gray-300 whitespace-pre-wrap">${JSON.stringify(data, null, 2)}</pre>
      </div>
    `;
    return modal;
  }

  function createErrorModal(title, error) {
    const modal = document.createElement("div");
    modal.className =
      "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";
    modal.innerHTML = `
      <div class="bg-red-900 p-6 rounded-lg max-w-md">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-red-400">${title} - B≈ÇƒÖd</h3>
          <button onclick="this.closest('.fixed').remove()" class="text-white hover:text-red-400">‚úï</button>
        </div>
        <p class="text-red-200">${error}</p>
      </div>
    `;
    return modal;
  }

  // Cloudflare Workers Integration
  function openCloudflareWorkers() {
    // Check if workers dashboard is available
    const cloudflareUrl = "https://dash.cloudflare.com/";
    window.open(cloudflareUrl, "_blank");
  }

  // Status Check Function
  async function checkAllStatus() {
    const statusElement = document.getElementById("overallStatus");
    if (!statusElement) return;

    const statusDot = statusElement.querySelector(".status-dot");
    const statusText = statusElement.querySelector("span:last-child");

    if (!statusDot || !statusText) return;

    statusText.textContent = "Sprawdzanie...";
    statusDot.className = "status-dot";

    try {
      const apis = [
        "/api/generate-image",
        "/api/ai-bot-worker",
        "/api/bigquery",
        "/api/kaggle",
        "/api/tavily",
      ];

      const results = await Promise.allSettled(
        apis.map((api) => fetch(api).then((res) => ({ api, ok: res.ok })))
      );

      const onlineCount = results.filter(
        (result) => result.status === "fulfilled" && result.value.ok
      ).length;

      const totalCount = apis.length;

      if (onlineCount === totalCount) {
        statusDot.className = "status-dot online";
        statusText.textContent = `Wszystkie online (${onlineCount}/${totalCount})`;
      } else if (onlineCount > 0) {
        statusDot.className = "status-dot";
        statusText.textContent = `Czƒô≈õciowo online (${onlineCount}/${totalCount})`;
      } else {
        statusDot.className = "status-dot offline";
        statusText.textContent = `Offline (${onlineCount}/${totalCount})`;
      }
    } catch (error) {
      statusDot.className = "status-dot offline";
      statusText.textContent = "B≈ÇƒÖd sprawdzania";
    }
  }

  // Auto-check status on load and add Enter key handlers
  document.addEventListener("DOMContentLoaded", function () {
    // Add quick prompt handlers
    document.querySelectorAll(".quick-prompt").forEach((input) => {
      input.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          const type = this.id.replace("Prompt", "");
          const functions = {
            image: openImageGenerator,
            chat: openChatbot,
            bigquery: openBigQuery,
            kaggle: openKaggle,
            tavily: openTavily,
          };
          if (functions[type]) {
            functions[type]();
          }
        }
      });
    });

    // Check status on load
    checkAllStatus();
  });

  // Token Store Functions
  function buyTokens(workerType) {
    const workerInfo = {
      "image-gen": {
        name: "Generator Obraz√≥w",
        basePrice: 10,
        currency: "PLN",
        packages: [
          { tokens: 50, price: 10, popular: false },
          { tokens: 100, price: 18, popular: true },
          { tokens: 250, price: 40, popular: false },
          { tokens: 500, price: 75, popular: false },
        ],
      },
      chatbot: {
        name: "AI Chatbot",
        basePrice: 15,
        currency: "PLN",
        packages: [
          { tokens: 100, price: 15, popular: false },
          { tokens: 200, price: 25, popular: true },
          { tokens: 500, price: 55, popular: false },
          { tokens: 1000, price: 100, popular: false },
        ],
      },
      bigquery: {
        name: "BigQuery Analytics",
        basePrice: 20,
        currency: "PLN",
        packages: [
          { tokens: 25, price: 20, popular: false },
          { tokens: 50, price: 35, popular: true },
          { tokens: 100, price: 65, popular: false },
          { tokens: 200, price: 120, popular: false },
        ],
      },
      kaggle: {
        name: "Kaggle Datasets",
        basePrice: 25,
        currency: "PLN",
        packages: [
          { tokens: 50, price: 25, popular: false },
          { tokens: 100, price: 45, popular: true },
          { tokens: 250, price: 100, popular: false },
          { tokens: 500, price: 180, popular: false },
        ],
      },
      tavily: {
        name: "Tavily Search",
        basePrice: 12,
        currency: "PLN",
        packages: [
          { tokens: 100, price: 12, popular: false },
          { tokens: 200, price: 20, popular: true },
          { tokens: 500, price: 45, popular: false },
          { tokens: 1000, price: 80, popular: false },
        ],
      },
    };

    const worker = workerInfo[workerType];
    if (!worker) return;

    showTokenStoreModal(worker, workerType);
  }

  function showTokenStoreModal(worker, workerType) {
    const modal = document.createElement("div");
    modal.className =
      "fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50";

    modal.innerHTML = `
      <div class="bg-gray-900 border border-cyan-400 rounded-lg max-w-md w-full mx-4 p-6">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-bold text-cyan-400">üõí ${worker.name}</h3>
          <button onclick="this.closest('.fixed').remove()" class="text-white hover:text-cyan-400 text-xl">‚úï</button>
        </div>
        
        <p class="text-gray-300 mb-6">Wybierz pakiet token√≥w dla ${worker.name}:</p>
        
        <div class="space-y-3 mb-6">
          ${worker.packages
            .map(
              (pkg) => `
            <div class="token-package ${pkg.popular ? "popular" : ""}" onclick="selectTokenPackage('${workerType}', ${pkg.tokens}, ${pkg.price})">
              <div class="flex justify-between items-center">
                <div>
                  <div class="font-semibold text-white">${pkg.tokens} token√≥w</div>
                  <div class="text-sm text-gray-400">${(pkg.price / pkg.tokens).toFixed(2)} ${worker.currency}/token</div>
                </div>
                <div class="text-right">
                  <div class="font-bold text-cyan-400">${pkg.price} ${worker.currency}</div>
                  ${pkg.popular ? '<div class="text-xs text-green-400">POPULARNE</div>' : ""}
                </div>
              </div>
              ${pkg.popular ? '<div class="popular-badge">NAJLEPSZY WYB√ìR</div>' : ""}
            </div>
          `
            )
            .join("")}
        </div>
        
        <div class="text-center">
          <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded mr-3">
            Anuluj
          </button>
          <button onclick="openPaymentGateway('${workerType}')" class="bg-cyan-500 hover:bg-cyan-600 text-black px-6 py-2 rounded font-semibold">
            Przejd≈∫ do p≈Çatno≈õci
          </button>
        </div>
      </div>
    `;

    document.body.appendChild(modal);
  }

  function selectTokenPackage(workerType, tokens, price) {
    // Remove previous selections
    document
      .querySelectorAll(".token-package")
      .forEach((pkg) => pkg.classList.remove("selected"));

    // Mark current selection
    event.currentTarget.classList.add("selected");

    // Store selection for payment
    window.selectedPackage = { workerType, tokens, price };
  }

  function openPaymentGateway(workerType) {
    const selected = window.selectedPackage;
    if (!selected) {
      // Default to first package if none selected
      const modal = document.querySelector(".fixed");
      const firstPackage = modal.querySelector(".token-package");
      if (firstPackage) firstPackage.click();
      return;
    }

    // Close current modal
    document.querySelector(".fixed").remove();

    // Show payment modal (for now just a placeholder)
    showPaymentModal(selected);
  }

  function showPaymentModal(packageData) {
    const modal = document.createElement("div");
    modal.className =
      "fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50";

    modal.innerHTML = `
      <div class="bg-gray-900 border border-green-400 rounded-lg max-w-md w-full mx-4 p-6">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-bold text-green-400">üí≥ P≈Çatno≈õƒá</h3>
          <button onclick="this.closest('.fixed').remove()" class="text-white hover:text-green-400 text-xl">‚úï</button>
        </div>
        
        <div class="text-center mb-6">
          <div class="text-2xl font-bold text-white mb-2">${packageData.tokens} token√≥w</div>
          <div class="text-3xl font-bold text-green-400 mb-4">${packageData.price} PLN</div>
          <p class="text-gray-300">P≈Çatno≈õƒá bƒôdzie dostƒôpna wkr√≥tce!</p>
        </div>
        
        <div class="bg-gray-800 rounded p-4 mb-6">
          <h4 class="font-semibold text-cyan-400 mb-2">Metody p≈Çatno≈õci (wkr√≥tce):</h4>
          <div class="flex justify-center space-x-4 text-gray-400">
            <span>üí≥ Karta</span>
            <span>üè¶ Przelew</span>
            <span>üì± BLIK</span>
            <span>üí∞ PayPal</span>
          </div>
        </div>
        
        <div class="text-center">
          <button onclick="this.closest('.fixed').remove()" class="bg-green-500 hover:bg-green-600 text-black px-8 py-3 rounded font-semibold">
            Powiadom o dostƒôpno≈õci
          </button>
        </div>
      </div>
    `;

    document.body.appendChild(modal);
  }

  function refreshAllStatus() {
    // Simulate status refresh
    const statusItems = document.querySelectorAll(".worker-status-item");
    statusItems.forEach((item) => {
      const badge = item.querySelector(".status-badge");
      const tokensLeft = item.querySelector(".tokens-left");

      // Simulate loading
      badge.textContent = "SPRAWDZANIE...";
      badge.className = "status-badge";

      setTimeout(
        () => {
          // Restore original status (could be dynamic in real implementation)
          const isOnline = Math.random() > 0.2; // 80% chance online
          badge.className = `status-badge ${isOnline ? "online" : "offline"}`;
          badge.textContent = isOnline ? "ONLINE" : "OFFLINE";

          // Random token count update
          if (isOnline && tokensLeft) {
            const current = parseInt(tokensLeft.textContent.match(/\d+/)[0]);
            const newCount = current + Math.floor(Math.random() * 10) - 5;
            tokensLeft.textContent = tokensLeft.textContent.replace(
              /\d+/,
              Math.max(0, newCount)
            );
          }
        },
        1000 + Math.random() * 1000
      );
    });
  }

  function openTokenStore() {
    window.open("/token-store", "_blank");
  }
</script>

<style>
  .token-package {
    border: 1px solid rgba(0, 217, 255, 0.3);
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }

  .token-package:hover {
    border-color: rgba(0, 217, 255, 0.6);
    background: rgba(0, 217, 255, 0.1);
  }

  .token-package.popular {
    border-color: rgba(34, 197, 94, 0.5);
    background: rgba(34, 197, 94, 0.1);
  }

  .token-package.selected {
    border-color: #00d9ff;
    background: rgba(0, 217, 255, 0.2);
    box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
  }

  .popular-badge {
    position: absolute;
    top: -8px;
    right: 8px;
    background: linear-gradient(45deg, #22c55e, #16a34a);
    color: white;
    font-size: 0.6rem;
    font-weight: bold;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
</style>
