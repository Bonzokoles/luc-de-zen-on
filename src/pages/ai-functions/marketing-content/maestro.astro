---
import MyBonzoLayout from "../../../layouts/MyBonzoLayout.astro";
import DecorativeLines from "../../../components/DecorativeLines.astro";
---

<MyBonzoLayout
  siteTitle="Marketing Maestro - Advanced Campaign Manager | AI Functions | KAROL LISSON"
>
  <DecorativeLines />

  <main class="min-h-svh relative z-10">
    <!-- Background Grid Pattern -->
    <div class="fixed inset-0 bg-[#0a0a0a]">
      <div class="absolute inset-0 bg-gradient-to-br from-purple-900/20 via-black to-cyan-900/20"></div>
      <div class="cyber-grid absolute inset-0"></div>
    </div>

    <!-- Header Section -->
    <section class="relative z-20 border-b border-[#333333] pt-20">
      <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex items-center justify-between mb-8">
          <div>
            <h1 class="text-4xl md:text-5xl font-bold text-[#00ffff] mb-2 uppercase tracking-wider font-mono">
              MARKETING MAESTRO
            </h1>
            <p class="text-[#a0a0a0] text-lg font-['Kenyan_Coffee']">
              Zaawansowane zarządzanie kampaniami AI z optymalizacją dla polskiego rynku
            </p>
          </div>
          <div class="text-right text-sm text-[#a0a0a0] font-mono">
            <div class="mb-1">STATUS: <span class="text-[#00ff00]">ONLINE</span></div>
            <div class="mb-1">PLATFORMY: <span class="text-[#00ffff]">5 ACTIVE</span></div>
            <div>AI MODEL: <span class="text-[#ff6699]">GPT-4 + DALL-E</span></div>
          </div>
        </div>

        <!-- Navigation -->
        <div class="flex gap-4 mb-8 flex-wrap">
          <a href="../marketing-content/" class="px-4 py-2 bg-[#111111] border border-[#333333] text-[#a0a0a0] hover:text-[#00ffff] transition-all duration-300 font-mono uppercase tracking-wide text-sm">
            ← GENERATOR
          </a>
          <button id="dashboardTab" class="px-4 py-2 bg-[#00ffff] text-[#0a0a0a] border border-[#00ffff] font-bold font-mono uppercase tracking-wide text-sm">
            DASHBOARD
          </button>
          <button id="campaignTab" class="px-4 py-2 bg-[#111111] border border-[#333333] text-[#a0a0a0] hover:text-[#00ffff] transition-all duration-300 font-mono uppercase tracking-wide text-sm">
            KAMPANIE
          </button>
          <button id="creativeTab" class="px-4 py-2 bg-[#111111] border border-[#333333] text-[#a0a0a0] hover:text-[#00ffff] transition-all duration-300 font-mono uppercase tracking-wide text-sm">
            AI CREATIVE
          </button>
          <button id="analyticsTab" class="px-4 py-2 bg-[#111111] border border-[#333333] text-[#a0a0a0] hover:text-[#00ffff] transition-all duration-300 font-mono uppercase tracking-wide text-sm">
            ANALITYKA
          </button>
          <button id="automationTab" class="px-4 py-2 bg-[#111111] border border-[#333333] text-[#a0a0a0] hover:text-[#00ffff] transition-all duration-300 font-mono uppercase tracking-wide text-sm">
            AUTOMATYZACJA
          </button>
        </div>
      </div>
    </section>

    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content relative z-20 py-12">
      <div class="max-w-6xl mx-auto px-4">
        
        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
          <div class="bg-[#111111] border border-[#00ffff] p-6 text-center cyber-glow">
            <div class="text-3xl font-bold text-[#00ff00] mb-2 font-mono" id="totalRevenue">$47,820</div>
            <div class="text-[#a0a0a0] text-sm uppercase">Przychód (30d)</div>
            <div class="text-[#00ff00] text-xs mt-1">↗ +24.5%</div>
          </div>
          <div class="bg-[#111111] border border-[#333333] p-6 text-center">
            <div class="text-3xl font-bold text-[#00ffff] mb-2 font-mono" id="totalLeads">6,247</div>
            <div class="text-[#a0a0a0] text-sm uppercase">Nowi leady</div>
            <div class="text-[#00ff00] text-xs mt-1">↗ +18.2%</div>
          </div>
          <div class="bg-[#111111] border border-[#333333] p-6 text-center">
            <div class="text-3xl font-bold text-[#ff6699] mb-2 font-mono" id="avgRoas">4.2x</div>
            <div class="text-[#a0a0a0] text-sm uppercase">Średni ROAS</div>
            <div class="text-[#00ff00] text-xs mt-1">↗ +12.8%</div>
          </div>
          <div class="bg-[#111111] border border-[#333333] p-6 text-center">
            <div class="text-3xl font-bold text-[#ffaa00] mb-2 font-mono" id="avgCpa">$3.40</div>
            <div class="text-[#a0a0a0] text-sm uppercase">Średni CPA</div>
            <div class="text-[#ff6666] text-xs mt-1">↘ -8.1%</div>
          </div>
        </div>

        <!-- Platform Status -->
        <div class="bg-[#111111] border border-[#333333] p-6 mb-8">
          <h3 class="text-xl font-bold text-[#00ffff] mb-4 font-mono">STATUS PLATFORM REKLAMOWYCH</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            
            <div class="bg-[#0a0a0a] border border-[#333333] p-4 flex items-center justify-between">
              <div>
                <div class="text-[#00ffff] font-bold font-mono">GOOGLE ADS</div>
                <div class="text-[#a0a0a0] text-sm">3 aktywne kampanie</div>
              </div>
              <div class="text-right">
                <div class="text-[#00ff00] font-bold">ONLINE</div>
                <div class="text-[#a0a0a0] text-sm">$1,247/dzień</div>
              </div>
            </div>

            <div class="bg-[#0a0a0a] border border-[#333333] p-4 flex items-center justify-between">
              <div>
                <div class="text-[#00ffff] font-bold font-mono">FACEBOOK ADS</div>
                <div class="text-[#a0a0a0] text-sm">5 aktywnych kampanii</div>
              </div>
              <div class="text-right">
                <div class="text-[#00ff00] font-bold">ONLINE</div>
                <div class="text-[#a0a0a0] text-sm">$892/dzień</div>
              </div>
            </div>

            <div class="bg-[#0a0a0a] border border-[#333333] p-4 flex items-center justify-between">
              <div>
                <div class="text-[#00ffff] font-bold font-mono">LINKEDIN ADS</div>
                <div class="text-[#a0a0a0] text-sm">2 aktywne kampanie</div>
              </div>
              <div class="text-right">
                <div class="text-[#00ff00] font-bold">ONLINE</div>
                <div class="text-[#a0a0a0] text-sm">$456/dzień</div>
              </div>
            </div>

            <div class="bg-[#0a0a0a] border border-[#333333] p-4 flex items-center justify-between">
              <div>
                <div class="text-[#00ffff] font-bold font-mono">ALLEGRO ADS</div>
                <div class="text-[#a0a0a0] text-sm">4 aktywne kampanie</div>
              </div>
              <div class="text-right">
                <div class="text-[#00ff00] font-bold">ONLINE</div>
                <div class="text-[#a0a0a0] text-sm">$234/dzień</div>
              </div>
            </div>

            <div class="bg-[#0a0a0a] border border-[#333333] p-4 flex items-center justify-between">
              <div>
                <div class="text-[#00ffff] font-bold font-mono">TIKTOK ADS</div>
                <div class="text-[#a0a0a0] text-sm">1 aktywna kampania</div>
              </div>
              <div class="text-right">
                <div class="text-[#ffaa00] font-bold">TESTING</div>
                <div class="text-[#a0a0a0] text-sm">$123/dzień</div>
              </div>
            </div>

          </div>
        </div>

        <!-- Polish Market Insights -->
        <div class="bg-[#111111] border border-[#333333] p-6 mb-8">
          <h3 class="text-xl font-bold text-[#00ffff] mb-4 font-mono">INSIGHTS POLSKIEGO RYNKU</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            
            <div class="bg-[#0a0a0a] border border-[#333333] p-4">
              <div class="text-[#ff6699] font-bold mb-2 font-mono">SEZON ŚWIĄTECZNY</div>
              <div class="text-[#a0a0a0] text-sm mb-2">Zalecane zwiększenie budżetu:</div>
              <div class="text-[#00ff00] font-bold">+40%</div>
              <div class="text-[#666666] text-xs mt-1">Do 31 grudnia</div>
            </div>

            <div class="bg-[#0a0a0a] border border-[#333333] p-4">
              <div class="text-[#ff6699] font-bold mb-2 font-mono">POPULARNE PŁATNOŚCI</div>
              <div class="space-y-1 text-sm">
                <div class="flex justify-between"><span class="text-[#a0a0a0]">BLIK:</span> <span class="text-[#00ffff]">45%</span></div>
                <div class="flex justify-between"><span class="text-[#a0a0a0]">Karta:</span> <span class="text-[#00ffff]">35%</span></div>
                <div class="flex justify-between"><span class="text-[#a0a0a0]">P24:</span> <span class="text-[#00ffff]">28%</span></div>
              </div>
            </div>

            <div class="bg-[#0a0a0a] border border-[#333333] p-4">
              <div class="text-[#ff6699] font-bold mb-2 font-mono">TOP REGIONY</div>
              <div class="space-y-1 text-sm">
                <div class="flex justify-between"><span class="text-[#a0a0a0]">Mazowieckie:</span> <span class="text-[#00ffff]">32%</span></div>
                <div class="flex justify-between"><span class="text-[#a0a0a0]">Śląskie:</span> <span class="text-[#00ffff]">18%</span></div>
                <div class="flex justify-between"><span class="text-[#a0a0a0]">Wielkopolskie:</span> <span class="text-[#00ffff]">15%</span></div>
              </div>
            </div>

            <div class="bg-[#0a0a0a] border border-[#333333] p-4">
              <div class="text-[#ff6699] font-bold mb-2 font-mono">TRENDY KONSUMENCKIE</div>
              <div class="space-y-1 text-sm">
                <div class="text-[#a0a0a0]">Świadomość ceny: <span class="text-[#ffaa00]">WYSOKA</span></div>
                <div class="text-[#a0a0a0]">Mobile commerce: <span class="text-[#00ff00]">78%</span></div>
                <div class="text-[#a0a0a0]">Social commerce: <span class="text-[#00ffff]">42%</span></div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>

    <!-- Campaigns Tab -->
    <div id="campaigns" class="tab-content relative z-20 py-12 hidden">
      <div class="max-w-6xl mx-auto px-4">
        
        <!-- Quick Campaign Creator -->
        <div class="bg-[#111111] border border-[#333333] p-6 mb-8">
          <h3 class="text-xl font-bold text-[#00ffff] mb-4 font-mono">SZYBKIE TWORZENIE KAMPANII</h3>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
            <select id="templateSelect" class="bg-[#0a0a0a] border border-[#333333] text-[#e0e0e0] px-4 py-3 focus:border-[#00ffff] focus:outline-none">
              <option>E-commerce Master</option>
              <option>B2B Lead Generation</option>
              <option>Brand Awareness</option>
              <option>Local Business</option>
            </select>
            <input 
              type="text" 
              id="campaignName"
              placeholder="Nazwa kampanii" 
              class="bg-[#0a0a0a] border border-[#333333] text-[#e0e0e0] px-4 py-3 focus:border-[#00ffff] focus:outline-none"
            >
            <input 
              type="number" 
              id="campaignBudget"
              placeholder="Budżet dzienny (PLN)" 
              class="bg-[#0a0a0a] border border-[#333333] text-[#e0e0e0] px-4 py-3 focus:border-[#00ffff] focus:outline-none"
            >
            <button id="createCampaignBtn" class="px-6 py-3 bg-[#00ffff] text-[#0a0a0a] font-bold hover:brightness-110 transition-all duration-300 font-mono uppercase">
              UTWÓRZ
            </button>
          </div>
          
          <!-- Platform Selection -->
          <div class="mb-4">
            <div class="text-[#a0a0a0] mb-2">Wybierz platformy:</div>
            <div class="flex gap-4 flex-wrap">
              <label class="flex items-center gap-2">
                <input type="checkbox" checked class="text-[#00ffff]">
                <span class="text-[#e0e0e0] font-mono text-sm">GOOGLE ADS</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" checked class="text-[#00ffff]">
                <span class="text-[#e0e0e0] font-mono text-sm">FACEBOOK ADS</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" class="text-[#00ffff]">
                <span class="text-[#e0e0e0] font-mono text-sm">LINKEDIN ADS</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" class="text-[#00ffff]">
                <span class="text-[#e0e0e0] font-mono text-sm">ALLEGRO ADS</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" class="text-[#00ffff]">
                <span class="text-[#e0e0e0] font-mono text-sm">TIKTOK ADS</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Active Campaigns List -->
        <div class="space-y-6" id="campaignsList">
          <!-- Campaigns will be loaded here dynamically -->
          <div class="text-center py-12">
            <div class="text-[#666666] text-lg">Ładowanie kampanii...</div>
          </div>
        </div>

      </div>
    </div>

    <!-- Other tabs will be loaded dynamically -->
    <div id="creative" class="tab-content relative z-20 py-12 hidden">
      <div class="max-w-6xl mx-auto px-4">
        <div class="text-center py-12">
          <div class="text-[#00ffff] text-2xl font-mono mb-4">AI CREATIVE GENERATOR</div>
          <div class="text-[#a0a0a0]">Funkcja w przygotowaniu...</div>
        </div>
      </div>
    </div>

    <div id="analytics" class="tab-content relative z-20 py-12 hidden">
      <div class="max-w-6xl mx-auto px-4">
        <div class="text-center py-12">
          <div class="text-[#00ffff] text-2xl font-mono mb-4">ZAAWANSOWANA ANALITYKA</div>
          <div class="text-[#a0a0a0]">Funkcja w przygotowaniu...</div>
        </div>
      </div>
    </div>

    <div id="automation" class="tab-content relative z-20 py-12 hidden">
      <div class="max-w-6xl mx-auto px-4">
        <div class="text-center py-12">
          <div class="text-[#00ffff] text-2xl font-mono mb-4">AUTOMATYZACJA KAMPANII</div>
          <div class="text-[#a0a0a0]">Funkcja w przygotowaniu...</div>
        </div>
      </div>
    </div>

  </main>
</MyBonzoLayout>

<style>
  .cyber-grid {
    background-image: 
      linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 102, 153, 0.1) 1px, transparent 1px);
    background-size: 50px 50px;
  }

  .cyber-glow {
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
  }

  .tab-content {
    display: none;
  }

  .tab-content:not(.hidden) {
    display: block;
  }
</style>

<script>
  // Tab switching functionality
  const tabs = ['dashboard', 'campaign', 'creative', 'analytics', 'automation'];
  const contents = ['dashboard', 'campaigns', 'creative', 'analytics', 'automation'];

  tabs.forEach((tab, index) => {
    const tabButton = document.getElementById(`${tab}Tab`);
    if (tabButton) {
      tabButton.addEventListener('click', () => {
        // Remove active state from all tabs
        tabs.forEach(t => {
          const btn = document.getElementById(`${t}Tab`);
          if (btn) {
            btn.className = "px-4 py-2 bg-[#111111] border border-[#333333] text-[#a0a0a0] hover:text-[#00ffff] transition-all duration-300 font-mono uppercase tracking-wide text-sm";
          }
        });

        // Hide all content
        contents.forEach(c => {
          const content = document.getElementById(c);
          if (content) content.classList.add('hidden');
        });

        // Activate current tab
        tabButton.className = "px-4 py-2 bg-[#00ffff] text-[#0a0a0a] border border-[#00ffff] font-bold font-mono uppercase tracking-wide text-sm";
        
        // Show current content
        const content = document.getElementById(contents[index]);
        if (content) content.classList.remove('hidden');
      });
    }
  });

  // Marketing Maestro API integration
  class MarketingMaestro {
    constructor() {
      this.baseUrl = '/api/marketing-maestro';
      this.init();
    }

    async init() {
      await this.loadDashboardData();
      await this.loadCampaigns();
    }

    async callApi(action, data = {}) {
      try {
        const response = await fetch(this.baseUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action, data })
        });
        
        const result = await response.json();
        if (!response.ok) throw new Error(result.error);
        return result;
      } catch (error) {
        console.error('Marketing Maestro API Error:', error);
        this.showNotification('error', error.message);
        return null;
      }
    }

    async loadDashboardData() {
      const data = await this.callApi('getDashboard');
      if (data) {
        this.updateDashboard(data);
      }
    }

    async loadCampaigns() {
      const data = await this.callApi('getCampaigns');
      if (data) {
        this.updateCampaignsList(data.campaigns);
      }
    }

    updateDashboard(data) {
      if (data.kpis) {
        const totalRevenue = document.getElementById('totalRevenue');
        const totalLeads = document.getElementById('totalLeads');
        const avgRoas = document.getElementById('avgRoas');
        const avgCpa = document.getElementById('avgCpa');

        if (totalRevenue) totalRevenue.textContent = `$${data.kpis.revenue.toLocaleString()}`;
        if (totalLeads) totalLeads.textContent = data.kpis.leads.toLocaleString();
        if (avgRoas) avgRoas.textContent = `${data.kpis.roas}x`;
        if (avgCpa) avgCpa.textContent = `$${data.kpis.cpa}`;
      }
    }

    updateCampaignsList(campaigns) {
      const container = document.getElementById('campaignsList');
      if (!container || !campaigns) return;

      container.innerHTML = campaigns.map(campaign => `
        <div class="bg-[#111111] border border-[#333333] p-6 hover:border-[#00ffff] transition-all duration-300">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h3 class="text-xl font-bold text-[#00ffff] mb-2 font-mono">${campaign.name}</h3>
              <p class="text-[#a0a0a0] mb-2">${campaign.type}</p>
              <div class="flex gap-4 text-sm">
                <span class="text-[#00ff00]">Status: ${campaign.status}</span>
                <span class="text-[#a0a0a0]">Platform: ${campaign.platform}</span>
              </div>
            </div>
            <div class="text-right">
              <div class="text-[#00ffff] font-bold text-lg">$${campaign.spent}</div>
              <div class="text-[#a0a0a0] text-sm">z $${campaign.budget} budżetu</div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
            <div class="bg-[#0a0a0a] border border-[#333333] p-3">
              <div class="text-[#00ffff] font-bold">${campaign.metrics.impressions.toLocaleString()}</div>
              <div class="text-[#a0a0a0] text-sm">Impressions</div>
            </div>
            <div class="bg-[#0a0a0a] border border-[#333333] p-3">
              <div class="text-[#00ffff] font-bold">${campaign.metrics.clicks.toLocaleString()}</div>
              <div class="text-[#a0a0a0] text-sm">Kliknięcia</div>
            </div>
            <div class="bg-[#0a0a0a] border border-[#333333] p-3">
              <div class="text-[#00ffff] font-bold">${campaign.metrics.conversions}</div>
              <div class="text-[#a0a0a0] text-sm">Konwersje</div>
            </div>
            <div class="bg-[#0a0a0a] border border-[#333333] p-3">
              <div class="text-[#00ffff] font-bold">${campaign.metrics.roas}x</div>
              <div class="text-[#a0a0a0] text-sm">ROAS</div>
            </div>
          </div>
          
          <div class="flex gap-2">
            <button class="px-4 py-2 bg-[#00ffff] text-[#0a0a0a] font-bold hover:brightness-110 transition-all duration-300 text-sm uppercase" onclick="maestro.editCampaign('${campaign.id}')">
              EDYTUJ
            </button>
            <button class="px-4 py-2 bg-[#333333] text-[#e0e0e0] hover:brightness-110 transition-all duration-300 text-sm uppercase" onclick="maestro.viewReport('${campaign.id}')">
              RAPORT
            </button>
            <button class="px-4 py-2 bg-[#ff3333] text-white hover:brightness-110 transition-all duration-300 text-sm uppercase" onclick="maestro.pauseCampaign('${campaign.id}')">
              ZATRZYMAJ
            </button>
          </div>
        </div>
      `).join('');
    }

    async createCampaign() {
      const name = document.getElementById('campaignName')?.value;
      const budget = document.getElementById('campaignBudget')?.value;
      const template = document.getElementById('templateSelect')?.value;

      if (!name || !budget) {
        this.showNotification('error', 'Wypełnij wszystkie wymagane pola');
        return;
      }

      const platforms = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .map(cb => cb.nextElementSibling?.textContent?.toLowerCase().replace(' ads', ''));

      const data = await this.callApi('createCampaign', {
        name, budget: parseFloat(budget), template, platforms
      });

      if (data) {
        this.showNotification('success', 'Kampania została utworzona!');
        await this.loadCampaigns();
      }
    }

    async editCampaign(id) {
      this.showNotification('info', `Edytowanie kampanii ${id}`);
    }

    async viewReport(id) {
      this.showNotification('info', `Generowanie raportu dla kampanii ${id}`);
    }

    async pauseCampaign(id) {
      const data = await this.callApi('pauseCampaign', { id });
      if (data) {
        this.showNotification('success', 'Kampania została wstrzymana');
        await this.loadCampaigns();
      }
    }

    showNotification(type, message) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 p-4 rounded border z-50 ${
        type === 'error' ? 'bg-[#ff3333] text-white border-[#ff3333]' :
        type === 'success' ? 'bg-[#00ff00] text-[#0a0a0a] border-[#00ff00]' :
        'bg-[#00ffff] text-[#0a0a0a] border-[#00ffff]'
      }`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 4000);
    }
  }

  // Initialize Marketing Maestro
  const maestro = new MarketingMaestro();

  // Create Campaign button handler
  document.getElementById('createCampaignBtn')?.addEventListener('click', () => {
    maestro.createCampaign();
  });
</script>
