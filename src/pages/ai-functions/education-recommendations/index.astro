---
import MyBonzoLayout from "../../../layouts/MyBonzoLayout.astro";
import DecorativeLines from "../../../components/DecorativeLines.astro";
---

<MyBonzoLayout siteTitle="Rekomendacje Edukacyjne AI | KAROL LISSON">
  <DecorativeLines />

  <main class="min-h-svh relative z-10">
    <div class="fixed inset-0 bg-[#0a0a0a]">
      <div class="absolute inset-0 bg-gradient-to-br from-cyan-900/20 via-black to-black"></div>
      <div class="cyber-grid absolute inset-0"></div>
    </div>

    <section class="relative z-20 border-b border-[#333333] pt-20">
      <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex items-center justify-between mb-8">
          <div>
            <h1 class="text-4xl md:text-5xl font-bold text-[#00ffff] mb-2 uppercase tracking-wider font-mono">
              Rekomendacje Edukacyjne AI
            </h1>
            <p class="text-[#a0a0a0] text-lg font-['Kenyan_Coffee']">
              Personalizowane ścieżki rozwoju i rekomendacje kursów dopasowane do celów
            </p>
          </div>
        </div>
        <div class="flex gap-4 mb-8">
          <a href="/" class="px-4 py-2 bg-[#111111] border border-[#333333] text-[#00ffff] hover:brightness-125 transition-all duration-300 font-mono uppercase tracking-wide text-sm"> ← Powrót do głównej </a>
        </div>
      </div>
    </section>

    <section class="relative z-20 py-12">
      <div class="max-w-6xl mx-auto px-4">
        <div class="grid md:grid-cols-3 gap-6 mb-12">
          <!-- AI Personalizer Card -->
          <div class="bg-gradient-to-br from-[#1a1a1a] to-[#111111] border border-[#333333] p-6 rounded-sm">
            <h3 class="text-[#00ffff] font-mono text-xl uppercase tracking-wide mb-4">🧠 AI Personalizer</h3>
            <div class="space-y-4">
                <div>
                    <label for="skill-level" class="block text-sm font-medium text-gray-300 mb-2">Twój poziom:</label>
                    <select id="skill-level" class="w-full p-2 bg-[#0a0a0a] border border-[#333333] text-white rounded-sm">
                        <option value="beginner">Początkujący</option>
                        <option value="intermediate">Średniozaawansowany</option>
                        <option value="advanced">Zaawansowany</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Twoje zainteresowania:</label>
                    <div id="interests-container" class="grid grid-cols-2 gap-2 text-sm">
                        <label class="flex items-center gap-2 p-2 bg-[#0a0a0a] border border-[#333333] rounded-sm cursor-pointer"><input type="checkbox" value="AI" class="form-checkbox bg-gray-800 border-gray-600 text-cyan-500"> AI</label>
                        <label class="flex items-center gap-2 p-2 bg-[#0a0a0a] border border-[#333333] rounded-sm cursor-pointer"><input type="checkbox" value="Frontend" class="form-checkbox bg-gray-800 border-gray-600 text-cyan-500"> Frontend</label>
                        <label class="flex items-center gap-2 p-2 bg-[#0a0a0a] border border-[#333333] rounded-sm cursor-pointer"><input type="checkbox" value="Backend" class="form-checkbox bg-gray-800 border-gray-600 text-cyan-500"> Backend</label>
                        <label class="flex items-center gap-2 p-2 bg-[#0a0a0a] border border-[#333333] rounded-sm cursor-pointer"><input type="checkbox" value="DevOps" class="form-checkbox bg-gray-800 border-gray-600 text-cyan-500"> DevOps</label>
                    </div>
                </div>
                <button id="generate-recommendations" class="w-full bg-[#00ffff] text-[#0a0a0a] py-2 px-4 text-sm font-bold hover:brightness-125 transition-all duration-300 font-mono uppercase">Generuj Rekomendacje</button>
            </div>
          </div>

          <!-- Course Library & Progress Tracker Cards (Static for now) -->
          <div class="bg-gradient-to-br from-[#1a1a1a] to-[#111111] border border-[#333333] p-6 rounded-sm"><h3 class="text-[#00ffff] font-mono text-xl uppercase tracking-wide">📚 Biblioteka Kursów</h3></div>
          <div class="bg-gradient-to-br from-[#1a1a1a] to-[#111111] border border-[#333333] p-6 rounded-sm"><h3 class="text-[#00ffff] font-mono text-xl uppercase tracking-wide">📊 Tracker Postępów</h3></div>
        </div>
      </div>
    </section>

    <section class="relative z-20 py-8 border-t border-[#333333]">
      <div class="max-w-6xl mx-auto px-4">
        <h3 class="text-[#00ffff] font-mono text-xl uppercase tracking-wide mb-6">🎯 Twoje Rekomendacje AI</h3>
        <div id="recommendations-output" class="space-y-4">
            <p class="text-gray-500">Wybierz swoje preferencje i kliknij "Generuj Rekomendacje", aby zobaczyć spersonalizowane propozycje kursów.</p>
        </div>
      </div>
    </section>
  </main>

  <style>
    .cyber-grid { background-image: linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px); background-size: 20px 20px; }
    .form-checkbox:checked { background-color: #00ffff; }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const generateBtn = document.getElementById('generate-recommendations');
        const skillLevelSelect = document.getElementById('skill-level') as HTMLSelectElement;
        const interestsContainer = document.getElementById('interests-container');
        const outputContainer = document.getElementById('recommendations-output');

        generateBtn.addEventListener('click', async () => {
            const selectedInterests = Array.from(interestsContainer.querySelectorAll('input[type="checkbox"]:checked')).map(cb => (cb as HTMLInputElement).value);

            if (selectedInterests.length === 0) {
                alert('Wybierz przynajmniej jedno zainteresowanie.');
                return;
            }

            const requestBody = {
                skillLevel: skillLevelSelect.value,
                interests: selectedInterests
            };

            // Set loading state
            outputContainer.innerHTML = '<p class="text-cyan-400">🤖 Generowanie rekomendacji dla Ciebie...</p>';
            generateBtn.disabled = true;
            (generateBtn.firstChild as Text).data = 'Analizuję...';

            try {
                const response = await fetch('/api/education-recommendations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errData = await response.json();
                    throw new Error(errData.error || `Błąd serwera: ${response.status}`);
                }

                const data = await response.json();

                if (data.success && data.data.recommendations) {
                    renderRecommendations(data.data.recommendations);
                } else {
                    throw new Error(data.error || 'Nie udało się pobrać rekomendacji.');
                }

            } catch (err) {
                outputContainer.innerHTML = `<p class="text-red-500">Wystąpił błąd: ${err.message}</p>`;
            } finally {
                generateBtn.disabled = false;
                (generateBtn.firstChild as Text).data = 'Generuj Rekomendacje';
            }
        });

        function renderRecommendations(recommendations) {
            if (recommendations.length === 0) {
                outputContainer.innerHTML = '<p class="text-gray-400">Nie znaleziono pasujących kursów dla wybranych kryteriów.</p>';
                return;
            }

            outputContainer.innerHTML = recommendations.map(rec => `
                <div class="bg-[#0a0a0a] border border-[#333333] p-4 rounded-sm hover:border-[#00ffff] transition-all duration-300">
                    <div class="flex justify-between items-start mb-2">
                        <h5 class="text-[#e0e0e0] text-md font-bold">${rec.name}</h5>
                        <span class="bg-[#333333] text-[#00ffff] px-2 py-1 text-xs rounded capitalize">${rec.level}</span>
                    </div>
                    <p class="text-[#a0a0a0] text-sm mb-3">${rec.description}</p>
                    <div class="mt-2 pt-2 border-t border-gray-700 text-cyan-300 text-xs italic">
                        <strong>Rekomendacja AI:</strong> ${rec.reason}
                    </div>
                </div>
            `).join('');
        }
    });
  </script>


</MyBonzoLayout>
