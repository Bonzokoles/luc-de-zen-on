
---
import BackroomInterface from '@/layouts/BackroomInterface.astro';
import AiHelpAssistant from '@/components/AiHelpAssistant.svelte';
---

<BackroomInterface siteTitle="Flowise AI | AI Workers">
  <div class="fixed inset-0 bg-[#0f1419] pointer-events-none">
    <div class="absolute inset-0 bg-gradient-to-br from-cyan-900/15 via-[#0f1419] to-[#0f1419] pointer-events-none"></div>
  </div>

  <section class="backroom-header">
    <div class="backroom-container">
      <h1 class="backroom-title">Flowise AI</h1>
      <p class="backroom-description">Wizualny konstruktor workflow dla sztucznej inteligencji</p>
    </div>
  </section>

  <section class="backroom-section">
    <div class="backroom-container">
      <div class="function-container">
        <h2 class="text-2xl font-semibold text-primary mb-5">Flowise AI Interface</h2>
        <div class="flowise-ui">
          <div class="mb-6">
            <label for="workflow-select" class="block text-lg font-semibold mb-2 text-primary-foreground">Wybierz Workflow</label>
            <select id="workflow-select" class="w-full p-2 bg-surface border border-edge rounded-lg">
              <option value="flowise_monitoring_workflow">Monitoring Workflow</option>
              <option value="flowise_faq_generation_workflow">FAQ Generation Workflow</option>
            </select>
          </div>
          <div class="mb-6">
            <label for="flowise-input" class="block text-lg font-semibold mb-2 text-primary-foreground">WprowadÅº dane</label>
            <textarea id="flowise-input" class="w-full h-40 p-2 rounded bg-surface border border-edge" placeholder="Wpisz swoje zapytanie lub dane..."></textarea>
          </div>
          <button id="run-workflow-btn" class="action-btn">Uruchom Workflow</button>
          <div id="flowise-output" class="mt-6"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- POLACZEK_T Floating Assistant -->
  <div class="fixed bottom-5 right-5 z-50">
    <button id="polaczekBtn" class="action-btn">ðŸ¤– POLACZEK_T</button>
    <div id="polaczekWidget" class="hidden absolute bottom-16 right-0 w-96 bg-surface border border-edge rounded-lg shadow-lg">
      <AiHelpAssistant client:load pageTitle="Flowise AI | AI Workers" />
    </div>
  </div>

  <script>
    const runWorkflowBtn = document.getElementById('run-workflow-btn');
    const workflowSelect = document.getElementById('workflow-select');
    const flowiseInput = document.getElementById('flowise-input');
    const flowiseOutput = document.getElementById('flowise-output');

    runWorkflowBtn.addEventListener('click', async () => {
      const workflowId = workflowSelect.value;
      const prompt = flowiseInput.value;

      if (!prompt) {
        alert('WprowadÅº dane do przetworzenia.');
        return;
      }

      flowiseOutput.innerHTML = '<p>Przetwarzanie...</p>';

      try {
        const response = await fetch('/api/flowise', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            workflowId: workflowId,
            prompt: prompt,
          }),
        });

        const data = await response.json();

        if (data.success) {
          flowiseOutput.innerHTML = `<pre>${JSON.stringify(data.text, null, 2)}</pre>`;
        } else {
          flowiseOutput.innerHTML = `<p class="text-red-500">BÅ‚Ä…d: ${data.error}</p>`;
        }
      } catch (error) {
        flowiseOutput.innerHTML = `<p class="text-red-500">BÅ‚Ä…d: ${error.message}</p>`;
      }
    });
  </script>
</BackroomInterface>
