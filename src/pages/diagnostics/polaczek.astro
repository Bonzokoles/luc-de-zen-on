---
import MyBonzoLayout from "../../layouts/MyBonzoLayout.astro";
---

<MyBonzoLayout title="POLACZEK Diagnostics">
  <main class="min-h-svh">
    <section class="py-10">
      <div class="max-w-3xl mx-auto space-y-6">
        <h1 class="text-3xl font-bold text-cyan-400">POLACZEK Diagnostics</h1>
        <p class="text-gray-300">Szybki test komunikacji z <code>/api/polaczek-chat</code> i wybór modelu polskiego.</p>

        <div class="bg-black/40 border border-edge rounded p-4 space-y-3">
          <label class="block text-sm text-gray-300">Model</label>
          <select id="model" class="w-full p-2 bg-black/60 border border-edge rounded text-white">
            <option value="polaczek">POLACZEK (domyślny)</option>
            <option value="qwen-pl">Qwen 2.5 7B (PL)</option>
            <option value="llama-8b">LLaMA 3.1 8B</option>
          </select>

          <label class="block text-sm text-gray-300">Temperatura</label>
          <input id="temp" type="number" step="0.1" min="0" max="2" value="0.6" class="w-full p-2 bg-black/60 border border-edge rounded text-white" />

          <label class="block text-sm text-gray-300">Pytanie (po polsku)</label>
          <textarea id="prompt" rows="3" class="w-full p-2 bg-black/60 border border-edge rounded text-white" placeholder="Napisz krótkie pytanie..."></textarea>

          <button id="run" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded text-white">Wyślij</button>
        </div>

        <pre id="out" class="bg-black/60 border border-edge rounded p-4 text-gray-200 whitespace-pre-wrap"></pre>
      </div>
    </section>
  </main>

  <script>
    const out = document.getElementById('out');
    document.getElementById('run').addEventListener('click', async () => {
      out.textContent = 'Wysyłanie...';
      const model = (document.getElementById('model') as HTMLSelectElement).value;
      const temperature = parseFloat((document.getElementById('temp') as HTMLInputElement).value) || 0.6;
      const prompt = (document.getElementById('prompt') as HTMLTextAreaElement).value || 'Powiedz jedno zdanie o projekcie.';

      try {
        const res = await fetch('/api/polaczek-chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt, model, temperature, language: 'pl' })
        });
        const data = await res.json();
        out.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        out.textContent = 'Błąd: ' + (e?.message || e);
      }
    });
  </script>
</MyBonzoLayout>
