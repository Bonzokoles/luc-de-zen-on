{
  "name": "Activity Monitor - Error Detection",
  "description": "Automatyczne monitorowanie błędów i alerty dla systemu mybonzo",
  "version": "1.0.0",
  "nodes": [
    {
      "id": "1",
      "type": "apiReceive",
      "name": "Get Activity Logs",
      "position": { "x": 100, "y": 100 },
      "config": {
        "endpoint": "/api/activity/log",
        "method": "POST",
        "description": "Odbierz logi aktywności z systemu"
      }
    },
    {
      "id": "2",
      "type": "function",
      "name": "Parse and Classify Logs",
      "position": { "x": 300, "y": 100 },
      "config": {
        "script": "const logs = input || []; return logs.map(log => ({ ...log, level: (log.message && log.message.toLowerCase().includes('error')) ? 'error' : (log.message && log.message.toLowerCase().includes('warning')) ? 'warning' : 'info', severity: log.success === false ? 'high' : 'low' }));",
        "description": "Klasyfikuj logi według poziomu błędu"
      }
    },
    {
      "id": "3",
      "type": "function",
      "name": "Filter Critical Errors",
      "position": { "x": 500, "y": 100 },
      "config": {
        "script": "const filteredLogs = input.filter(log => log.level === 'error' || log.severity === 'high'); return { errors: filteredLogs, count: filteredLogs.length, timestamp: new Date().toISOString() };",
        "description": "Filtruj tylko krytyczne błędy"
      }
    },
    {
      "id": "4",
      "type": "conditional",
      "name": "Check Error Threshold",
      "position": { "x": 700, "y": 100 },
      "config": {
        "condition": "input.count > 3",
        "description": "Sprawdź czy liczba błędów przekroczyła próg alarmowy"
      }
    },
    {
      "id": "5",
      "type": "httpRequest",
      "name": "Send Alert to ActivePieces",
      "position": { "x": 900, "y": 100 },
      "config": {
        "url": "https://api.activepieces.com/api/v1/webhooks/trigger-alert",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer <ACTIVEPIECES_API_KEY>"
        },
        "body": "{\"type\": \"error_alert\", \"message\": \"Wykryto {{input.count}} błędów w systemie mybonzo!\", \"errors\": \"{{JSON.stringify(input.errors)}}\", \"timestamp\": \"{{input.timestamp}}\", \"priority\": \"high\"}",
        "description": "Wyślij alert do ActivePieces"
      }
    },
    {
      "id": "6",
      "type": "function",
      "name": "Log Processing Result",
      "position": { "x": 700, "y": 300 },
      "config": {
        "script": "console.log(`Processed ${input.count} errors at ${input.timestamp}`); return { status: 'processed', errors_found: input.count, processed_at: input.timestamp };",
        "description": "Zaloguj wynik przetwarzania"
      }
    }
  ],
  "connections": {
    "1": ["2"],
    "2": ["3"],
    "3": ["4", "6"],
    "4": ["5"]
  },
  "triggers": [
    {
      "type": "webhook",
      "endpoint": "/api/activity/log",
      "description": "Trigger when new activity logs are received"
    },
    {
      "type": "schedule",
      "expression": "*/30 * * * *",
      "description": "Check for errors every 30 minutes"
    }
  ],
  "settings": {
    "error_threshold": 3,
    "alert_channels": ["activepieces", "email"],
    "log_retention_days": 7
  }
}
