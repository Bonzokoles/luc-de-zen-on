{
  "trigger": {
    "type": "webhook",
    "endpoint": "/api/ticket/new"
  },
  "actions": [
    {
      "type": "httpRequest",
      "config": {
        "url": "https://api.openai.com/v1/chat/completions",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer <OPENAI_API_KEY>",
          "Content-Type": "application/json"
        },
        "body": "{\"model\": \"gpt-4\", \"messages\": [{\"role\": \"system\", \"content\": \"Klasyfikuj kategorię ticketu.\"}, {\"role\": \"user\", \"content\": \"{ticket_description}\"}]}"
      }
    },
    {
      "type": "conditional",
      "config": {
        "mode": "switch",
        "cases": [
          {
            "condition": "{{classification}} === 'tech support'",
            "actions": [
              {
                "type": "httpRequest",
                "config": {
                  "url": "https://api.jira.com/assign",
                  "method": "POST",
                  "body": "{\"ticket_id\":\"{{ticket_id}}\", \"team\":\"tech_support\"}"
                }
              }
            ]
          },
          {
            "condition": "{{classification}} === 'billing'",
            "actions": [
              {
                "type": "httpRequest",
                "config": {
                  "url": "https://api.zendesk.com/assign",
                  "method": "POST",
                  "body": "{\"ticket_id\":\"{{ticket_id}}\", \"team\":\"billing\"}"
                }
              }
            ]
          }
        ],
        "default": []
      }
    },
    {
      "type": "sendEmail",
      "config": {
        "to": "{{creator_email}}",
        "subject": "Status Twojego zgłoszenia",
        "body": "Twoje zgłoszenie zostało przydzielone do zespołu: {{classification}}"
      }
    }
  ]
}
