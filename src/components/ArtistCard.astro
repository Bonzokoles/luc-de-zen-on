---
// Komponent Artist Card - karta artysty z miniaturÄ… i informacjami
export interface Props {
  artist: {
    name: string;
    period: string;
    style: string;
    description: string;
    famousWorks: string[];
    techniques: string[];
    prompt: string;
    image: string;
    color: string;
  };
}

const { artist } = Astro.props;

function hexToRgb(hex: string): string {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result
    ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}`
    : "74, 85, 104";
}
---

<style>
  .artist-card {
    background: linear-gradient(
      135deg,
      var(--artist-color, #4a5568) 0%,
      rgba(0, 0, 0, 0.8) 100%
    );
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .artist-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    border-color: var(--artist-color, #4a5568);
  }

  .artist-image {
    width: 100%;
    height: 120px;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .artist-card:hover .artist-image {
    transform: scale(1.05);
  }

  .artist-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.5);
    padding: 20px 12px 12px;
    color: white;
  }

  .artist-name {
    font-weight: bold;
    font-size: 0.9rem;
    margin-bottom: 4px;
    color: var(--artist-color, #fff);
  }

  .artist-period {
    font-size: 0.75rem;
    opacity: 0.8;
    margin-bottom: 2px;
  }

  .artist-style {
    font-size: 0.7rem;
    opacity: 0.6;
  }

  .artist-works {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    font-size: 0.7rem;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .artist-card:hover .artist-works {
    opacity: 1;
  }

  .selected {
    border-color: var(--artist-color, #4a5568) !important;
    box-shadow: 0 0 20px rgba(var(--artist-color-rgb, 74, 85, 104), 0.4) !important;
    transform: translateY(-2px);
  }
</style>

<div
  class="artist-card cursor-pointer relative"
  style={`--artist-color: ${artist.color}; --artist-color-rgb: ${hexToRgb(artist.color)}`}
  onclick={`selectArtist('${artist.name}', '${artist.prompt}')`}
>
  <img
    src={artist.image || "/images/artists/placeholder.svg"}
    alt={artist.name}
    class="artist-image"
    onerror="this.src='/images/artists/placeholder.svg'"
  />

  <div class="artist-info">
    <div class="artist-name">{artist.name}</div>
    <div class="artist-period">{artist.period}</div>
    <div class="artist-style">{artist.style}</div>
  </div>

  <div class="artist-works">
    {artist.famousWorks.length} dzieĹ‚
  </div>
</div>

<script>
  function selectArtist(name: string, prompt: string) {
    // Dodaj artystÄ™ do promptu
    const promptElement = document.getElementById(
      "prompt"
    ) as HTMLTextAreaElement;
    if (promptElement) {
      const currentPrompt = promptElement.value;
      const artistPrompt = prompt;

      // SprawdĹş czy prompt juĹĽ zawiera styl artysty
      if (!currentPrompt.includes("in the style of")) {
        promptElement.value =
          currentPrompt + (currentPrompt ? ", " : "") + artistPrompt;
      } else {
        // ZamieĹ„ istniejÄ…cy styl
        const newPrompt = currentPrompt.replace(
          /in the style of[^,]+/g,
          artistPrompt
        );
        promptElement.value = newPrompt;
      }

      // PodĹ›wietl wybranÄ… kartÄ™
      document
        .querySelectorAll(".artist-card")
        .forEach((card) => card.classList.remove("selected"));
      (event?.currentTarget as HTMLElement)?.classList.add("selected");

      // PokaĹĽ tooltip z informacjami o artyĹ›cie
      showArtistTooltip(name);
    }
  }

  function showArtistTooltip(artistName: string) {
    // MoĹĽna dodaÄ‡ tooltip z dodatkowymi informacjami
    console.log(`Wybrano artystÄ™: ${artistName}`);
  }

  // Globalne funkcje dostÄ™pne w window
  (window as any).selectArtist = selectArtist;
</script>

