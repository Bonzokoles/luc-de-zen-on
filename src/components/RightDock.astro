---
const onAdmin = Astro.url.pathname.startsWith('/admin');
---

{!onAdmin && (
  <aside class="right-dock" aria-label="Szybki dostÄ™p">
    <!-- Music button with expandable quick controls -->
    <div class="dock-group">
      <button class="dock-btn" type="button" title="Muzyka" onclick="toggleDock('music')">MUZYKA</button>
      <div id="dock-music" class="dock-panel" hidden>
        <div class="panel-row">
          <button class="mini" onclick="window.MUSIC && window.MUSIC.prev()">âŹ®</button>
          <button class="mini" onclick="window.MUSIC && window.MUSIC.toggle()">âŹŻ</button>
          <button class="mini" onclick="window.MUSIC && window.MUSIC.next()">âŹ­</button>
          <button class="mini" onclick="window.MUSIC && window.MUSIC.togglePlaylist()">đź“‹</button>
        </div>
        <div class="panel-row">
          <label class="vol">VOL</label>
          <input type="range" min="0" max="100" value="50" oninput="(function(e){ if(window.MUSIC){ window.MUSIC.setVolume(e.target.value/100); } })(event)" />
        </div>
      </div>
    </div>

    <!-- Assistant button with expandable quick controls -->
    <div class="dock-group">
      <button class="dock-btn" type="button" title="Asystent" onclick="toggleDock('ai')">
        <span>POLACZEK</span>
        <span id="polaczek-dot" class="status-dot" aria-live="polite" title="status">â—Ź</span>
      </button>
      <div id="dock-ai" class="dock-panel" hidden>
        <div class="panel-col">
          <div class="ai-row">
            <span class="ai-label">STATUS</span>
            <span id="polaczek-status-text" class="ai-status">â€”</span>
          </div>
          <button class="mini full" onclick="window.POLACZEK && window.POLACZEK.openAssistant && window.POLACZEK.openAssistant()">Open chat</button>
          <button class="mini full" onclick="window.dispatchEvent(new CustomEvent('polaczek-clear-chat'))">New chat</button>
          <button class="mini full" onclick="window.dispatchEvent(new CustomEvent('polaczek-reconnect'))">Reconnect</button>
        </div>
      </div>
    </div>

    <!-- Admin link in same style -->
    <div class="dock-group">
      <a href="/admin/" class="dock-btn" title="Panel administracyjny">ADMIN</a>
    </div>

    <!-- Extra actions: refresh, close, open folder -->
    <div class="dock-group">
      <button class="dock-btn" type="button" title="OdĹ›wieĹĽ stronÄ™" onclick="window.REFRESH_ALL && window.REFRESH_ALL()">REFRESH</button>
      <button class="dock-btn" type="button" title="Zamknij kartÄ™" onclick="window.CLOSE_TAB && window.CLOSE_TAB()">CLOSE</button>
  <button class="dock-btn" type="button" title="OtwĂłrz lokalny folder" onclick="(window.MUSIC && window.MUSIC.openFolderPicker) ? window.MUSIC.openFolderPicker() : (window.OPEN_LOCAL_FOLDER && window.OPEN_LOCAL_FOLDER())">FOLDER</button>
    </div>
  </aside>
)}

<style>
  .right-dock{position:fixed;right:12px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:.5rem;z-index:10000}
  .dock-group{display:flex;flex-direction:column;align-items:flex-end;gap:.25rem}
  .dock-btn{writing-mode:vertical-rl;text-orientation:mixed;background:rgba(0,0,0,.85);color:#00e7ff;border:2px solid #8b0000;padding:12px 8px;text-decoration:none;font-weight:800;letter-spacing:.08em;cursor:pointer;box-shadow:0 0 18px rgba(139,0,0,.35);transition:transform .15s, box-shadow .2s, border-color .2s; display:flex; align-items:center; gap:6px}
  .dock-btn:hover{border-color:#00e7ff;box-shadow:0 0 24px rgba(0,231,255,.4);transform:scale(1.03)}
  .dock-panel{background:rgba(0,0,0,.7);border:2px solid #8b0000;padding:10px 12px;box-shadow:0 0 18px rgba(139,0,0,.35);width:260px; max-width:80vw}
  .panel-row{display:flex;gap:.5rem;align-items:center;justify-content:flex-end;margin:.25rem 0}
  .panel-col{display:flex;flex-direction:column;gap:.35rem}
  .mini{background:rgba(0,0,0,.6);border:2px solid #8b0000;color:#fff;padding:4px 6px;font-size:14px;cursor:pointer}
  .mini:hover{border-color:#00e7ff;color:#00e7ff}
  .mini.full{width:100%;text-align:center;padding:6px 8px}
  .vol{color:#aaa;font-size:12px;margin-right:.25rem}
  .status-dot{font-size:14px;line-height:1;margin-left:2px;color:#bbb}
  .status-ready{color:#39d353}
  .status-error{color:#ef4444}
  .status-disconnected{color:#666}
  .ai-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:.25rem}
  .ai-label{color:#94aec4;font-size:12px}
  .ai-status{color:#00e7ff;font-size:12px}
  @media (max-width: 768px){.right-dock{right:6px}.dock-btn{padding:8px 4px}}
</style>

<script>
  // @ts-nocheck
  function toggleDock(which){
    const id = which === 'music' ? 'dock-music' : (which === 'ai' ? 'dock-ai' : null);
    if(!id) return;
    const el = document.getElementById(id);
    if(!el) return;
    el.hidden = !el.hidden;
    if(which==='music' && window.MUSIC){
      try { window.MUSIC.ensureLoaded && window.MUSIC.ensureLoaded(); } catch(e){}
    }
  }

  // Update POLACZEK status indicator
  window.addEventListener('polaczek-status', (e) => {
    const dot = document.getElementById('polaczek-dot');
  const txt = document.getElementById('polaczek-status-text');
    if(!dot) return;
    const status = (e && e.detail && e.detail.status) || (window.POLACZEK && window.POLACZEK.status) || 'disconnected';
    dot.classList.remove('status-ready','status-error','status-disconnected');
    if(status === 'ready' || status === 'connected') dot.classList.add('status-ready');
    else if(status === 'error') dot.classList.add('status-error');
    else dot.classList.add('status-disconnected');
  if(txt) txt.textContent = String(status);
  });

  // Extra quick actions (as requested)
  // 1) Refresh all pages
  window.REFRESH_ALL = () => { window.location.reload(); };
  // 2) Close current tab/window (may be blocked by browser)
  window.CLOSE_TAB = () => { try { window.close(); } catch(e) { console.log('Close blocked'); } };
  // 3) Open local folder (cannot from browser; offer download/index link instead)
  window.OPEN_LOCAL_FOLDER = () => {
    alert('Opening a local folder is blocked by browsers. Provide a link or use a file input.');
    // Optional: document.getElementById('music-folder')?.click();
  };
</script>
