---
// TypeScript interface for component props (Astro 2025 best practice)
interface Props {
  siteTitle?: string;
  description?: string;
}

// Proper destructuring of props with defaults (Astro 2025 best practice)
const { 
  siteTitle = `${fileManagerConfig.displayName} - LUC de ZEN ON`,
  description = fileManagerConfig.description
} = Astro.props;

// Proper type imports (Astro 2025 best practice)
import type { HTMLAttributes } from "astro/types";
import Layout from '../../../layouts/Layout.astro';
import FileManagerComponent from './component.svelte';
import { fileManagerConfig } from './config';

// Metadata for SEO and performance (Astro 2025 best practice)
const pageMetadata = {
  title: siteTitle,
  description,
  robots: "index, follow",
  og: {
    title: siteTitle,
    description: description,
    type: "website"
  }
};
---

<Layout 
  {siteTitle}
  {description}
  theme="cyberpunk"
>
  <main class="min-h-screen bg-cyber-dark text-cyber-text p-4 circuit-overlay">
    <div class="max-w-7xl mx-auto">
      <!-- Agent Header -->
      <div class="agent-header glass-panel p-6 mb-6 no-radius">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="polish-title text-3xl mb-2 neon-text">
              üìÅ {fileManagerConfig.displayName}
            </h1>
            <p class="text-gray-400 polish-text">
              {fileManagerConfig.description}
            </p>
            <div class="agent-meta flex gap-4 mt-2 text-sm">
              <span class="text-cyan-400">Wersja: {fileManagerConfig.version}</span>
              <span class="text-green-400">Status: ‚úÖ Aktywny</span>
              <span class="text-blue-400">Kategoria: {fileManagerConfig.category}</span>
            </div>
          </div>
          
          <div class="agent-controls flex gap-2">
            <button class="agent-btn" id="test-agent">
              ‚ö° Test
            </button>
            <button class="agent-btn" id="agent-status">
              üìä Status
            </button>
            <a href="/agents" class="agent-btn">
              ‚¨ÖÔ∏è Powr√≥t
            </a>
          </div>
        </div>
      </div>

      <!-- Capabilities Info -->
      <div class="capabilities-grid grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="capability-card card">
          <h3 class="polish-title text-lg mb-3">üöÄ Mo≈ºliwo≈õci</h3>
          <ul class="space-y-1 text-sm">
            {fileManagerConfig.capabilities.map(cap => (
              <li class="text-gray-300">‚Ä¢ {cap.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</li>
            ))}
          </ul>
        </div>
        
        <div class="limits-card card">
          <h3 class="polish-title text-lg mb-3">‚öôÔ∏è Limity</h3>
          <ul class="space-y-1 text-sm">
            <li class="text-gray-300">Max. rozmiar: {Math.round(fileManagerConfig.maxFileSize / 1024 / 1024)}MB</li>
            <li class="text-gray-300">Dozwolone ≈õcie≈ºki: {fileManagerConfig.allowedPaths.length}</li>
            <li class="text-gray-300">Obs≈Çugiwane formaty: {fileManagerConfig.supportedExtensions.length}</li>
            <li class="text-gray-300">Operacje: {fileManagerConfig.restrictions.allowDelete ? '‚úÖ' : '‚ùå'} Usuwanie</li>
          </ul>
        </div>
        
        <div class="stats-card card">
          <h3 class="polish-title text-lg mb-3">üìà Statystyki</h3>
          <div class="stats-grid space-y-2 text-sm">
            <div class="stat-item flex justify-between">
              <span>Aktywno≈õƒá:</span>
              <span class="text-green-400">100%</span>
            </div>
            <div class="stat-item flex justify-between">
              <span>Czas odpowiedzi:</span>
              <span class="text-cyan-400">&lt; 100ms</span>
            </div>
            <div class="stat-item flex justify-between">
              <span>≈öcie≈ºka domy≈õlna:</span>
              <span class="text-blue-400">{fileManagerConfig.defaultPath}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- File Manager Component -->
      <FileManagerComponent client:load />

      <!-- Agent Documentation -->
      <div class="agent-docs glass-panel p-6 mt-6">
        <h2 class="polish-title text-2xl mb-4">üìñ Dokumentacja</h2>
        <div class="docs-content polish-text space-y-4">
          <p class="text-gray-300">
            Agent File Manager zapewnia kompletne zarzƒÖdzanie plikami z intuicyjnym interfejsem. 
            Obs≈Çuguje wszystkie podstawowe operacje CRUD oraz zaawansowane funkcje wyszukiwania.
          </p>
          
          <h3 class="polish-title text-lg mb-2">üîß Dostƒôpne akcje API:</h3>
          <ul class="space-y-2 text-sm">
            <li><code class="bg-gray-800 px-2 py-1">POST /api/agents/file-manager</code> - G≈Ç√≥wny endpoint</li>
            <li><code class="bg-gray-800 px-2 py-1">action: "list"</code> - Lista plik√≥w w folderze</li>
            <li><code class="bg-gray-800 px-2 py-1">action: "upload"</code> - Przesy≈Çanie nowych plik√≥w</li>
            <li><code class="bg-gray-800 px-2 py-1">action: "download"</code> - Pobieranie zawarto≈õci pliku</li>
            <li><code class="bg-gray-800 px-2 py-1">action: "delete"</code> - Usuwanie plik√≥w/folder√≥w</li>
            <li><code class="bg-gray-800 px-2 py-1">action: "search"</code> - Wyszukiwanie z recursion</li>
          </ul>

          <h3 class="polish-title text-lg mb-2">üõ°Ô∏è Bezpiecze≈Ñstwo:</h3>
          <ul class="space-y-1 text-sm text-gray-300">
            <li>‚Ä¢ Ograniczone ≈õcie≈ºki dostƒôpu</li>
            <li>‚Ä¢ Walidacja rozszerzenia plik√≥w</li>
            <li>‚Ä¢ Kontrola rozmiaru plik√≥w</li>
            <li>‚Ä¢ Logowanie wszystkich operacji</li>
          </ul>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const testBtn = document.getElementById('test-agent');
    const statusBtn = document.getElementById('agent-status');
    
    if (testBtn) {
      testBtn.addEventListener('click', async () => {
        try {
          const response = await fetch('/api/agents/file-manager', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'test' })
          });
          
          const result = await response.json();
          alert(result.success ? `‚úÖ ${result.message}` : `‚ùå ${result.message}`);
        } catch (error) {
          alert('‚ùå B≈ÇƒÖd po≈ÇƒÖczenia z agentem');
        }
      });
    }
    
    if (statusBtn) {
      statusBtn.addEventListener('click', async () => {
        try {
          const response = await fetch('/api/agents/file-manager', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'status' })
          });
          
          const result = await response.json();
          alert(result.success ? `üìä Status: ${result.data.status}` : `‚ùå ${result.message}`);
        } catch (error) {
          alert('‚ùå B≈ÇƒÖd pobierania statusu');
        }
      });
    }
  });
</script>
