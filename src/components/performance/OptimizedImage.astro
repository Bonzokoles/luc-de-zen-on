---
// src/components/performance/OptimizedImage.astro
import { Image, Picture } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  src: ImageMetadata | string;
  alt: string;
  width?: number;
  height?: number;
  quality?: number;
  format?: 'webp' | 'avif' | 'png' | 'jpg';
  loading?: 'lazy' | 'eager';
  priority?: boolean;
  responsive?: boolean;
  sizes?: string;
}

const {
  src,
  alt,
  width,
  height,
  quality = 80,
  format = 'webp',
  loading = 'lazy',
  priority = false,
  responsive = false,
  sizes = '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw'
} = Astro.props;

// Responsive breakpoints
const breakpoints = [400, 800, 1200, 1600];
---

{responsive ? (
  <Picture
    src={src}
    alt={alt}
    quality={quality}
    format={format}
    loading={priority ? 'eager' : loading}
    sizes={sizes}
    widths={breakpoints}
  />
) : (
  <Image
    src={src}
    alt={alt}
    width={width}
    height={height}
    quality={quality}
    format={format}
    loading={priority ? 'eager' : loading}
  />
)}

{priority && (
  <link rel="preload" as="image" href={typeof src === 'string' ? src : src.src} />
)}
