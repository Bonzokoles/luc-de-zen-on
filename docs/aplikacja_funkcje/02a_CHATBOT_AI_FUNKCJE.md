# üîß CHATBOT_AI_FUNKCJE_02 - SZCZEG√ì≈ÅOWA ANALIZA TECHNICZNA

## üéØ MAPA FUNKCJI JAVASCRIPT (21 FUNKCJI)

### **üì° GRUPA: KOMUNIKACJA API**

#### **`async function sendMessage()`** - Linia 854

```javascript
// G≈Å√ìWNA FUNKCJA - Wysy≈Çanie wiadomo≈õci do AI
- Pobiera warto≈õci z UI (messageInput, aiModel, temperature, language)
- Waliduje input (sprawdza czy nie jest pusty)
- Dodaje wiadomo≈õƒá u≈ºytkownika do interfejsu
- Wysy≈Ça request do /api/chat
- Obs≈Çuguje odpowied≈∫ i dodaje do UI
- Zapisuje do historii localStorage
- Obs≈Çuguje b≈Çƒôdy i fallbacks
```

#### **`async function testAPI()`** - Linia 951

```javascript
// TEST PO≈ÅƒÑCZENIA - Weryfikacja dostƒôpno≈õci API
- Wysy≈Ça GET request do /api/chat
- Sprawdza status odpowiedzi
- Wy≈õwietla informacje o dostƒôpnych modelach
- Loguje wyniki w konsoli
- Pokazuje status w UI
```

#### **`function askQuestion(question)`** - Linia 849

```javascript
// SZYBKIE PYTANIA - Quick action buttons
- Ustawia warto≈õƒá w messageInput
- Automatycznie wywo≈Çuje sendMessage()
- U≈ºywane przez przyciski Quick Actions
```

---

### **üí¨ GRUPA: ZARZƒÑDZANIE WIADOMO≈öCIAMI**

#### **`function addMessage(content, type, isError = false)`** - Linia 983

```javascript
// DODAWANIE WIADOMO≈öCI - Renderowanie wiadomo≈õci w UI
- Tworzy HTML element dla wiadomo≈õci
- Obs≈Çuguje r√≥≈ºne typy: user, assistant, system
- Styluje zgodnie z typem (kolory, layout)
- Dodaje timestamp i metadata
- Automatyczne przewijanie chatu
- Obs≈Çuga b≈Çƒôd√≥w z czerwonym kolorem
```

#### **`function clearChat()`** - Linia 1025

```javascript
// CZYSZCZENIE CHATU - Reset konwersacji
- Usuwa wszystkie wiadomo≈õci z UI
- Resetuje chatMessages innerHTML
- Dodaje powitalna wiadomo≈õƒá AI
- Czy≈õci localStorage history (opcjonalnie)
- Resetuje stan Voice AI
```

---

### **üé§ GRUPA: VOICE AI SYSTEM**

#### **`function initializeVoiceAI()`** - Linia 703

```javascript
// INICJALIZACJA VOICE AI - Setup systemu g≈Çosowego
- Sprawdza dostƒôpno≈õƒá SpeechRecognition API
- Konfiguruje jƒôzyk (pl-PL, en-US)
- Ustawia continuous: true, interimResults: true
- Binduje event handlers (onresult, onerror, onend)
- Inicjalizuje speechSynthesis
```

#### **`function toggleVoiceMode()`** - Linia 743

```javascript
// TOGGLE VOICE MODE - Prze≈ÇƒÖczanie trybu g≈Çosowego
- Prze≈ÇƒÖcza stan voice mode (on/off)
- Aktualizuje UI button text i style
- W≈ÇƒÖcza/wy≈ÇƒÖcza auto-speak dla odpowiedzi
- Pokazuje/ukrywa voice controls
- Zapisuje preferencje u≈ºytkownika
```

#### **`function startVoiceRecording()`** - Linia 776

```javascript
// NAGRYWANIE G≈ÅOSOWE - Start speech recognition
- Sprawdza czy Voice AI jest dostƒôpne
- Wywo≈Çuje recognition.start()
- Aktualizuje UI (pokazuje indicator nagrywania)
- Obs≈Çuguje b≈Çƒôdy i fallbacks
- Integruje z F2 keyboard shortcut
```

#### **`function speakResponse(text)`** - Linia 821

```javascript
// SYNTEZA MOWY - Odczytywanie odpowiedzi AI
- Korzysta z speechSynthesis API
- Wybiera g≈Ços w odpowiednim jƒôzyku
- Konfiguruje rate, pitch, volume
- Obs≈Çuguje d≈Çugie teksty (chunking)
- Pokazuje progress indicator podczas m√≥wienia
```

#### **`function updateVoiceStatus(message, type = 'info')`** - Linia 762

```javascript
// STATUS VOICE AI - Aktualizacja statusu systemu g≈Çosowego
- Wy≈õwietla informacje o stanie Voice AI
- Obs≈Çuguje r√≥≈ºne typy: info, error, success
- Aktualizuje voice status indicator
- Auto-hide po okre≈õlonym czasie
```

---

### **‚öôÔ∏è GRUPA: KONFIGURACJA I USTAWIENIA**

#### **`function updateModelInfo()`** - Linia 787

```javascript
// INFO O MODELU - Aktualizacja opisu wybranego modelu
- Pobiera wybrany model z select dropdown
- Wyszukuje opis z modelDescriptions object
- Aktualizuje UI z informacjami o modelu
- Pokazuje capabilities i limitations
- Aktualizuje temperature recommendations
```

#### **`function updateSystemPrompt()`** - Linia 802

```javascript
// SYSTEM PROMPT - Aktualizacja prompt systemowego
- Pobiera wybranƒÖ rolƒô (assistant, programmer, writer, etc.)
- Wyszukuje odpowiedni prompt z rolePrompts object
- Aktualizuje currentSystemPrompt variable
- Refreshuje UI textarea z nowym promptem
- Zapisuje wyb√≥r w localStorage
```

#### **`function toggleSystemPrompt()`** - Linia 812

```javascript
// TOGGLE SYSTEM PROMPT - Poka≈º/ukryj system prompt panel
- Prze≈ÇƒÖcza widoczno≈õƒá system prompt textarea
- Aktualizuje button text (Poka≈º/Ukryj)
- Animuje transition (slide up/down)
- Zapisuje stan w localStorage
```

---

### **üìö GRUPA: HISTORIA I PERSISTENCE**

#### **`function saveChatToHistory(userMessage, aiResponse)`** - Linia 1069

```javascript
// ZAPIS HISTORII - Zapisywanie konwersacji do localStorage
- Tworzy obiekt chat z timestamp i messages
- Generuje title z pierwszych 50 znak√≥w
- Dodaje metadata (model, language, role)
- Updatuje chatHistory array
- Zapisuje do localStorage
- Limituje historiƒô do ostatnich 50 konwersacji
```

#### **`function updateHistoryDisplay()`** - Linia 1100

```javascript
// WY≈öWIETLANIE HISTORII - Refresh listy zapisanych chat√≥w
- Pobiera chatHistory z localStorage
- Sortuje po timestamp (najnowsze pierwsze)
- Renderuje HTML dla ka≈ºdego chatu
- Dodaje przyciski Load i Delete
- Aktualizuje counter z liczbƒÖ zapisanych chat√≥w
```

#### **`function loadChat(chatId)`** - Linia 1134

```javascript
// WCZYTYWANIE CHATU - Przywracanie zapisanej konwersacji
- Znajdzie chat po ID w chatHistory
- Czy≈õci aktualny chat
- Rekonstruuje messages w UI
- Przywraca ustawienia (model, temperature)
- Scrolluje do ostatniej wiadomo≈õci
```

#### **`function deleteChat(chatId)`** - Linia 1148

```javascript
// USUWANIE CHATU - Kasowanie konwersacji z historii
- Znajduje chat po ID
- Pokazuje confirmation dialog
- Usuwa z chatHistory array
- Updatuje localStorage
- Refreshuje history display
- Pokazuje success message
```

#### **`function exportChat()`** - Linia 1046

```javascript
// EKSPORT CHATU - Pobieranie konwersacji jako JSON
- Zbiera wszystkie wiadomo≈õci z aktualnego chatu
- Tworzy JSON z metadata (timestamp, model, settings)
- Generuje nazwƒô pliku z datƒÖ
- Tworzy download link
- Automatycznie pobiera plik
```

---

### **üéõÔ∏è GRUPA: UI I INTERAKCJA**

#### **`function handleKeyPress(event)`** - Linia 836

```javascript
// OBS≈ÅUGA KLAWISZY - Keyboard shortcuts w textarea
- Enter: wysy≈Ça wiadomo≈õƒá (domy≈õlnie)
- Shift+Enter: nowa linia
- Ctrl+Enter: wysy≈Ça z force
- F2: rozpoczyna voice recording
- Escape: anuluje voice recording
```

#### **`function generateRandomPrompt()`** - Linia 1162

```javascript
// LOSOWE PROMPTY - Generowanie przyk≈Çadowych pyta≈Ñ
- Zawiera array ~20 przyk≈Çadowych pyta≈Ñ
- Wybiera losowe pytanie
- Wstawia do messageInput
- R√≥≈ºne kategorie: programming, creative, educational
- Opcjonalne auto-send
```

#### **`function openVoiceAssistant()`** - Linia 783

```javascript
// VOICE ASSISTANT - Otwieranie voice interface
- Sprawdza dostƒôpno≈õƒá Voice AI
- Otwiera modal z voice controls
- Inicjalizuje continuous recognition
- Pokazuje waveform visualization
```

---

## üîå API ENDPOINTS - SZCZEG√ì≈ÅOWA ANALIZA

### **`/api/chat` - G≈Å√ìWNY ENDPOINT**

#### **GET Request**

```typescript
// STATUS CHECK - Sprawdzanie stanu API
return createSuccessResponse({
  message: "Chat API is running",
  status: "active",
  methods: ["GET", "POST", "OPTIONS"],
  description: 'Send POST request with { prompt: "your message" }',
});
```

#### **POST Request Body**

```typescript
{
  prompt: string,              // Wiadomo≈õƒá u≈ºytkownika
  model?: string,              // '@cf/google/gemma-3-12b-it' | 'polaczek' | etc.
  temperature?: number,        // 0.0 - 1.0 (default: 0.6)
  system?: string,             // Custom system prompt
  language?: 'pl' | 'en' | 'auto',  // Jƒôzyk odpowiedzi
  usePolaczek?: boolean        // Force u≈ºycie Polaczek API
}
```

#### **Response Format**

```typescript
{
  answer: string,              // Odpowied≈∫ AI
  modelUsed: string,           // U≈ºyty model
  via?: string,                // 'cloudflare-ai' | 'polaczek-integration'
  timestamp?: string,          // ISO timestamp
  error?: string               // Je≈õli b≈ÇƒÖd
}
```

### **`/api/polaczek-chat` - POLSKI AI ENDPOINT**

#### **Specjalizacja**

```typescript
// Dedykowany endpoint dla polskiego AI
- MyBonzo Knowledge Base integration
- Polish language optimization
- Cultural context understanding
- Fallback dla g≈Ç√≥wnego API
```

#### **Features**

```typescript
- Polish AI models (Bielik, Qwen-PL)
- MyBonzo platform knowledge
- Documentation search integration
- Advanced Polish language processing
```

---

## üíæ STORAGE SYSTEM - LOCALSTORAGE STRUCTURE

### **Chat History Format**

```javascript
chatHistory = [
  {
    id: 1696789123456, // timestamp ID
    title: "Jak napisaƒá funkcjƒô w JavaScript...", // pierwsze 50 znak√≥w
    messages: [
      {
        role: "user",
        content: "Jak napisaƒá funkcjƒô w JavaScript?",
        timestamp: "2025-10-09 14:30:15",
      },
      {
        role: "assistant",
        content: "Oto jak napisaƒá funkcjƒô...",
        timestamp: "2025-10-09 14:30:18",
      },
    ],
    timestamp: "2025-10-09 14:30:15", // ludzka data
    model: "@cf/google/gemma-3-12b-it", // u≈ºyty model
    language: "pl", // jƒôzyk
    role: "programmer", // wybrana rola
    temperature: 0.6, // parametr
  },
];
```

### **Quick Prompt System**

```javascript
// Transfer prompt√≥w miƒôdzy stronami
localStorage.setItem("quickChatPrompt", prompt); // Zapis z g≈Ç√≥wnej strony
localStorage.getItem("quickChatPrompt"); // Odczyt w chatbot
localStorage.removeItem("quickChatPrompt"); // Czyszczenie po u≈ºyciu
```

### **User Preferences**

```javascript
// Zapisywane ustawienia u≈ºytkownika
{
  preferredModel: '@cf/google/gemma-3-12b-it',
  preferredLanguage: 'pl',
  voiceModeEnabled: true,
  autoSpeakResponses: false,
  systemPromptVisible: false,
  preferredRole: 'assistant'
}
```

---

## üé® CSS CLASSES I STYLING

### **Chat Interface Classes**

```css
.chat-messages          /* Kontener wiadomo≈õci */
/* Kontener wiadomo≈õci */
.message               /* Pojedyncza wiadomo≈õƒá */  
.user-message          /* Wiadomo≈õƒá u≈ºytkownika */
.assistant-message     /* Odpowied≈∫ AI */
.message-content       /* Tre≈õƒá wiadomo≈õci */
.message-header        /* Header z avatar i timestamp */
.message-text          /* Tekst wiadomo≈õci */
.typing-indicator; /* Animacja "AI pisze..." */
```

### **Control Classes**

```css
.quick-action-btn      /* Przyciski szybkich akcji */
/* Przyciski szybkich akcji */
.chat-input           /* Input area styling */
.voice-controls       /* Voice AI controls */
.settings-panel       /* Panel ustawie≈Ñ */
.history-panel        /* Panel historii */
.model-info; /* Informacje o modelu */
```

### **Animation Classes**

```css
.animate-bounce       /* Typing indicator dots */
/* Typing indicator dots */
.slide-in            /* Message animations */
.fade-in-out         /* Status messages */
.pulse; /* Voice recording indicator */
```

---

## üîÑ EVENT HANDLING I WORKFLOWS

### **Message Send Workflow**

```
1. User types ‚Üí messageInput
2. Presses Enter ‚Üí handleKeyPress()
3. Triggers ‚Üí sendMessage()
4. Validates input ‚Üí nie pusty
5. Shows typing indicator ‚Üí typingIndicator
6. Sends to API ‚Üí fetch('/api/chat')
7. Receives response ‚Üí JSON
8. Hides typing indicator
9. Adds message to UI ‚Üí addMessage()
10. Saves to history ‚Üí saveChatToHistory()
11. Auto-scroll ‚Üí scrollToBottom
12. Auto-speak (if enabled) ‚Üí speakResponse()
```

### **Voice Recognition Workflow**

```
1. User presses F2 ‚Üí handleKeyPress()
2. Starts recording ‚Üí startVoiceRecording()
3. Shows voice indicator ‚Üí updateVoiceStatus()
4. Recognition API ‚Üí SpeechRecognition
5. Interim results ‚Üí pokazuje na bie≈ºƒÖco
6. Final result ‚Üí wstawia do messageInput
7. Auto-send ‚Üí sendMessage()
8. Hides indicator ‚Üí updateVoiceStatus()
```

### **Model Change Workflow**

```
1. User selects model ‚Üí aiModel select change
2. Triggers ‚Üí updateModelInfo()
3. Updates description ‚Üí model info panel
4. Adjusts temperature ‚Üí recommendations
5. Updates system prompt ‚Üí role-based
6. Saves preference ‚Üí localStorage
```

---

## üéØ QUICK ACTIONS - PRZYCISK MAPPING

### **Kategorie Quick Actions (8 przycisk√≥w)**

```javascript
// üíª PROGRAMOWANIE
askQuestion("Jak napisaƒá funkcjƒô w JavaScript?");

// üåê T≈ÅUMACZENIE
askQuestion("Przet≈Çumacz ten tekst na angielski");

// ‚úçÔ∏è PISANIE
askQuestion("Napisz kreatywnƒÖ historiƒô o kosmosie");

// üß† NAUKA
askQuestion("Wyja≈õnij mi podstawy uczenia maszynowego");

// üî¢ MATEMATYKA
askQuestion("Pom√≥≈º mi z matematykƒÖ");

// üçΩÔ∏è DIETA
askQuestion("Stw√≥rz plan diety");

// üíº BIZNES
askQuestion("Pom√≥≈º z planem biznesowym");

// üé® KREATYWNO≈öƒÜ
askQuestion("Zainspiruj mnie kreatywnie");
```

---

## üèóÔ∏è SYSTEM INITIALIZATION

### **DOMContentLoaded Event**

```javascript
document.addEventListener("DOMContentLoaded", () => {
  // 1. Inicjalizacja system√≥w
  updateHistoryDisplay()     // Wczytaj historiƒô
  updateModelInfo()          // Info o modelu
  updateSystemPrompt()       // System prompt

  // 2. Voice AI setup
  if (SpeechRecognition support) {
    console.log("üé§ Voice AI dostƒôpny")
  }

  // 3. Test API
  testAPI()                  // Sprawd≈∫ po≈ÇƒÖczenie

  // 4. Quick prompt loading
  const quickPrompt = localStorage.getItem("quickChatPrompt")
  if (quickPrompt) {
    messageInput.value = quickPrompt
    localStorage.removeItem("quickChatPrompt")
  }

  // 5. Global functions (debugging)
  window.testAPI = testAPI
  window.sendMessage = sendMessage
  // ... inne funkcje

  console.log("‚úÖ Chatbot w pe≈Çni zainicjalizowany")
})
```

---

## ‚ö†Ô∏è ERROR HANDLING I FALLBACKS

### **API Error Handling**

```javascript
// Network errors
catch (error) {
  console.error('Network error:', error)
  addMessage('B≈ÇƒÖd po≈ÇƒÖczenia. Sprawd≈∫ internet.', 'error', true)
}

// HTTP errors
if (!response.ok) {
  throw new Error(`HTTP error! status: ${response.status}`)
}

// AI response errors
if (!data.answer && !data.response) {
  addMessage('AI nie wygenerowa≈Ç odpowiedzi.', 'error', true)
}
```

### **Voice AI Fallbacks**

```javascript
// Browser support check
if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
  updateVoiceStatus("Voice AI nie jest dostƒôpny w tej przeglƒÖdarce", "error");
  return;
}

// Recognition errors
recognition.onerror = (event) => {
  updateVoiceStatus(`B≈ÇƒÖd rozpoznawania: ${event.error}`, "error");
  // Fallback to manual input
};
```

### **Storage Fallbacks**

```javascript
// localStorage errors
try {
  localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
} catch (error) {
  console.warn("Nie mo≈ºna zapisaƒá historii:", error);
  // Continue without saving
}
```

---

_Szczeg√≥≈Çowa analiza funkcji AI Chatbot - kompletna mapa techniczna utworzona 09.10.2025_ üîß
