<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß API Diagnostics - MyBonzo Communication Test</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #00d4ff;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid;
        }
        
        .health { border-left-color: #28a745; }
        .bielik { border-left-color: #ffc107; }
        .polaczek { border-left-color: #dc3545; }
        .voice { border-left-color: #17a2b8; }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            font-size: 12px;
        }
        
        .success { background: rgba(40, 167, 69, 0.3); color: #28a745; }
        .error { background: rgba(220, 53, 69, 0.3); color: #dc3545; }
        .loading { background: rgba(255, 193, 7, 0.3); color: #ffc107; }
        .pending { background: rgba(108, 117, 125, 0.3); color: #6c757d; }
        
        .test-button {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
            font-size: 12px;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }
        
        .log {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .timestamp {
            color: #888;
            font-size: 10px;
        }
        
        .summary {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border: 2px solid #00d4ff;
        }
        
        .summary h3 {
            color: #00d4ff;
            margin-top: 0;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 12px;
        }
        
        .input-group input::placeholder, .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .global-controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .run-all-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .run-all-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(238, 90, 36, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß API Communication Diagnostics</h1>
        
        <div class="global-controls">
            <button class="run-all-btn" onclick="runFullDiagnostics()">
                üöÄ Run Full Diagnostics
            </button>
            <button class="run-all-btn" onclick="testChatbots()" style="background: linear-gradient(45deg, #00d4ff, #0099cc);">
                ü§ñ Test All Chatbots
            </button>
        </div>
        
        <div class="test-grid">
            <!-- Health Check -->
            <div class="test-section health">
                <h3>üíö System Health 
                    <span id="health-status" class="status pending">Pending</span>
                </h3>
                <p>Basic system connectivity and health check</p>
                <button class="test-button" onclick="testHealthEndpoint()">Test /api/health</button>
                <div id="health-log" class="log"></div>
            </div>
            
            <!-- Bielik Polish AI -->
            <div class="test-section bielik">
                <h3>üê∫ Bielik Polish AI 
                    <span id="bielik-status" class="status pending">Pending</span>
                </h3>
                <p>Polish AI chatbot communication test</p>
                <div class="input-group">
                    <input type="text" id="bielik-prompt" placeholder="Napisz test wiadomo≈õƒá po polsku..." value="Cze≈õƒá! Jak siƒô masz?">
                </div>
                <button class="test-button" onclick="testBielikAPI()">Test Bielik</button>
                <button class="test-button" onclick="testBielikClean()">Test Clean Version</button>
                <div id="bielik-log" class="log"></div>
            </div>
            
            <!-- POLACZEK Agents -->
            <div class="test-section polaczek">
                <h3>üéØ POLACZEK Agents 
                    <span id="polaczek-status" class="status pending">Pending</span>
                </h3>
                <p>Multi-agent system communication test</p>
                <div class="input-group">
                    <input type="text" id="polaczek-prompt" placeholder="Test zapytania dla agent√≥w..." value="Witaj POLACZEK! Sprawd≈∫ system.">
                </div>
                <button class="test-button" onclick="testPolaczekChat()">Test Chat</button>
                <button class="test-button" onclick="testPolaczekAgents()">Test Agents</button>
                <button class="test-button" onclick="testPolaczekOrchestrator()">Test Orchestrator</button>
                <div id="polaczek-log" class="log"></div>
            </div>
            
            <!-- Voice AI -->
            <div class="test-section voice">
                <h3>üé§ Voice AI 
                    <span id="voice-status" class="status pending">Pending</span>
                </h3>
                <p>Voice synthesis and AI communication test</p>
                <div class="input-group">
                    <input type="text" id="voice-text" placeholder="Tekst do syntezy..." value="To jest test syntezy mowy w jƒôzyku polskim.">
                </div>
                <button class="test-button" onclick="testVoiceAI()">Test Voice AI</button>
                <button class="test-button" onclick="testTextToSpeech()">Test TTS</button>
                <div id="voice-log" class="log"></div>
            </div>
        </div>
        
        <div class="summary">
            <h3>üìä Diagnostic Summary</h3>
            <div id="summary-content">
                <p>Click "Run Full Diagnostics" to start comprehensive testing...</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let testResults = {};
        
        function logMessage(section, message, type = 'info') {
            const logDiv = document.getElementById(`${section}-log`);
            const timestamp = new Date().toLocaleTimeString();
            const typeColor = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            
            logDiv.innerHTML += `
                <div style="margin-bottom: 5px;">
                    <span class="timestamp">[${timestamp}]</span>
                    <span style="color: ${typeColor}">[${type.toUpperCase()}]</span>
                    ${message}
                </div>
            `;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(section, status, message = '') {
            const statusEl = document.getElementById(`${section}-status`);
            statusEl.className = `status ${status}`;
            statusEl.textContent = message || (status === 'success' ? 'OK' : status === 'error' ? 'Failed' : status === 'loading' ? 'Testing...' : 'Pending');
        }

        async function testHealthEndpoint() {
            updateStatus('health', 'loading');
            logMessage('health', 'Testing system health endpoint...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                
                if (response.ok) {
                    logMessage('health', `‚úÖ Health check passed: ${data.status}`, 'success');
                    logMessage('health', `Services: ${JSON.stringify(data.services)}`, 'info');
                    updateStatus('health', 'success');
                    testResults.health = { status: 'success', data };
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error || 'Health check failed'}`);
                }
            } catch (error) {
                logMessage('health', `‚ùå Health check failed: ${error.message}`, 'error');
                updateStatus('health', 'error');
                testResults.health = { status: 'error', error: error.message };
            }
        }

        async function testBielikAPI() {
            updateStatus('bielik', 'loading');
            const prompt = document.getElementById('bielik-prompt').value;
            logMessage('bielik', `Testing Bielik API with prompt: "${prompt}"`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/bielik-polish`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        sessionId: 'test-session-' + Date.now()
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    logMessage('bielik', `‚úÖ Bielik response: ${data.answer.substring(0, 100)}...`, 'success');
                    logMessage('bielik', `Provider: ${data.provider}, Model: ${data.model}`, 'info');
                    updateStatus('bielik', 'success');
                    testResults.bielik = { status: 'success', data };
                } else {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                logMessage('bielik', `‚ùå Bielik API failed: ${error.message}`, 'error');
                updateStatus('bielik', 'error');
                testResults.bielik = { status: 'error', error: error.message };
            }
        }

        async function testBielikClean() {
            updateStatus('bielik', 'loading');
            const prompt = document.getElementById('bielik-prompt').value;
            logMessage('bielik', `Testing Bielik Clean API...`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/bielik-polish-clean`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        sessionId: 'test-session-clean-' + Date.now()
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    logMessage('bielik', `‚úÖ Bielik Clean OK: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
                    updateStatus('bielik', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error || 'Clean API failed'}`);
                }
            } catch (error) {
                logMessage('bielik', `‚ùå Bielik Clean failed: ${error.message}`, 'error');
                updateStatus('bielik', 'error');
            }
        }

        async function testPolaczekChat() {
            updateStatus('polaczek', 'loading');
            const prompt = document.getElementById('polaczek-prompt').value;
            logMessage('polaczek', `Testing POLACZEK Chat...`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/polaczek-chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: prompt,
                        sessionId: 'test-polaczek-' + Date.now()
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    logMessage('polaczek', `‚úÖ POLACZEK Chat response received`, 'success');
                    updateStatus('polaczek', 'success');
                    testResults.polaczek = { status: 'success', data };
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error || 'POLACZEK Chat failed'}`);
                }
            } catch (error) {
                logMessage('polaczek', `‚ùå POLACZEK Chat failed: ${error.message}`, 'error');
                updateStatus('polaczek', 'error');
                testResults.polaczek = { status: 'error', error: error.message };
            }
        }

        async function testPolaczekAgents() {
            logMessage('polaczek', `Testing POLACZEK Agents system...`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/polaczek-agents`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'status_check',
                        agents: ['POLACZEK_D', 'POLACZEK_T', 'POLACZEK_M1']
                    })
                });
                
                const data = await response.json();
                logMessage('polaczek', `POLACZEK Agents response: ${JSON.stringify(data).substring(0, 100)}...`, 'info');
            } catch (error) {
                logMessage('polaczek', `POLACZEK Agents error: ${error.message}`, 'error');
            }
        }

        async function testPolaczekOrchestrator() {
            logMessage('polaczek', `Testing POLACZEK Orchestrator...`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/bielik-orchestrator`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        task: 'system_status',
                        prompt: 'Sprawd≈∫ status systemu POLACZEK'
                    })
                });
                
                const data = await response.json();
                logMessage('polaczek', `Orchestrator response: ${JSON.stringify(data).substring(0, 100)}...`, 'info');
            } catch (error) {
                logMessage('polaczek', `Orchestrator error: ${error.message}`, 'error');
            }
        }

        async function testVoiceAI() {
            updateStatus('voice', 'loading');
            const text = document.getElementById('voice-text').value;
            logMessage('voice', `Testing Voice AI synthesis...`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/voice-ai`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        voice: 'openai'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    logMessage('voice', `‚úÖ Voice AI response received`, 'success');
                    updateStatus('voice', 'success');
                    testResults.voice = { status: 'success', data };
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error || 'Voice AI failed'}`);
                }
            } catch (error) {
                logMessage('voice', `‚ùå Voice AI failed: ${error.message}`, 'error');
                updateStatus('voice', 'error');
                testResults.voice = { status: 'error', error: error.message };
            }
        }

        async function testTextToSpeech() {
            const text = document.getElementById('voice-text').value;
            logMessage('voice', `Testing Text-to-Speech...`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/text-to-speech`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text
                    })
                });
                
                if (response.ok) {
                    logMessage('voice', `‚úÖ TTS endpoint responded`, 'success');
                } else {
                    const data = await response.json();
                    throw new Error(`HTTP ${response.status}: ${data.error || 'TTS failed'}`);
                }
            } catch (error) {
                logMessage('voice', `‚ùå TTS failed: ${error.message}`, 'error');
            }
        }

        async function runFullDiagnostics() {
            testResults = {};
            
            // Clear all logs
            ['health', 'bielik', 'polaczek', 'voice'].forEach(section => {
                document.getElementById(`${section}-log`).innerHTML = '';
                updateStatus(section, 'loading');
            });
            
            logMessage('health', 'üöÄ Starting full diagnostics...', 'info');
            
            // Run tests sequentially
            await testHealthEndpoint();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testBielikAPI();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testPolaczekChat();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testVoiceAI();
            
            // Generate summary
            generateSummary();
        }

        async function testChatbots() {
            logMessage('health', 'ü§ñ Testing all chatbot endpoints...', 'info');
            
            await testBielikAPI();
            await testBielikClean();
            await testPolaczekChat();
            await testPolaczekAgents();
            await testPolaczekOrchestrator();
            
            generateSummary();
        }

        function generateSummary() {
            const summaryDiv = document.getElementById('summary-content');
            const timestamp = new Date().toLocaleString();
            
            let successCount = 0;
            let totalTests = Object.keys(testResults).length;
            
            let summaryHTML = `<h4>üìã Test Results (${timestamp})</h4>`;
            
            Object.entries(testResults).forEach(([test, result]) => {
                const status = result.status === 'success' ? '‚úÖ' : '‚ùå';
                const statusColor = result.status === 'success' ? '#51cf66' : '#ff6b6b';
                
                summaryHTML += `
                    <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        <strong style="color: ${statusColor}">${status} ${test.toUpperCase()}</strong><br>
                        ${result.status === 'success' ? 'Communication OK' : `Error: ${result.error}`}
                    </div>
                `;
                
                if (result.status === 'success') successCount++;
            });
            
            const overallStatus = successCount === totalTests ? '‚úÖ ALL SYSTEMS OPERATIONAL' : 
                                 successCount > 0 ? '‚ö†Ô∏è PARTIAL CONNECTIVITY' : '‚ùå COMMUNICATION FAILED';
            
            const overallColor = successCount === totalTests ? '#51cf66' : 
                               successCount > 0 ? '#ffc107' : '#ff6b6b';
            
            summaryHTML += `
                <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; text-align: center;">
                    <h3 style="color: ${overallColor}; margin: 0;">${overallStatus}</h3>
                    <p style="margin: 5px 0;">${successCount}/${totalTests} endpoints responding correctly</p>
                </div>
            `;
            
            summaryDiv.innerHTML = summaryHTML;
        }

        // Auto-run basic health check on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîß API Diagnostics Tool loaded');
            setTimeout(testHealthEndpoint, 1000);
        });
    </script>
</body>
</html>
