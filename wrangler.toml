# MyBonzo AI Platform - Optimized Cloudflare Workers Configuration
name = "luc-de-zen-on"
pages_build_output_dir = "dist"
compatibility_date = "2024-09-23"
compatibility_flags = [ "nodejs_compat" ]

# Performance Optimizations
minify = true
main = "./dist/_worker.js"

# Custom domains configuration for production
[[routes]]
pattern = "www.mybonzo.com"
custom_domain = true

[[routes]]
pattern = "mybonzo.com"
custom_domain = true

# Workers KV Limits
# kv_namespaces defined in environment sections

# Cloudflare D1 Database for global sales data
[[d1_databases]]
binding = "DB"
database_name = "mybonzo-analytics"
database_id = "5d83cdc3-e897-4af2-b647-27352297430b"

# Resource limits for optimal performance - Enhanced for production
[limits]
cpu_ms = 30000  # Reduced for better performance
memory_mb = 128

# Smart placement for global optimization
[placement]
mode = "smart"

# Enhanced observability
[observability]
enabled = true
head_sampling_rate = 0.01

[vars]
NODE_ENV = "production"
PUBLIC_DEFAULT_MODEL = "@cf/google/gemma-3-12b-it"
PUBLIC_SITE_URL = "https://www.mybonzo.com"
SENTRY_ENVIRONMENT = "production"
WORKER_ENV = "production"
MAX_CONCURRENT_REQUESTS = "100"
CACHE_TTL = "3600"
API_RATE_LIMIT = "1000"
TAVILY_API_KEY = ""
DEEPSEEK_API_KEY = ""
KAGGLE_USERNAME = ""
KAGGLE_KEY = ""

# Darmowe AI API Keys - ustaw w Cloudflare Dashboard Environment Variables
# OPENAI_API_KEY = "sk-..." # dla Sora video generation  
# TOGETHER_API_KEY = "tgp_..." # dla Flux Schnell obrazy
# STABILITY_API_KEY = "sk-..." # dla SDXL Turbo obrazy
# HUGGINGFACE_API_KEY = "hf_..." # dla Playground v2 obrazy
# TAVILY_API_KEY = "tvly-..." # dla AI-powered web search

# Optimized KV Storage - Complete Configuration
[[kv_namespaces]]
id = "77d84c01758a4064be011acc35b2c344"
binding = "SESSION"
preview_id = "77d84c01758a4064be011acc35b2c344"

[[kv_namespaces]]
id = "a55f59fbe9534a28b7aa5e6af3ca112b"
binding = "CACHE_KV"
preview_id = "a55f59fbe9534a28b7aa5e6af3ca112b"

[[kv_namespaces]]
id = "dd99e89fa60f4ad6a3cc662a583d5298"
binding = "ANALYTICS"
preview_id = "dd99e89fa60f4ad6a3cc662a583d5298"

[[kv_namespaces]]
id = "269af92daf2a4baaa80b34afd5aad15e"
binding = "EDGE_CACHE"
preview_id = "269af92daf2a4baaa80b34afd5aad15e"

[[kv_namespaces]]
id = "f60142d5f86e46e29168cb094eeb92de"
binding = "AI_MODELS_CACHE"
preview_id = "f60142d5f86e46e29168cb094eeb92de"

[[kv_namespaces]]
id = "6e7d56f0c13e4859b6d071b8b508fce6"
binding = "AGENTS"
preview_id = "6e7d56f0c13e4859b6d071b8b508fce6"

[[kv_namespaces]]
id = "c11e3b427d2a406882fe82ccb9fb765c"
binding = "RATE_LIMITS"
preview_id = "c11e3b427d2a406882fe82ccb9fb765c"

[[kv_namespaces]]
id = "44c458f95c544837bafc586295e21310"
binding = "SECURITY_LOGS"
preview_id = "44c458f95c544837bafc586295e21310"

[[kv_namespaces]]
id = "23e11c0a4015498d9e199c529cbf3133"
binding = "KNOWLEDGE_BASE"
preview_id = "23e11c0a4015498d9e199c529cbf3133"

# ==============================================================================
# D1 DATABASES
# ==============================================================================

[[d1_databases]]
binding = "MYBONZO_ANALYTICS"
database_name = "mybonzo-analytics"
database_id = "5d83cdc3-e897-4af2-b647-27352297430b"

[[d1_databases]]
binding = "VIBESDK_DB"
database_name = "vibesdk-db-bonzo"
database_id = "f23f5462-f531-4737-be0d-84c73704d63f"

# ==============================================================================
# R2 STORAGE - Complete Configuration
# ==============================================================================
[[r2_buckets]]
bucket_name = "mybonzo-temp-storage"
binding = "TEMP_STORAGE"
preview_bucket_name = "mybonzo-temp-storage"

[[r2_buckets]]
bucket_name = "mybonzo-assets"
binding = "ASSETS_BUCKET"
preview_bucket_name = "mybonzo-assets"

[[r2_buckets]]
bucket_name = "mybonzo-ai-models"
binding = "AI_MODELS_BUCKET"
preview_bucket_name = "mybonzo-ai-models"

[[r2_buckets]]
bucket_name = "mybonzo-storage"
binding = "MAIN_STORAGE"
preview_bucket_name = "mybonzo-storage"

[[r2_buckets]]
bucket_name = "mybonzo-uploads"
binding = "UPLOADS_BUCKET"
preview_bucket_name = "mybonzo-uploads"

[[r2_buckets]]
bucket_name = "mybonzo-cache"
binding = "CACHE_BUCKET"
preview_bucket_name = "mybonzo-cache"

[[r2_buckets]]
bucket_name = "mybonzo-backups"
binding = "BACKUPS_BUCKET"
preview_bucket_name = "mybonzo-backups"

[[r2_buckets]]
bucket_name = "mybonzo-logs"
binding = "LOGS_BUCKET"
preview_bucket_name = "mybonzo-logs"

# AI Binding with optimized settings
[ai]
binding = "AI"

# Durable Objects - Real-time features
[[durable_objects.bindings]]
name = "CHAT_ROOMS"
class_name = "ChatRoom"
script_name = "luc-de-zen-on"

[[durable_objects.bindings]]
name = "USER_SESSIONS"
class_name = "UserSession"
script_name = "luc-de-zen-on"

[[durable_objects.bindings]]
name = "AI_WORKERS"
class_name = "AIWorker"
script_name = "luc-de-zen-on"

[[durable_objects.bindings]]
name = "ANALYTICS_COLLECTOR"
class_name = "AnalyticsCollector"
script_name = "luc-de-zen-on"

# D1 Databases - Complete Configuration
[[d1_databases]]
binding = "DB_MAIN"
database_name = "mybonzo-analytics"
database_id = "5d83cdc3-e897-4af2-b647-27352297430b"

[[d1_databases]]
binding = "DB_VIBESDK"
database_name = "vibesdk-db-bonzo"
database_id = "f23f5462-f531-4737-be0d-84c73704d63f"

# Production Environment - Optimized for www.mybonzo.com
[env.production]
minify = true

# Custom domains for production environment
[[env.production.routes]]
pattern = "www.mybonzo.com"
custom_domain = true

[[env.production.routes]]
pattern = "mybonzo.com"  
custom_domain = true

# Security headers for production
[[env.production.routes]]
pattern = "/secure/page"
custom_domain = true

[env.production.headers]
"/secure/page" = { "X-Frame-Options" = "DENY", "X-Content-Type-Options" = "nosniff", "Referrer-Policy" = "no-referrer" }
"/static/*" = { "Access-Control-Allow-Origin" = "*", "X-Robots-Tag" = "nosnippet" }
"https://myproject.pages.dev/*" = { "X-Robots-Tag" = "noindex" }

# Production performance optimization
[env.production.limits]
cpu_ms = 30000
memory_mb = 128

[env.production.placement]
mode = "smart"

[env.production.observability]
enabled = true
head_sampling_rate = 0.01

[env.production.vars]
NODE_ENV = "production"
PUBLIC_DEFAULT_MODEL = "@cf/google/gemma-3-12b-it"
PUBLIC_SITE_URL = "https://www.mybonzo.com"
WORKER_ENV = "production"
MAX_CONCURRENT_REQUESTS = "100"
CACHE_TTL = "3600"
API_RATE_LIMIT = "1000"
ENABLE_CACHING = "true"
PERFORMANCE_MONITORING = "true"

# Darmowe AI API Keys - ustaw w Cloudflare Dashboard
# OPENAI_API_KEY = "..." # dla Sora video
# TOGETHER_API_KEY = "..." # dla Flux Schnell
# STABILITY_API_KEY = "..." # dla SDXL Turbo
# HUGGINGFACE_API_KEY = "..." # dla Playground v2
# TAVILY_API_KEY = "tvly-..." # dla AI-powered web search

[[env.production.kv_namespaces]]
id = "77d84c01758a4064be011acc35b2c344"
binding = "SESSION"

[[env.production.kv_namespaces]]
id = "a55f59fbe9534a28b7aa5e6af3ca112b"
binding = "CACHE_KV"

[[env.production.kv_namespaces]]
id = "dd99e89fa60f4ad6a3cc662a583d5298"
binding = "ANALYTICS"

[[env.production.kv_namespaces]]
id = "269af92daf2a4baaa80b34afd5aad15e"
binding = "EDGE_CACHE"

[[env.production.kv_namespaces]]
id = "f60142d5f86e46e29168cb094eeb92de"
binding = "AI_MODELS_CACHE"

[[env.production.r2_buckets]]
bucket_name = "mybonzo-temp-storage"
binding = "TEMP_STORAGE"

[[env.production.r2_buckets]]
bucket_name = "mybonzo-assets"
binding = "ASSETS_BUCKET"

[[env.production.r2_buckets]]
bucket_name = "mybonzo-ai-models"
binding = "AI_MODELS_BUCKET"

[[env.production.r2_buckets]]
bucket_name = "mybonzo-storage"
binding = "MAIN_STORAGE"

[env.production.ai]
binding = "AI"

[[env.production.d1_databases]]
binding = "DB_MAIN"
database_name = "mybonzo-analytics"
database_id = "5d83cdc3-e897-4af2-b647-27352297430b"

[[env.production.d1_databases]]
binding = "DB_VIBESDK"
database_name = "vibesdk-db-bonzo"
database_id = "f23f5462-f531-4737-be0d-84c73704d63f"

# Development Environment - Fast iterations
[env.development]
minify = false

[env.development.vars]
NODE_ENV = "development"
PUBLIC_DEFAULT_MODEL = "@cf/google/gemma-3-12b-it"
PUBLIC_SITE_URL = "http://localhost:4321"
WORKER_ENV = "development"
MAX_CONCURRENT_REQUESTS = "50"
CACHE_TTL = "60"
API_RATE_LIMIT = "500"
